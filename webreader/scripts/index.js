//  json2.js
//  2016-05-01
//  Public Domain.
//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
//  See http://www.JSON.org/js.html
//  This code should be minified before deployment.
//  See http://javascript.crockford.com/jsmin.html
//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO
//  NOT CONTROL.
//  This file creates a global JSON object containing two methods: stringify
//  and parse. This file is provides the ES5 JSON capability to ES3 systems.
//  If a project might run on IE8 or earlier, then this file should be included.
//  This file does nothing on ES5 systems.
"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function this_value(){return this.valueOf()}function quote(a){return rx_escapable.lastIndex=0,rx_escapable.test(a)?'"'+a.replace(rx_escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function b(b,c){var d=typeof c;if(b=b.cache,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:r+c;return b=(b=b[d])&&b[e],"object"==d?b&&a(b,c)>-1?0:-1:b?0:-1}function c(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:r+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;var h=i();h["false"]=h["null"]=h["true"]=h.undefined=!1;var j=i();for(j.array=a,j.cache=h,j.push=c;++b<d;)j.push(a[b]);return j}function g(a){return"\\"+V[a]}function h(){return o.pop()||[]}function i(){return p.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function j(a){a.length=0,o.length<t&&o.push(a)}function k(a){var b=a.cache;b&&k(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,p.length<t&&p.push(a)}function l(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function m(c){function o(a){return a&&"object"==typeof a&&!Zc(a)&&Hc.call(a,"__wrapped__")?a:new p(a)}function p(a,b){this.__chain__=!!b,this.__wrapped__=a}function t(a){function b(){if(d){var a=l(d);Ic.apply(a,arguments)}if(this instanceof b){var f=X(c.prototype),g=c.apply(f,a||arguments);return Ea(g)?g:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Yc(b,a),b}function V(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Ea(a);if(!g)return a;var i=Ac.call(a);if(!R[i])return a;var k=Wc[i];switch(i){case K:case L:return new k(+a);case N:case Q:return new k(a);case P:return f=k(a.source,z.exec(a)),f.lastIndex=a.lastIndex,f}var m=Zc(a);if(b){var n=!d;d||(d=h()),e||(e=h());for(var o=d.length;o--;)if(d[o]==a)return e[o];f=m?k(a.length):{}}else f=m?l(a):ed({},a);return m&&(Hc.call(a,"index")&&(f.index=a.index),Hc.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(m?Ya:hd)(a,function(a,g){f[g]=V(a,b,c,d,e)}),n&&(j(d),j(e)),f):f}function X(a,b){return Ea(a)?Nc(a):{}}function Y(a,b,c){if("function"!=typeof a)return Zb;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Xc.funcNames&&(d=!a.name),d=d||!Xc.funcDecomp,!d)){var e=Fc.call(a);Xc.funcNames||(d=!A.test(e)),d||(d=E.test(e),Yc(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Ib(a,b)}function Z(a){function b(){var a=i?g:this;if(e){var o=l(e);Ic.apply(o,arguments)}if((f||k)&&(o||(o=l(arguments)),f&&Ic.apply(o,f),k&&o.length<h))return d|=16,Z([c,m?d:-4&d,o,null,g,h]);if(o||(o=arguments),j&&(c=a[n]),this instanceof b){a=X(c.prototype);var p=c.apply(a,o);return Ea(p)?p:a}return c.apply(a,o)}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,m=8&d,n=c;return Yc(b,a),b}function $(c,d){var e=-1,g=ia(),h=c?c.length:0,i=h>=s&&g===a,j=[];if(i){var l=f(d);l?(g=b,d=l):i=!1}for(;++e<h;){var m=c[e];g(d,m)<0&&j.push(m)}return i&&k(d),j}function aa(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Zc(h)||ma(h))){b||(h=aa(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function ba(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var i=typeof a,k=typeof b;if(!(a!==a||a&&U[i]||b&&U[k]))return!1;if(null==a||null==b)return a===b;var l=Ac.call(a),m=Ac.call(b);if(l==I&&(l=O),m==I&&(m=O),l!=m)return!1;switch(l){case K:case L:return+a==+b;case N:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case P:case Q:return a==vc(b)}var o=l==J;if(!o){var p=Hc.call(a,"__wrapped__"),q=Hc.call(b,"__wrapped__");if(p||q)return ba(p?a.__wrapped__:a,q?b.__wrapped__:b,c,d,e,f);if(l!=O)return!1;var r=a.constructor,s=b.constructor;if(r!=s&&!(Da(r)&&r instanceof r&&Da(s)&&s instanceof s)&&"constructor"in a&&"constructor"in b)return!1}var t=!e;e||(e=h()),f||(f=h());for(var u=e.length;u--;)if(e[u]==a)return f[u]==b;var v=0;if(g=!0,e.push(a),f.push(b),o){if(u=a.length,v=b.length,g=v==u,g||d)for(;v--;){var w=u,x=b[v];if(d)for(;w--&&!(g=ba(a[w],x,c,d,e,f)););else if(!(g=ba(a[v],x,c,d,e,f)))break}}else gd(b,function(b,h,i){return Hc.call(i,h)?(v++,g=Hc.call(a,h)&&ba(a[h],b,c,d,e,f)):n}),g&&!d&&gd(a,function(a,b,c){return Hc.call(c,b)?g=--v>-1:n});return e.pop(),f.pop(),t&&(j(e),j(f)),g}function ca(a,b,c,d,e){(Zc(b)?Ya:hd)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Zc(b))||id(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Zc(j)?j:[]:id(j)?j:{}),d.push(b),e.push(j),l||ca(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function da(a,b){return a+Ec(Vc()*(b-a+1))}function ea(c,d,e){var g=-1,i=ia(),l=c?c.length:0,m=[],n=!d&&l>=s&&i===a,o=e||n?h():m;if(n){var p=f(o);i=b,o=p}for(;++g<l;){var q=c[g],r=e?e(q,g,c):q;(d?!g||o[o.length-1]!==r:i(o,r)<0)&&((e||n)&&o.push(r),m.push(q))}return n?(j(o.array),k(o)):e&&j(o),m}function fa(a){return function(b,c,d){var e={};c=o.createCallback(c,d,3);var f=-1,g=b?b.length:0;if("number"==typeof g)for(;++f<g;){var h=b[f];a(e,h,c(h,f,b),b)}else hd(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function ga(a,b,c,d,e,f){var g=1&b,h=2&b,i=4&b,j=16&b,k=32&b;if(!h&&!Da(a))throw new wc;j&&!c.length&&(b&=-17,j=c=!1),k&&!d.length&&(b&=-33,k=d=!1);var m=a&&a.__bindData__;if(m&&m!==!0)return m=l(m),m[2]&&(m[2]=l(m[2])),m[3]&&(m[3]=l(m[3])),!g||1&m[1]||(m[4]=e),!g&&1&m[1]&&(b|=8),!i||4&m[1]||(m[5]=f),j&&Ic.apply(m[2]||(m[2]=[]),c),k&&Lc.apply(m[3]||(m[3]=[]),d),m[1]|=b,ga.apply(null,m);var n=1==b||17===b?t:Z;return n([a,b,c,d,e,f])}function ha(a){return ad[a]}function ia(){var b=(b=o.indexOf)===rb?a:b;return b}function ja(a){return"function"==typeof a&&Bc.test(a)}function ka(a){var b,c;return a&&Ac.call(a)==O&&(b=a.constructor,!Da(b)||b instanceof b)?(gd(a,function(a,b){c=b}),"undefined"==typeof c||Hc.call(a,c)):!1}function la(a){return bd[a]}function ma(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ac.call(a)==I||!1}function na(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),V(a,b,"function"==typeof c&&Y(c,d,1))}function oa(a,b,c){return V(a,!0,"function"==typeof b&&Y(b,c,1))}function pa(a,b){var c=X(a);return b?ed(c,b):c}function qa(a,b,c){var d;return b=o.createCallback(b,c,3),hd(a,function(a,c,e){return b(a,c,e)?(d=c,!1):n}),d}function ra(a,b,c){var d;return b=o.createCallback(b,c,3),ta(a,function(a,c,e){return b(a,c,e)?(d=c,!1):n}),d}function sa(a,b,c){var d=[];gd(a,function(a,b){d.push(b,a)});var e=d.length;for(b=Y(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function ta(a,b,c){var d=_c(a),e=d.length;for(b=Y(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function ua(a){var b=[];return gd(a,function(a,c){Da(a)&&b.push(c)}),b.sort()}function va(a,b){return a?Hc.call(a,b):!1}function wa(a){for(var b=-1,c=_c(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function xa(a){return a===!0||a===!1||a&&"object"==typeof a&&Ac.call(a)==K||!1}function ya(a){return a&&"object"==typeof a&&Ac.call(a)==L||!1}function za(a){return a&&1===a.nodeType||!1}function Aa(a){var b=!0;if(!a)return b;var c=Ac.call(a),d=a.length;return c==J||c==Q||c==I||c==O&&"number"==typeof d&&Da(a.splice)?!d:(hd(a,function(){return b=!1}),b)}function Ba(a,b,c,d){return ba(a,b,"function"==typeof c&&Y(c,d,2))}function Ca(a){return Pc(a)&&!Qc(parseFloat(a))}function Da(a){return"function"==typeof a}function Ea(a){return!(!a||!U[typeof a])}function Fa(a){return Ha(a)&&a!=+a}function Ga(a){return null===a}function Ha(a){return"number"==typeof a||a&&"object"==typeof a&&Ac.call(a)==N||!1}function Ia(a){return a&&"object"==typeof a&&Ac.call(a)==P||!1}function Ja(a){return"string"==typeof a||a&&"object"==typeof a&&Ac.call(a)==Q||!1}function Ka(a){return"undefined"==typeof a}function La(a,b,c){var d={};return b=o.createCallback(b,c,3),hd(a,function(a,c,e){d[c]=b(a,c,e)}),d}function Ma(a){var b=arguments,c=2;if(!Ea(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=Y(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=l(arguments,1,c),f=-1,g=h(),i=h();++f<c;)ca(a,e[f],d,g,i);return j(g),j(i),a}function Na(a,b,c){var d={};if("function"!=typeof b){var e=[];gd(a,function(a,b){e.push(b)}),e=$(e,aa(arguments,!0,!1,1));for(var f=-1,g=e.length;++f<g;){var h=e[f];d[h]=a[h]}}else b=o.createCallback(b,c,3),gd(a,function(a,c,e){b(a,c,e)||(d[c]=a)});return d}function Oa(a){for(var b=-1,c=_c(a),d=c.length,e=nc(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Pa(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=aa(arguments,!0,!1,1),g=Ea(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=o.createCallback(b,c,3),gd(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function Qa(a,b,c,d){var e=Zc(a);if(null==c)if(e)c=[];else{var f=a&&a.constructor,g=f&&f.prototype;c=X(g)}return b&&(b=o.createCallback(b,d,4),(e?Ya:hd)(a,function(a,d,e){return b(c,a,d,e)})),c}function Ra(a){for(var b=-1,c=_c(a),d=c.length,e=nc(d);++b<d;)e[b]=a[c[b]];return e}function Sa(a){for(var b=arguments,c=-1,d=aa(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=nc(e);++c<e;)f[c]=a[d[c]];return f}function Ta(a,b,c){var d=-1,e=ia(),f=a?a.length:0,g=!1;return c=(0>c?Sc(0,f+c):c)||0,Zc(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Ja(a)?a.indexOf(b,c):e(a,b,c))>-1:hd(a,function(a){return++d<c?n:!(g=a===b)}),g}function Ua(a,b,c){var d=!0;b=o.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&(d=!!b(a[e],e,a)););else hd(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Va(a,b,c){var d=[];b=o.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else hd(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Wa(a,b,c){b=o.createCallback(b,c,3);var d=-1,e=a?a.length:0;if("number"!=typeof e){var f;return hd(a,function(a,c,d){return b(a,c,d)?(f=a,!1):n}),f}for(;++d<e;){var g=a[d];if(b(g,d,a))return g}}function Xa(a,b,c){var d;return b=o.createCallback(b,c,3),Za(a,function(a,c,e){return b(a,c,e)?(d=a,!1):n}),d}function Ya(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:Y(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else hd(a,b);return a}function Za(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:Y(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=_c(a);d=e.length,hd(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function $a(a,b){var c=l(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=nc("number"==typeof f?f:0);return Ya(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function _a(a,b,c){var d=-1,e=a?a.length:0;if(b=o.createCallback(b,c,3),"number"==typeof e)for(var f=nc(e);++d<e;)f[d]=b(a[d],d,a);else f=[],hd(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function ab(a,b,c){var e=-(1/0),f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Zc(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];i>f&&(f=i)}else b=null==b&&Ja(a)?d:o.createCallback(b,c,3),Ya(a,function(a,c,d){var g=b(a,c,d);g>e&&(e=g,f=a)});return f}function bb(a,b,c){var e=1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Zc(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];f>i&&(f=i)}else b=null==b&&Ja(a)?d:o.createCallback(b,c,3),Ya(a,function(a,c,d){var g=b(a,c,d);e>g&&(e=g,f=a)});return f}function cb(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=o.createCallback(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else hd(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function db(a,b,c,d){var e=arguments.length<3;return b=o.createCallback(b,d,4),Za(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function eb(a,b,c){return b=o.createCallback(b,c,3),Va(a,function(a,c,d){return!b(a,c,d)})}function fb(a,b,c){if(a&&"number"!=typeof a.length&&(a=Ra(a)),null==b||c)return a?a[da(0,a.length-1)]:n;var d=gb(a);return d.length=Tc(Sc(0,b),d.length),d}function gb(a){var b=-1,c=a?a.length:0,d=nc("number"==typeof c?c:0);return Ya(a,function(a){var c=da(0,++b);d[b]=d[c],d[c]=a}),d}function hb(a){var b=a?a.length:0;return"number"==typeof b?b:_c(a).length}function ib(a,b,c){var d;b=o.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&!(d=b(a[e],e,a)););else hd(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function jb(a,b,c){var d=-1,f=Zc(b),g=a?a.length:0,l=nc("number"==typeof g?g:0);for(f||(b=o.createCallback(b,c,3)),Ya(a,function(a,c,e){var g=l[++d]=i();f?g.criteria=_a(b,function(b){return a[b]}):(g.criteria=h())[0]=b(a,c,e),g.index=d,g.value=a}),g=l.length,l.sort(e);g--;){var m=l[g];l[g]=m.value,f||j(m.criteria),k(m)}return l}function kb(a){return a&&"number"==typeof a.length?l(a):Ra(a)}function lb(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function mb(a){return $(a,aa(arguments,!0,!0,1))}function nb(a,b,c){var d=-1,e=a?a.length:0;for(b=o.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1}function ob(a,b,c){var d=a?a.length:0;for(b=o.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1}function pb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=o.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:n;return l(a,0,Tc(Sc(0,d),e))}function qb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=_a(a,c,d)),aa(a,b)}function rb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Sc(0,e+d):d||0}else if(d){var f=Ab(b,c);return b[f]===c?f:-1}return a(b,c,d)}function sb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=o.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return l(a,0,Tc(Sc(0,e-d),e))}function tb(){for(var c=[],d=-1,e=arguments.length,g=h(),i=ia(),l=i===a,m=h();++d<e;){var n=arguments[d];(Zc(n)||ma(n))&&(c.push(n),g.push(l&&n.length>=s&&f(d?c[d]:m)))}var o=c[0],p=-1,q=o?o.length:0,r=[];a:for(;++p<q;){var t=g[0];if(n=o[p],(t?b(t,n):i(m,n))<0){for(d=e,(t||m).push(n);--d;)if(t=g[d],(t?b(t,n):i(c[d],n))<0)continue a;r.push(n)}}for(;e--;)t=g[e],t&&k(t);return j(g),j(m),r}function ub(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=o.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:n;return l(a,Sc(0,e-d))}function vb(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Sc(0,d+c):Tc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wb(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Kc.call(a,f--,1),e--);return a}function xb(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Sc(0,Cc((b-a)/(c||1))),f=nc(e);++d<e;)f[d]=a,a+=c;return f}function yb(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=o.createCallback(b,c,3);++d<e;){var g=a[d];b(g,d,a)&&(f.push(g),Kc.call(a,d--,1),e--)}return f}function zb(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=o.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Sc(0,b);return l(a,d)}function Ab(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?o.createCallback(c,d,1):Zb,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function Bb(){return ea(aa(arguments,!0,!0))}function Cb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=o.createCallback(c,d,3)),ea(a,b,c)}function Db(a){return $(a,l(arguments,1))}function Eb(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Zc(c)||ma(c))var d=d?ea($(d,c).concat($(c,d))):c}return d||[]}function Fb(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?ab(md(a,"length")):0,d=nc(0>c?0:c);++b<c;)d[b]=md(a,b);return d}function Gb(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Zc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Hb(a,b){if(!Da(b))throw new wc;return function(){return--a<1?b.apply(this,arguments):n}}function Ib(a,b){return arguments.length>2?ga(a,17,l(arguments,2),null,b):ga(a,1,null,null,b)}function Jb(a){for(var b=arguments.length>1?aa(arguments,!0,!1,1):ua(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=ga(a[e],1,null,null,a)}return a}function Kb(a,b){return arguments.length>2?ga(b,19,l(arguments,2),null,a):ga(b,3,null,null,a)}function Lb(){for(var a=arguments,b=a.length;b--;)if(!Da(a[b]))throw new wc;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Mb(a,b){return b="number"==typeof b?b:+b||a.length,ga(a,4,null,null,null,b)}function Nb(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!Da(a))throw new wc;if(b=Sc(0,b)||0,c===!0){var o=!0;m=!1}else Ea(c)&&(o=c.leading,l="maxWait"in c&&(Sc(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var p=function(){var c=b-(od()-g);if(c>0)i=Jc(p,c);else{e&&Dc(e);var l=j;e=i=j=n,l&&(k=od(),f=a.apply(h,d),i||e||(d=h=null))}},q=function(){i&&Dc(i),e=i=j=n,(m||l!==b)&&(k=od(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=od(),h=this,j=m&&(i||!o),l===!1)var c=o&&!i;else{e||o||(k=g);var n=l-(g-k),r=0>=n;r?(e&&(e=Dc(e)),k=g,f=a.apply(h,d)):e||(e=Jc(q,n))}return r&&i?i=Dc(i):i||b===l||(i=Jc(p,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Ob(a){if(!Da(a))throw new wc;var b=l(arguments,1);return Jc(function(){a.apply(n,b)},1)}function Pb(a,b){if(!Da(a))throw new wc;var c=l(arguments,2);return Jc(function(){a.apply(n,c)},b)}function Qb(a,b){if(!Da(a))throw new wc;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):r+arguments[0];return Hc.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Rb(a){var b,c;if(!Da(a))throw new wc;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Sb(a){return ga(a,16,l(arguments,1))}function Tb(a){return ga(a,32,null,l(arguments,1))}function Ub(a,b,c){var d=!0,e=!0;if(!Da(a))throw new wc;return c===!1?d=!1:Ea(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),S.leading=d,S.maxWait=b,S.trailing=e,Nb(a,b,S)}function Vb(a,b){return ga(b,16,[a])}function Wb(a){return function(){return a}}function Xb(a,b,c){var d=typeof a;if(null==a||"function"==d)return Y(a,b,c);if("object"!=d)return bc(a);var e=_c(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Ea(g)?function(b){for(var c=e.length,d=!1;c--&&(d=ba(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Yb(a){return null==a?"":vc(a).replace(dd,ha)}function Zb(a){return a}function $b(a,b,c){var d=!0,e=b&&ua(b);b&&(c||e.length)||(null==c&&(c=b),f=p,b=a,a=o,e=ua(b)),c===!1?d=!1:Ea(c)&&"chain"in c&&(d=c.chain);var f=a,g=Da(f);Ya(e,function(c){var e=a[c]=b[c];g&&(f.prototype[c]=function(){var b=this.__chain__,c=this.__wrapped__,g=[c];Ic.apply(g,arguments);var h=e.apply(a,g);if(d||b){if(c===h&&Ea(h))return this;h=new f(h),h.__chain__=b}return h})})}function _b(){return c._=zc,this}function ac(){}function bc(a){return function(b){return b[a]}}function cc(a,b,c){var d=null==a,e=null==b;if(null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=Vc();return Tc(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b)}return da(a,b)}function dc(a,b){if(a){var c=a[b];return Da(c)?a[b]():c}}function ec(a,b,c){var d=o.templateSettings;a=vc(a||""),c=fd({},c,d);var e,f=fd({},c.imports,d.imports),h=_c(f),i=Ra(f),j=0,k=c.interpolate||D,l="__p += '",m=uc((c.escape||D).source+"|"+k.source+"|"+(k===B?y:D).source+"|"+(c.evaluate||D).source+"|$","g");a.replace(m,function(b,c,d,f,h,i){return d||(d=f),l+=a.slice(j,i).replace(F,g),c&&(l+="' +\n__e("+c+") +\n'"),h&&(e=!0,l+="';\n"+h+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var p=c.variable,q=p;q||(p="obj",l="with ("+p+") {\n"+l+"\n}\n"),l=(e?l.replace(v,""):l).replace(w,"$1").replace(x,"$1;"),l="function("+p+") {\n"+(q?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(e?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var r="\n/*\n//# sourceURL="+(c.sourceURL||"/lodash/template/source["+H++ +"]")+"\n*/";try{var s=qc(h,"return "+l+r).apply(n,i)}catch(t){throw t.source=l,t}return b?s(b):(s.source=l,s)}function fc(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=nc(a);for(b=Y(b,c,1);++d<a;)e[d]=b(d);return e}function gc(a){return null==a?"":vc(a).replace(cd,la)}function hc(a){var b=++q;return vc(null==a?"":a)+b}function ic(a){return a=new p(a),a.__chain__=!0,a}function jc(a,b){return b(a),a}function kc(){return this.__chain__=!0,this}function lc(){return vc(this.__wrapped__)}function mc(){return this.__wrapped__}c=c?_.defaults(W.Object(),c,_.pick(W,G)):W;var nc=c.Array,oc=c.Boolean,pc=c.Date,qc=c.Function,rc=c.Math,sc=c.Number,tc=c.Object,uc=c.RegExp,vc=c.String,wc=c.TypeError,xc=[],yc=tc.prototype,zc=c._,Ac=yc.toString,Bc=uc("^"+vc(Ac).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cc=rc.ceil,Dc=c.clearTimeout,Ec=rc.floor,Fc=qc.prototype.toString,Gc=ja(Gc=tc.getPrototypeOf)&&Gc,Hc=yc.hasOwnProperty,Ic=xc.push,Jc=c.setTimeout,Kc=xc.splice,Lc=xc.unshift,Mc=function(){try{var a={},b=ja(b=tc.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Nc=ja(Nc=tc.create)&&Nc,Oc=ja(Oc=nc.isArray)&&Oc,Pc=c.isFinite,Qc=c.isNaN,Rc=ja(Rc=tc.keys)&&Rc,Sc=rc.max,Tc=rc.min,Uc=c.parseInt,Vc=rc.random,Wc={};Wc[J]=nc,Wc[K]=oc,Wc[L]=pc,Wc[M]=qc,Wc[O]=tc,Wc[N]=sc,Wc[P]=uc,Wc[Q]=vc,p.prototype=o.prototype;var Xc=o.support={};Xc.funcDecomp=!ja(c.WinRTError)&&E.test(m),Xc.funcNames="string"==typeof qc.name,o.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:B,variable:"",imports:{_:o}},Nc||(X=function(){function a(){}return function(b){if(Ea(b)){a.prototype=b;var d=new a;a.prototype=null}return d||c.Object()}}());var Yc=Mc?function(a,b){T.value=b,Mc(a,"__bindData__",T),T.value=null}:ac,Zc=Oc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ac.call(a)==J||!1},$c=function(a){var b,c=a,d=[];if(!c)return d;if(!U[typeof a])return d;for(b in c)Hc.call(c,b)&&d.push(b);return d},_c=Rc?function(a){return Ea(a)?Rc(a):[]}:$c,ad={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bd=wa(ad),cd=uc("("+_c(bd).join("|")+")","g"),dd=uc("["+_c(ad).join("")+"]","g"),ed=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=Y(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&U[typeof e])for(var k=-1,l=U[typeof e]&&_c(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},fd=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&U[typeof e])for(var j=-1,k=U[typeof e]&&_c(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},gd=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!U[typeof e])return f;b=b&&"undefined"==typeof c?b:Y(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},hd=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!U[typeof e])return f;b=b&&"undefined"==typeof c?b:Y(b,c,3);for(var g=-1,h=U[typeof e]&&_c(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},id=Gc?function(a){if(!a||Ac.call(a)!=O)return!1;var b=a.valueOf,c=ja(b)&&(c=Gc(b))&&Gc(c);return c?a==c||Gc(a)==c:ka(a)}:ka,jd=fa(function(a,b,c){Hc.call(a,c)?a[c]++:a[c]=1}),kd=fa(function(a,b,c){(Hc.call(a,c)?a[c]:a[c]=[]).push(b)}),ld=fa(function(a,b,c){a[c]=b}),md=_a,nd=Va,od=ja(od=pc.now)&&od||function(){return(new pc).getTime()},pd=8==Uc(u+"08")?Uc:function(a,b){return Uc(Ja(a)?a.replace(C,""):a,b||0)};return o.after=Hb,o.assign=ed,o.at=Sa,o.bind=Ib,o.bindAll=Jb,o.bindKey=Kb,o.chain=ic,o.compact=lb,o.compose=Lb,o.constant=Wb,o.countBy=jd,o.create=pa,o.createCallback=Xb,o.curry=Mb,o.debounce=Nb,o.defaults=fd,o.defer=Ob,o.delay=Pb,o.difference=mb,o.filter=Va,o.flatten=qb,o.forEach=Ya,o.forEachRight=Za,o.forIn=gd,o.forInRight=sa,o.forOwn=hd,o.forOwnRight=ta,o.functions=ua,o.groupBy=kd,o.indexBy=ld,o.initial=sb,o.intersection=tb,o.invert=wa,o.invoke=$a,o.keys=_c,o.map=_a,o.mapValues=La,o.max=ab,o.memoize=Qb,o.merge=Ma,o.min=bb,o.omit=Na,o.once=Rb,o.pairs=Oa,o.partial=Sb,o.partialRight=Tb,o.pick=Pa,o.pluck=md,o.property=bc,o.pull=wb,o.range=xb,o.reject=eb,o.remove=yb,o.rest=zb,o.shuffle=gb,o.sortBy=jb,o.tap=jc,o.throttle=Ub,o.times=fc,o.toArray=kb,o.transform=Qa,o.union=Bb,o.uniq=Cb,o.values=Ra,o.where=nd,o.without=Db,o.wrap=Vb,o.xor=Eb,o.zip=Fb,o.zipObject=Gb,o.collect=_a,o.drop=zb,o.each=Ya,o.eachRight=Za,o.extend=ed,o.methods=ua,o.object=Gb,o.select=Va,o.tail=zb,o.unique=Cb,o.unzip=Fb,$b(o),o.clone=na,o.cloneDeep=oa,o.contains=Ta,o.escape=Yb,o.every=Ua,o.find=Wa,o.findIndex=nb,o.findKey=qa,o.findLast=Xa,o.findLastIndex=ob,o.findLastKey=ra,o.has=va,o.identity=Zb,o.indexOf=rb,o.isArguments=ma,o.isArray=Zc,o.isBoolean=xa,o.isDate=ya,o.isElement=za,o.isEmpty=Aa,o.isEqual=Ba,o.isFinite=Ca,o.isFunction=Da,o.isNaN=Fa,o.isNull=Ga,o.isNumber=Ha,o.isObject=Ea,o.isPlainObject=id,o.isRegExp=Ia,o.isString=Ja,o.isUndefined=Ka,o.lastIndexOf=vb,o.mixin=$b,o.noConflict=_b,o.noop=ac,o.now=od,o.parseInt=pd,o.random=cc,o.reduce=cb,o.reduceRight=db,o.result=dc,o.runInContext=m,o.size=hb,o.some=ib,o.sortedIndex=Ab,o.template=ec,o.unescape=gc,o.uniqueId=hc,o.all=Ua,o.any=ib,o.detect=Wa,o.findWhere=Wa,o.foldl=cb,o.foldr=db,o.include=Ta,o.inject=cb,$b(function(){var a={};return hd(o,function(b,c){o.prototype[c]||(a[c]=b)}),a}(),!1),o.first=pb,o.last=ub,o.sample=fb,o.take=pb,o.head=pb,hd(o,function(a,b){var c="sample"!==b;o.prototype[b]||(o.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new p(f,e):f})}),o.VERSION="2.4.2",o.prototype.chain=kc,o.prototype.toString=lc,o.prototype.value=mc,o.prototype.valueOf=mc,Ya(["join","pop","shift"],function(a){var b=xc[a];o.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new p(c,a):c}}),Ya(["push","reverse","sort","unshift"],function(a){var b=xc[a];o.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Ya(["concat","slice","splice"],function(a){var b=xc[a];o.prototype[a]=function(){return new p(b.apply(this.__wrapped__,arguments),this.__chain__)}}),o}var n,o=[],p=[],q=0,r=+new Date+"",s=75,t=40,u=" 	\f \ufeff\n\r\u2028\u2029 ᠎             　",v=/\b__p \+= '';/g,w=/\b(__p \+=) '' \+/g,x=/(__e\(.*?\)|\b__t\)) \+\n'';/g,y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,z=/\w*$/,A=/^\s*function[ \n\r\t]+\w/,B=/<%=([\s\S]+?)%>/g,C=RegExp("^["+u+"]*0+(?=.$)"),D=/($^)/,E=/\bthis\b/,F=/['\n\r\t\u2028\u2029\\]/g,G=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],H=0,I="[object Arguments]",J="[object Array]",K="[object Boolean]",L="[object Date]",M="[object Function]",N="[object Number]",O="[object Object]",P="[object RegExp]",Q="[object String]",R={};R[M]=!1,R[I]=R[J]=R[K]=R[L]=R[N]=R[O]=R[P]=R[Q]=!0;var S={leading:!1,maxWait:0,trailing:!1},T={configurable:!1,enumerable:!1,value:null,writable:!1},U={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},V={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},W=U[typeof window]&&window||this,X=U[typeof exports]&&exports&&!exports.nodeType&&exports,Y=U[typeof module]&&module&&!module.nodeType&&module,Z=Y&&Y.exports===X&&X,$=U[typeof global]&&global;!$||$.global!==$&&$.window!==$||(W=$);var _=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(W._=_,define(function(){return _})):X&&Y?Z?(Y.exports=_)._=_:X._=_:W._=_}.call(this),//     Backbone.js 1.0.0
//     (c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org
function(){
// Initial Setup
// -------------
// Save a reference to the global object (`window` in the browser, `exports`
// on the server).
var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,d&&(!c||!c.wait)&&!this.set(d,c))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),// moment.js
// version : 1.7.2
// author : Tim Wood
// license : MIT
// momentjs.com
function(a){function b(a,b,c,d){var e=c.lang();return e[a].call?e[a](c,d):e[a][b]}function c(a,b){return function(c){return h(a.call(this,c),b)}}function d(a){return function(b){var c=a.call(this,b);return c+this.lang().ordinal(c)}}function e(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,this._lang=c||!1}function f(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,e=a.weeks||a.w||0,f=a.days||a.d||0,h=a.hours||a.h||0,i=a.minutes||a.m||0,j=a.seconds||a.s||0,k=a.milliseconds||a.ms||0;this._milliseconds=k+1e3*j+6e4*i+36e5*h,this._days=f+7*e,this._months=d+12*c,b.milliseconds=k%1e3,j+=g(k/1e3),b.seconds=j%60,i+=g(j/60),b.minutes=i%60,h+=g(i/60),b.hours=h%24,f+=g(h/24),f+=7*e,b.days=f%30,d+=g(f/30),b.months=d%12,c+=g(d/12),b.years=c,this._lang=!1}function g(a){return 0>a?Math.ceil(a):Math.floor(a)}function h(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function i(a,b,c){var d,e=b._milliseconds,f=b._days,g=b._months;e&&a._d.setTime(+a+e*c),f&&a.date(a.date()+f*c),g&&(d=a.date(),a.date(1).month(a.month()+g*c).date(Math.min(d,a.daysInMonth())))}function j(a){return"[object Array]"===Object.prototype.toString.call(a)}function k(a,b){var c,d=Math.min(a.length,b.length),e=Math.abs(a.length-b.length),f=0;for(c=0;d>c;c++)~~a[c]!==~~b[c]&&f++;return f+e}function l(a,b,c,d){var e,f,g=[];for(e=0;7>e;e++)g[e]=a[e]=null==a[e]?2===e?1:0:a[e];return a[7]=g[7]=b,null!=a[8]&&(g[8]=a[8]),a[3]+=c||0,a[4]+=d||0,f=new Date(0),b?(f.setUTCFullYear(a[0],a[1],a[2]),f.setUTCHours(a[3],a[4],a[5],a[6])):(f.setFullYear(a[0],a[1],a[2]),f.setHours(a[3],a[4],a[5],a[6])),f._a=g,f}function m(a,b){var c,d,e=[];for(!b&&H&&(b=require("./lang/"+a)),c=0;c<I.length;c++)b[I[c]]=b[I[c]]||F.en[I[c]];for(c=0;12>c;c++)d=B([2e3,c]),e[c]=new RegExp("^"+(b.months[c]||b.months(d,""))+"|^"+(b.monthsShort[c]||b.monthsShort(d,"")).replace(".",""),"i");return b.monthsParse=b.monthsParse||e,F[a]=b,b}function n(a){var b="string"==typeof a&&a||a&&a._lang||null;return b?F[b]||m(b):B}function o(a){return a.match(/\[.*\]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function p(a){var b,c,d=a.match(K);for(b=0,c=d.length;c>b;b++)ba[d[b]]?d[b]=ba[d[b]]:d[b]=o(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+="function"==typeof d[b].call?d[b].call(e,a):d[b];return f}}function q(a,b){function c(b){return a.lang().longDateFormat[b]||b}for(var d=5;d--&&L.test(b);)b=b.replace(L,c);return $[b]||($[b]=p(b)),$[b](a)}function r(a){switch(a){case"DDDD":return P;case"YYYY":return Q;case"S":case"SS":case"SSS":case"DDD":return O;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return R;case"Z":case"ZZ":return S;case"T":return T;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return N;default:return new RegExp(a.replace("\\",""))}}function s(a,b,c,d){var e,f;switch(a){case"M":case"MM":c[1]=null==b?0:~~b-1;break;case"MMM":case"MMMM":for(e=0;12>e;e++)if(n().monthsParse[e].test(b)){c[1]=e,f=!0;break}f||(c[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":null!=b&&(c[2]=~~b);break;case"YY":c[0]=~~b+(~~b>70?1900:2e3);break;case"YYYY":c[0]=~~Math.abs(b);break;case"a":case"A":d.isPm="pm"===(b+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":c[3]=~~b;break;case"m":case"mm":c[4]=~~b;break;case"s":case"ss":c[5]=~~b;break;case"S":case"SS":case"SSS":c[6]=~~(1e3*("0."+b));break;case"Z":case"ZZ":d.isUTC=!0,e=(b+"").match(X),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&"+"===e[0]&&(d.tzh=-d.tzh,d.tzm=-d.tzm)}null==b&&(c[8]=!1)}function t(a,b){var c,d,e=[0,0,1,0,0,0,0],f={tzh:0,tzm:0},g=b.match(K);for(c=0;c<g.length;c++)d=(r(g[c]).exec(a)||[])[0],d&&(a=a.slice(a.indexOf(d)+d.length)),ba[g[c]]&&s(g[c],d,e,f);return f.isPm&&e[3]<12&&(e[3]+=12),f.isPm===!1&&12===e[3]&&(e[3]=0),l(e,f.isUTC,f.tzh,f.tzm)}function u(a,b){var c,d,f,g,h,i=a.match(M)||[],j=99;for(f=0;f<b.length;f++)g=t(a,b[f]),d=q(new e(g),b[f]).match(M)||[],h=k(i,d),j>h&&(j=h,c=g);return c}function v(a){var b,c="YYYY-MM-DDT";if(U.exec(a)){for(b=0;4>b;b++)if(W[b][1].exec(a)){c+=W[b][0];break}return S.exec(a)?t(a,c+" Z"):t(a,c)}return new Date(a)}function w(a,b,c,d,e){var f=e.relativeTime[a];return"function"==typeof f?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function x(a,b,c){var d=E(Math.abs(a)/1e3),e=E(d/60),f=E(e/60),g=E(f/24),h=E(g/365),i=45>d&&["s",d]||1===e&&["m"]||45>e&&["mm",e]||1===f&&["h"]||22>f&&["hh",f]||1===g&&["d"]||25>=g&&["dd",g]||45>=g&&["M"]||345>g&&["MM",E(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,w.apply({},i)}function y(a,b){B.fn[a]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function z(a){B.duration.fn[a]=function(){return this._data[a]}}function A(a,b){B.duration.fn["as"+a]=function(){return+this/b}}for(/************************************
        Constants
    ************************************/
var B,C,D="1.7.2",E=Math.round,
// internal storage for language config files
F={},G="en",H="undefined"!=typeof module&&module.exports,I="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),J=/^\/?Date\((\-?\d+)/i,K=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,L=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,M=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,N=/\d\d?/,O=/\d{1,3}/,P=/\d{3}/,Q=/\d{1,4}/,R=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,S=/Z|[\+\-]\d\d:?\d\d/i,T=/T/i,U=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,V="YYYY-MM-DDTHH:mm:ssZ",W=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],X=/([\+\-]|\d\d)/gi,Y="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Z={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},$={},_="DDD w M D d".split(" "),aa="M D H h m s w".split(" "),ba={M:function(){return this.month()+1},MMM:function(a){return b("monthsShort",this.month(),this,a)},MMMM:function(a){return b("months",this.month(),this,a)},D:function(){return this.date()},DDD:function(){var a=new Date(this.year(),this.month(),this.date()),b=new Date(this.year(),0,1);return~~((a-b)/864e5+1.5)},d:function(){return this.day()},dd:function(a){return b("weekdaysMin",this.day(),this,a)},ddd:function(a){return b("weekdaysShort",this.day(),this,a)},dddd:function(a){return b("weekdays",this.day(),this,a)},w:function(){var a=new Date(this.year(),this.month(),this.date()-this.day()+5),b=new Date(a.getFullYear(),0,4);return~~((a-b)/864e5/7+1.5)},YY:function(){return h(this.year()%100,2)},YYYY:function(){return h(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return h(~~(this.milliseconds()/10),2)},SSS:function(){return h(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+h(~~(a/60),2)+":"+h(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+h(~~(10*a/6),4)}};_.length;)C=_.pop(),ba[C+"o"]=d(ba[C]);for(;aa.length;)C=aa.pop(),ba[C+C]=c(ba[C],2);for(ba.DDDD=c(ba.DDD,3),B=function(b,c){if(null===b||""===b)return null;var d,f;return B.isMoment(b)?new e(new Date(+b._d),b._isUTC,b._lang):(c?d=j(c)?u(b,c):t(b,c):(f=J.exec(b),d=b===a?new Date:f?new Date(+f[1]):b instanceof Date?b:j(b)?l(b):"string"==typeof b?v(b):new Date(b)),new e(d))},B.utc=function(a,b){return j(a)?new e(l(a,!0),!0):("string"!=typeof a||S.exec(a)||(a+=" +0000",b&&(b+=" Z")),B(a,b).utc())},B.unix=function(a){return B(1e3*a)},B.duration=function(a,b){var c,d=B.isDuration(a),e="number"==typeof a,g=d?a._data:e?{}:a;return e&&(b?g[b]=a:g.milliseconds=a),c=new f(g),d&&(c._lang=a._lang),c},B.humanizeDuration=function(a,b,c){return B.duration(a,b===!0?null:b).humanize(b===!0?!0:c)},B.version=D,B.defaultFormat=V,B.lang=function(a,b){var c;if(!a)return G;if((b||!F[a])&&m(a,b),F[a]){for(c=0;c<I.length;c++)B[I[c]]=F[a][I[c]];B.monthsParse=F[a].monthsParse,G=a}},B.langData=n,B.isMoment=function(a){return a instanceof e},B.isDuration=function(a){return a instanceof f},B.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return 1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th"}}),B.fn=e.prototype={clone:function(){return B(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?null!=this._a[8]?!!this._a[8]:!k(this._a,(this._a[7]?B.utc(this._a):B(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return q(this,a?a:B.defaultFormat)},add:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return i(this,c,1),this},subtract:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return i(this,c,-1),this},diff:function(a,b,c){var d,e=this._isUTC?B(a).utc():B(a).local(),f=6e4*(this.zone()-e.zone()),g=this._d-e._d-f,h=this.year()-e.year(),i=this.month()-e.month(),j=this.date()-e.date();return d="months"===b?12*h+i+j/30:"years"===b?h+(i+j/30)/12:"seconds"===b?g/1e3:"minutes"===b?g/6e4:"hours"===b?g/36e5:"days"===b?g/864e5:"weeks"===b?g/6048e5:g,c?d:E(d)},from:function(a,b){return B.duration(this.diff(a)).lang(this._lang).humanize(!b)},fromNow:function(a){return this.from(B(),a)},calendar:function(){var a=this.diff(B().sod(),"days",!0),b=this.lang().calendar,c=b.sameElse,d=-6>a?c:-1>a?b.lastWeek:0>a?b.lastDay:1>a?b.sameDay:2>a?b.nextDay:7>a?b.nextWeek:c;return this.format("function"==typeof d?d.apply(this):d)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<B([this.year()]).zone()||this.zone()<B([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==a?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return B.utc([this.year(),this.month()+1,0]).date()},lang:function(b){return b===a?n(this):(this._lang=b,this)}},C=0;C<Y.length;C++)y(Y[C].toLowerCase(),Y[C]);y("year","FullYear"),B.duration.fn=f.prototype={weeks:function(){return g(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*this._months},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=x(b,!a,this.lang()),e=0>=b?c.past:c.future;return a&&(d="function"==typeof e?e(d):e.replace(/%s/i,d)),d},lang:B.fn.lang};for(C in Z)Z.hasOwnProperty(C)&&(A(C,Z[C]),z(C.toLowerCase()));A("Weeks",6048e5),H&&(module.exports=B),"undefined"==typeof ender&&(this.moment=B),"function"==typeof define&&define.amd&&define("moment",[],function(){return B})}.call(this),/*! iScroll v5.0.9 ~ (c) 2008-2013 Matteo Spinelli ~ http://cubiq.org/license */
function(a,b,c){function d(a,d){this.wrapper="string"==typeof a?b.querySelector(a):a,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={zoomMin:1,zoomMax:4,startZoom:1,resizeIndicator:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var e in d)this.options[e]=d[e];this.translateZ=this.options.HWCompositing&&h.hasPerspective?" translateZ(0)":"",this.options.useTransition=h.hasTransition&&this.options.useTransition,this.options.useTransform=h.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?h.ease[this.options.bounceEasing]||h.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this.scale=c.min(c.max(this.options.startZoom,this.options.zoomMin),this.options.zoomMax),this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function e(a,c,d){var e=b.createElement("div"),f=b.createElement("div");return d===!0&&(e.style.cssText="position:absolute;z-index:9999",f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),f.className="iScrollIndicator","h"==a?(d===!0&&(e.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",f.style.height="100%"),e.className="iScrollHorizontalScrollbar"):(d===!0&&(e.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",f.style.width="100%"),e.className="iScrollVerticalScrollbar"),e.style.cssText+=";overflow:hidden",c||(e.style.pointerEvents="none"),e.appendChild(f),e}function f(c,d){this.wrapper="string"==typeof d.el?b.querySelector(d.el):d.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=c,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var e in d)this.options[e]=d[e];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(h.addEvent(this.indicator,"touchstart",this),h.addEvent(a,"touchend",this)),this.options.disablePointer||(h.addEvent(this.indicator,"MSPointerDown",this),h.addEvent(a,"MSPointerUp",this)),this.options.disableMouse||(h.addEvent(this.indicator,"mousedown",this),h.addEvent(a,"mouseup",this))),this.options.fade&&(this.wrapperStyle[h.style.transform]=this.scroller.translateZ,this.wrapperStyle[h.style.transitionDuration]=h.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var g=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},h=function(){function d(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}var e={},f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}();e.getTime=Date.now||function(){return(new Date).getTime()},e.extend=function(a,b){for(var c in b)a[c]=b[c]},e.addEvent=function(a,b,c,d){a.addEventListener(b,c,!!d)},e.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,!!d)},e.momentum=function(a,b,d,e,f){var g,h,i=a-b,j=c.abs(i)/d,k=6e-4;return g=a+j*j/(2*k)*(0>i?-1:1),h=j/k,e>g?(g=f?e-f/2.5*(j/8):e,i=c.abs(g-a),h=i/j):g>0&&(g=f?f/2.5*(j/8):0,i=c.abs(a)+g,h=i/j),{destination:c.round(g),duration:h}};var h=d("transform");return e.extend(e,{hasTransform:h!==!1,hasPerspective:d("perspective")in f,hasTouch:"ontouchstart"in a,hasPointer:navigator.msPointerEnabled,hasTransition:d("transition")in f}),e.isBadAndroid=/Android/.test(a.navigator.appVersion)&&!/Chrome\/\d/.test(a.navigator.appVersion),e.extend(e.style={},{transform:h,transitionTimingFunction:d("transitionTimingFunction"),transitionDuration:d("transitionDuration"),transitionDelay:d("transitionDelay"),transformOrigin:d("transformOrigin")}),e.hasClass=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},e.addClass=function(a,b){if(!e.hasClass(a,b)){var c=a.className.split(" ");c.push(b),a.className=c.join(" ")}},e.removeClass=function(a,b){if(e.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ")}},e.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},e.preventDefaultException=function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1},e.extend(e.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),e.extend(e.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(a){return c.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){var b=4;return(a-=1)*a*((b+1)*a+b)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:"",fn:function(a){var b=.22,d=.4;return 0===a?0:1==a?1:d*c.pow(2,-10*a)*c.sin((a-b/4)*(2*c.PI)/b)+1}}}),e.tap=function(a,c){var d=b.createEvent("Event");d.initEvent(c,!0,!0),d.pageX=a.pageX,d.pageY=a.pageY,a.target.dispatchEvent(d)},e.click=function(a){var c,d=a.target;"SELECT"!=d.tagName&&"INPUT"!=d.tagName&&"TEXTAREA"!=d.tagName&&(c=b.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),c._constructed=!0,d.dispatchEvent(c))},e}();d.prototype={version:"5.0.9",_init:function(){this._initEvents(),this.options.zoom&&this._initZoom(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(a){a.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(a){if((1==h.eventType[a.type]||0===a.button)&&this.enabled&&(!this.initiated||h.eventType[a.type]===this.initiated)){!this.options.preventDefault||h.isBadAndroid||h.preventDefaultException(a.target,this.options.preventDefaultException)||a.preventDefault();var b,d=a.touches?a.touches[0]:a;this.initiated=h.eventType[a.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=h.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=d.pageX,this.pointY=d.pageY,this._execEvent("beforeScrollStart")}},_move:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,f,g=a.touches?a.touches[0]:a,i=g.pageX-this.pointX,j=g.pageY-this.pointY,k=h.getTime();if(this.pointX=g.pageX,this.pointY=g.pageY,this.distX+=i,this.distY+=j,e=c.abs(this.distX),f=c.abs(this.distY),!(k-this.endTime>300&&10>e&&10>f)){if(this.directionLocked||this.options.freeScroll||(e>f+this.options.directionLockThreshold?this.directionLocked="h":f>=e+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)a.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);j=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)a.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);i=0}i=this.hasHorizontalScroll?i:0,j=this.hasVerticalScroll?j:0,b=this.x+i,d=this.y+j,(b>0||b<this.maxScrollX)&&(b=this.options.bounce?this.x+i/3:b>0?0:this.maxScrollX),(d>0||d<this.maxScrollY)&&(d=this.options.bounce?this.y+j/3:d>0?0:this.maxScrollY),this.directionX=i>0?-1:0>i?1:0,this.directionY=j>0?-1:0>j?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(b,d),k-this.startTime>300&&(this.startTime=k,this.startX=this.x,this.startY=this.y)}}},_end:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&!h.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var b,d,e=(a.changedTouches?a.changedTouches[0]:a,h.getTime()-this.startTime),f=c.round(this.x),g=c.round(this.y),i=c.abs(f-this.startX),j=c.abs(g-this.startY),k=0,l="";if(this.isInTransition=0,this.initiated=0,this.endTime=h.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(f,g),!this.moved)return this.options.tap&&h.tap(a,this.options.tap),this.options.click&&h.click(a),void this._execEvent("scrollCancel");if(this._events.flick&&200>e&&100>i&&100>j)return void this._execEvent("flick");if(this.options.momentum&&300>e&&(b=this.hasHorizontalScroll?h.momentum(this.x,this.startX,e,this.maxScrollX,this.options.bounce?this.wrapperWidth:0):{destination:f,duration:0},d=this.hasVerticalScroll?h.momentum(this.y,this.startY,e,this.maxScrollY,this.options.bounce?this.wrapperHeight:0):{destination:g,duration:0},f=b.destination,g=d.destination,k=c.max(b.duration,d.duration),this.isInTransition=1),this.options.snap){var m=this._nearestSnap(f,g);this.currentPage=m,k=this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-m.x),1e3),c.min(c.abs(g-m.y),1e3)),300),f=m.x,g=m.y,this.directionX=0,this.directionY=0,l=this.options.bounceEasing}return f!=this.x||g!=this.y?((f>0||f<this.maxScrollX||g>0||g<this.maxScrollY)&&(l=h.ease.quadratic),void this.scrollTo(f,g,k,l)):void this._execEvent("scrollEnd")}}},_resize:function(){var a=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,c=this.y;return a=a||0,!this.hasHorizontalScroll||this.x>0?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX),!this.hasVerticalScroll||this.y>0?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY),b==this.x&&c==this.y?!1:(this.scrollTo(b,c,a,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=c.round(this.scroller.offsetWidth*this.scale),this.scrollerHeight=c.round(this.scroller.offsetHeight*this.scale),this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=h.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(a,b){this._events[a]||(this._events[a]=[]),this._events[a].push(b)},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;c>b;b++)this._events[a][b].call(this)}},scrollBy:function(a,b,c,d){a=this.x+a,b=this.y+b,c=c||0,this.scrollTo(a,b,c,d)},scrollTo:function(a,b,c,d){d=d||h.ease.circular,this.isInTransition=this.options.useTransition&&c>0,!c||this.options.useTransition&&d.style?(this._transitionTimingFunction(d.style),this._transitionTime(c),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,b,d,e,f){if(a=a.nodeType?a:this.scroller.querySelector(a)){var g=h.offset(a);g.left-=this.wrapperOffset.left,g.top-=this.wrapperOffset.top,d===!0&&(d=c.round(a.offsetWidth/2-this.wrapper.offsetWidth/2)),e===!0&&(e=c.round(a.offsetHeight/2-this.wrapper.offsetHeight/2)),g.left-=d||0,g.top-=e||0,g.left=g.left>0?0:g.left<this.maxScrollX?this.maxScrollX:g.left,g.top=g.top>0?0:g.top<this.maxScrollY?this.maxScrollY:g.top,b=void 0===b||null===b||"auto"===b?c.max(c.abs(this.x-g.left),c.abs(this.y-g.top)):b,this.scrollTo(g.left,g.top,b,f)}},_transitionTime:function(a){if(a=a||0,this.scrollerStyle[h.style.transitionDuration]=a+"ms",!a&&h.isBadAndroid&&(this.scrollerStyle[h.style.transitionDuration]="0.001s"),this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTime(a)},_transitionTimingFunction:function(a){if(this.scrollerStyle[h.style.transitionTimingFunction]=a,this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTimingFunction(a)},_translate:function(a,b){if(this.options.useTransform?this.scrollerStyle[h.style.transform]="translate("+a+"px,"+b+"px) scale("+this.scale+") "+this.translateZ:(a=c.round(a),b=c.round(b),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=b+"px"),this.x=a,this.y=b,this.indicators)for(var d=this.indicators.length;d--;)this.indicators[d].updatePosition()},_initEvents:function(b){var c=b?h.removeEvent:h.addEvent,d=this.options.bindToWrapper?this.wrapper:a;c(a,"orientationchange",this),c(a,"resize",this),this.options.click&&c(this.wrapper,"click",this,!0),this.options.disableMouse||(c(this.wrapper,"mousedown",this),c(d,"mousemove",this),c(d,"mousecancel",this),c(d,"mouseup",this)),h.hasPointer&&!this.options.disablePointer&&(c(this.wrapper,"MSPointerDown",this),c(d,"MSPointerMove",this),c(d,"MSPointerCancel",this),c(d,"MSPointerUp",this)),h.hasTouch&&!this.options.disableTouch&&(c(this.wrapper,"touchstart",this),c(d,"touchmove",this),c(d,"touchcancel",this),c(d,"touchend",this)),c(this.scroller,"transitionend",this),c(this.scroller,"webkitTransitionEnd",this),c(this.scroller,"oTransitionEnd",this),c(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var b,c,d=a.getComputedStyle(this.scroller,null);return this.options.useTransform?(d=d[h.style.transform].split(")")[0].split(", "),b=+(d[12]||d[4]),c=+(d[13]||d[5])):(b=+d.left.replace(/[^-\d.]/g,""),c=+d.top.replace(/[^-\d.]/g,"")),{x:b,y:c}},_initIndicators:function(){function a(a){for(var b=h.indicators.length;b--;)a.call(h.indicators[b])}var b,c=this.options.interactiveScrollbars,d=("object"!=typeof this.options.scrollbars,"string"!=typeof this.options.scrollbars),g=[],h=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(b={el:e("v",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeIndicator,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(b.el),g.push(b)),this.options.scrollX&&(b={el:e("h",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeIndicator,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(b.el),g.push(b))),this.options.indicators&&(g=g.concat(this.options.indicators));for(var i=g.length;i--;)this.indicators.push(new f(this,g[i]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){a(function(){this.fade()})}),this.on("scrollCancel",function(){a(function(){this.fade()})}),this.on("scrollStart",function(){a(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){a(function(){this.fade(1,!0)})})),this.on("refresh",function(){a(function(){this.refresh()})}),this.on("destroy",function(){a(function(){this.destroy()}),delete this.indicators})},_initZoom:function(){this.scrollerStyle[h.style.transformOrigin]="0 0"},_zoomStart:function(a){var b=c.abs(a.touches[0].pageX-a.touches[1].pageX),d=c.abs(a.touches[0].pageY-a.touches[1].pageY);this.touchesDistanceStart=c.sqrt(b*b+d*d),this.startScale=this.scale,this.originX=c.abs(a.touches[0].pageX+a.touches[1].pageX)/2+this.wrapperOffset.left-this.x,this.originY=c.abs(a.touches[0].pageY+a.touches[1].pageY)/2+this.wrapperOffset.top-this.y,this._execEvent("zoomStart")},_zoom:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,f=c.abs(a.touches[0].pageX-a.touches[1].pageX),g=c.abs(a.touches[0].pageY-a.touches[1].pageY),i=c.sqrt(f*f+g*g),j=1/this.touchesDistanceStart*i*this.startScale;this.scaled=!0,j<this.options.zoomMin?j=.5*this.options.zoomMin*c.pow(2,j/this.options.zoomMin):j>this.options.zoomMax&&(j=2*this.options.zoomMax*c.pow(.5,this.options.zoomMax/j)),b=j/this.startScale,d=this.originX-this.originX*b+this.startX,e=this.originY-this.originY*b+this.startY,this.scale=j,this.scrollTo(d,e,0)}},_zoomEnd:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,c,d;this.isInTransition=0,this.initiated=0,this.scale>this.options.zoomMax?this.scale=this.options.zoomMax:this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin),this.refresh(),d=this.scale/this.startScale,b=this.originX-this.originX*d+this.startX,c=this.originY-this.originY*d+this.startY,b>0?b=0:b<this.maxScrollX&&(b=this.maxScrollX),c>0?c=0:c<this.maxScrollY&&(c=this.maxScrollY),(this.x!=b||this.y!=c)&&this.scrollTo(b,c,this.options.bounceTime),this.scaled=!1,this._execEvent("zoomEnd")}},zoom:function(a,b,c,d){if(a<this.options.zoomMin?a=this.options.zoomMin:a>this.options.zoomMax&&(a=this.options.zoomMax),a!=this.scale){var e=a/this.scale;b=void 0===b?this.wrapperWidth/2:b,c=void 0===c?this.wrapperHeight/2:c,d=void 0===d?300:d,b=b+this.wrapperOffset.left-this.x,c=c+this.wrapperOffset.top-this.y,b=b-b*e+this.x,c=c-c*e+this.y,this.scale=a,this.refresh(),b>0?b=0:b<this.maxScrollX&&(b=this.maxScrollX),c>0?c=0:c<this.maxScrollY&&(c=this.maxScrollY),this.scrollTo(b,c,d)}},_wheelZoom:function(a){var b,d,e=this;if(clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){e._execEvent("zoomEnd")},400),"deltaX"in a)b=-a.deltaY/c.abs(a.deltaY);else if("wheelDeltaX"in a)b=a.wheelDeltaY/c.abs(a.wheelDeltaY);else if("wheelDelta"in a)b=a.wheelDelta/c.abs(a.wheelDelta);else{if(!("detail"in a))return;b=-a.detail/c.abs(a.wheelDelta)}d=this.scale+b/5,this.zoom(d,a.pageX,a.pageY,0)},_initWheel:function(){h.addEvent(this.wrapper,"wheel",this),h.addEvent(this.wrapper,"mousewheel",this),h.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){h.removeEvent(this.wrapper,"wheel",this),h.removeEvent(this.wrapper,"mousewheel",this),h.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){a.preventDefault(),a.stopPropagation();var b,d,e,f,g=this;if(void 0===this.wheelTimeout&&g._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){g._execEvent("scrollEnd"),g.wheelTimeout=void 0},400),"deltaX"in a)b=-a.deltaX,d=-a.deltaY;else if("wheelDeltaX"in a)b=a.wheelDeltaX/120*this.options.mouseWheelSpeed,d=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in a)b=d=a.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in a))return;b=d=-a.detail/3*this.options.mouseWheelSpeed}if(b*=this.options.invertWheelDirection,d*=this.options.invertWheelDirection,this.hasVerticalScroll||(b=d,d=0),this.options.snap)return e=this.currentPage.pageX,f=this.currentPage.pageY,b>0?e--:0>b&&e++,d>0?f--:0>d&&f++,void this.goToPage(e,f);e=this.x+c.round(this.hasHorizontalScroll?b:0),f=this.y+c.round(this.hasVerticalScroll?d:0),e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),f>0?f=0:f<this.maxScrollY&&(f=this.maxScrollY),this.scrollTo(e,f,0)}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var a,b,d,e,f,g,h=0,i=0,j=0,k=this.options.snapStepX||this.wrapperWidth,l=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(this.options.snap===!0)for(d=c.round(k/2),e=c.round(l/2);j>-this.scrollerWidth;){for(this.pages[h]=[],a=0,f=0;f>-this.scrollerHeight;)this.pages[h][a]={x:c.max(j,this.maxScrollX),y:c.max(f,this.maxScrollY),width:k,height:l,cx:j-d,cy:f-e},f-=l,a++;j-=k,h++}else for(g=this.options.snap,a=g.length,b=-1;a>h;h++)(0===h||g[h].offsetLeft<=g[h-1].offsetLeft)&&(i=0,b++),this.pages[i]||(this.pages[i]=[]),j=c.max(-g[h].offsetLeft,this.maxScrollX),f=c.max(-g[h].offsetTop,this.maxScrollY),d=j-c.round(g[h].offsetWidth/2),e=f-c.round(g[h].offsetHeight/2),this.pages[i][b]={x:j,y:f,width:g[h].offsetWidth,height:g[h].offsetHeight,cx:d,cy:e},j>this.maxScrollX&&i++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var a=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.x-this.startX),1e3),c.min(c.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,a)})},_nearestSnap:function(a,b){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var d=0,e=this.pages.length,f=0;if(c.abs(a-this.absStartX)<this.snapThresholdX&&c.abs(b-this.absStartY)<this.snapThresholdY)return this.currentPage;for(a>0?a=0:a<this.maxScrollX&&(a=this.maxScrollX),b>0?b=0:b<this.maxScrollY&&(b=this.maxScrollY);e>d;d++)if(a>=this.pages[d][0].cx){a=this.pages[d][0].x;break}for(e=this.pages[d].length;e>f;f++)if(b>=this.pages[0][f].cy){b=this.pages[0][f].y;break}return d==this.currentPage.pageX&&(d+=this.directionX,0>d?d=0:d>=this.pages.length&&(d=this.pages.length-1),a=this.pages[d][0].x),f==this.currentPage.pageY&&(f+=this.directionY,0>f?f=0:f>=this.pages[0].length&&(f=this.pages[0].length-1),b=this.pages[0][f].y),{x:a,y:b,pageX:d,pageY:f}},goToPage:function(a,b,d,e){e=e||this.options.bounceEasing,a>=this.pages.length?a=this.pages.length-1:0>a&&(a=0),b>=this.pages[a].length?b=this.pages[a].length-1:0>b&&(b=0);var f=this.pages[a][b].x,g=this.pages[a][b].y;d=void 0===d?this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-this.x),1e3),c.min(c.abs(g-this.y),1e3)),300):d,this.currentPage={x:f,y:g,pageX:a,pageY:b},this.scrollTo(f,g,d,e)},next:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c++,c>=this.pages.length&&this.hasVerticalScroll&&(c=0,d++),this.goToPage(c,d,a,b)},prev:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c--,0>c&&this.hasVerticalScroll&&(c=0,d--),this.goToPage(c,d,a,b)},_initKeys:function(b){var c,d={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(c in this.options.keyBindings)"string"==typeof this.options.keyBindings[c]&&(this.options.keyBindings[c]=this.options.keyBindings[c].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(c in d)this.options.keyBindings[c]=this.options.keyBindings[c]||d[c];h.addEvent(a,"keydown",this),this.on("destroy",function(){h.removeEvent(a,"keydown",this)})},_key:function(a){if(this.enabled){var b,d=this.options.snap,e=d?this.currentPage.pageX:this.x,f=d?this.currentPage.pageY:this.y,g=h.getTime(),i=this.keyTime||0,j=.25;switch(this.options.useTransition&&this.isInTransition&&(b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this.isInTransition=!1),this.keyAcceleration=200>g-i?c.min(this.keyAcceleration+j,50):0,a.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?e+=d?1:this.wrapperWidth:f+=d?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?e-=d?1:this.wrapperWidth:f-=d?1:this.wrapperHeight;break;case this.options.keyBindings.end:e=d?this.pages.length-1:this.maxScrollX,f=d?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:e=0,f=0;break;case this.options.keyBindings.left:e+=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:f+=d?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:e-=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:f-=d?1:5+this.keyAcceleration>>0;break;default:return}if(d)return void this.goToPage(e,f);e>0?(e=0,this.keyAcceleration=0):e<this.maxScrollX&&(e=this.maxScrollX,this.keyAcceleration=0),f>0?(f=0,this.keyAcceleration=0):f<this.maxScrollY&&(f=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(e,f,0),this.keyTime=g}},_animate:function(a,b,c,d){function e(){var m,n,o,p=h.getTime();return p>=l?(f.isAnimating=!1,f._translate(a,b),void(f.resetPosition(f.options.bounceTime)||f._execEvent("scrollEnd"))):(p=(p-k)/c,o=d(p),m=(a-i)*o+i,n=(b-j)*o+j,f._translate(m,n),void(f.isAnimating&&g(e)))}var f=this,i=this.x,j=this.y,k=h.getTime(),l=k+c;this.isAnimating=!0,e()},handleEvent:function(a){switch(a.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(a),this.options.zoom&&a.touches&&a.touches.length>1&&this._zoomStart(a);break;case"touchmove":case"MSPointerMove":case"mousemove":if(this.options.zoom&&a.touches&&a.touches[1])return void this._zoom(a);this._move(a);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":if(this.scaled)return void this._zoomEnd(a);this._end(a);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(a);break;case"wheel":case"DOMMouseScroll":case"mousewheel":if("zoom"==this.options.wheelAction)return void this._wheelZoom(a);this._wheel(a);break;case"keydown":this._key(a)}}},f.prototype={handleEvent:function(a){switch(a.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(a);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(a);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(a)}},destroy:function(){this.options.interactive&&(h.removeEvent(this.indicator,"touchstart",this),h.removeEvent(this.indicator,"MSPointerDown",this),h.removeEvent(this.indicator,"mousedown",this),h.removeEvent(a,"touchmove",this),h.removeEvent(a,"MSPointerMove",this),h.removeEvent(a,"mousemove",this),h.removeEvent(a,"touchend",this),h.removeEvent(a,"MSPointerUp",this),h.removeEvent(a,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(b){var c=b.touches?b.touches[0]:b;b.preventDefault(),b.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=c.pageX,this.lastPointY=c.pageY,this.startTime=h.getTime(),this.options.disableTouch||h.addEvent(a,"touchmove",this),this.options.disablePointer||h.addEvent(a,"MSPointerMove",this),this.options.disableMouse||h.addEvent(a,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(a){var b,c,d,e,f=a.touches?a.touches[0]:a;h.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,b=f.pageX-this.lastPointX,this.lastPointX=f.pageX,c=f.pageY-this.lastPointY,this.lastPointY=f.pageY,d=this.x+b,e=this.y+c,this._pos(d,e),a.preventDefault(),a.stopPropagation()},_end:function(b){if(this.initiated){if(this.initiated=!1,b.preventDefault(),b.stopPropagation(),h.removeEvent(a,"touchmove",this),h.removeEvent(a,"MSPointerMove",this),h.removeEvent(a,"mousemove",this),this.scroller.options.snap){var d=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),e=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.scroller.x-d.x),1e3),c.min(c.abs(this.scroller.y-d.y),1e3)),300);(this.scroller.x!=d.x||this.scroller.y!=d.y)&&(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=d,this.scroller.scrollTo(d.x,d.y,e,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(a){a=a||0,this.indicatorStyle[h.style.transitionDuration]=a+"ms",!a&&h.isBadAndroid&&(this.indicatorStyle[h.style.transitionDuration]="0.001s")},transitionTimingFunction:function(a){this.indicatorStyle[h.style.transitionTimingFunction]=a},refresh:function(){this.transitionTime(),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(h.addClass(this.wrapper,"iScrollBothScrollbars"),h.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(h.removeClass(this.wrapper,"iScrollBothScrollbars"),h.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=c.max(c.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=c.max(c.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,
this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var a=this.options.listenX&&c.round(this.sizeRatioX*this.scroller.x)||0,b=this.options.listenY&&c.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(a<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=c.max(this.indicatorWidth+a,8),this.indicatorStyle.width=this.width+"px"),a=this.minBoundaryX):a>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=c.max(this.indicatorWidth-(a-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",a=this.maxPosX+this.indicatorWidth-this.width):a=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),b<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=c.max(this.indicatorHeight+3*b,8),this.indicatorStyle.height=this.height+"px"),b=this.minBoundaryY):b>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=c.max(this.indicatorHeight-3*(b-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",b=this.maxPosY+this.indicatorHeight-this.height):b=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=a,this.y=b,this.scroller.options.useTransform?this.indicatorStyle[h.style.transform]="translate("+a+"px,"+b+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=a+"px",this.indicatorStyle.top=b+"px")},_pos:function(a,b){0>a?a=0:a>this.maxPosX&&(a=this.maxPosX),0>b?b=0:b>this.maxPosY&&(b=this.maxPosY),a=this.options.listenX?c.round(a/this.sizeRatioX):this.scroller.x,b=this.options.listenY?c.round(b/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(a,b)},fade:function(a,b){if(!b||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var c=a?250:500,d=a?0:300;a=a?"1":"0",this.wrapperStyle[h.style.transitionDuration]=c+"ms",this.fadeTimeout=setTimeout(function(a){this.wrapperStyle.opacity=a,this.visible=+a}.bind(this,a),d)}}},d.utils=h,"undefined"!=typeof module&&module.exports?module.exports=d:a.IScroll=d}(window,document,Math),/*
 *  jQuery dotdotdot 1.6.13
 *
 *  Copyright (c) Fred Heusschen
 *  www.frebsite.nl
 *
 *  Plugin website:
 *  dotdotdot.frebsite.nl
 *
 *  Dual licensed under the MIT and GPL licenses.
 *  http://en.wikipedia.org/wiki/MIT_License
 *  http://en.wikipedia.org/wiki/GNU_General_Public_License
 */
window.Zepto&&!function(a){var b=function(a,b){return function(c){var d,e,f;return this?(f=this,e=f[a](),d={width:["left","right"],height:["top","bottom"]},d[a].forEach(function(a){e+=parseInt(f.css("padding-"+a),10),b&&(e+=parseInt(f.css("border-"+a+"-width"),10)),c&&(e+=parseInt(f.css("margin-"+a),10))}),e):null}};["width","height"].forEach(function(c){var d=c.substr(0,1).toUpperCase()+c.substr(1);a.fn["inner"+d]=b(c,!1),a.fn["outer"+d]=b(c,!0)})}(Zepto),function(a,b){function c(a,b,c){var d=a.children(),e=!1;a.empty();for(var g=0,h=d.length;h>g;g++){var i=d.eq(g);if(a.append(i),c&&a.append(c),f(a,b)){i.remove(),e=!0;break}c&&c.detach()}return e}function d(b,c,g,h,i){var j=!1,k="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",l="script";return b.contents().detach().each(function(){var m=this,n=a(m);if("undefined"==typeof m||3==m.nodeType&&0==a.trim(m.data).length)return!0;if(n.is(l))b.append(n);else{if(j)return!0;b.append(n),i&&b[b.is(k)?"after":"append"](i),f(g,h)&&(j=3==m.nodeType?e(n,c,g,h,i):d(n,c,g,h,i),j||(n.detach(),j=!0)),j||i&&i.detach()}}),j}function e(b,c,d,e,h){var k=b[0];if(!k)return!1;var m=j(k),n=-1!==m.indexOf(" ")?" ":"　",o="letter"==e.wrap?"":n,p=m.split(o),q=-1,r=-1,s=0,t=p.length-1;for(e.fallbackToLetter&&0==s&&0==t&&(o="",p=m.split(o),t=p.length-1);t>=s&&(0!=s||0!=t);){var u=Math.floor((s+t)/2);if(u==r)break;r=u,i(k,p.slice(0,r+1).join(o)+e.ellipsis),f(d,e)?(t=r,e.fallbackToLetter&&0==s&&0==t&&(o="",p=p[0].split(o),q=-1,r=-1,s=0,t=p.length-1)):(q=r,s=r)}if(-1==q||1==p.length&&0==p[0].length){var v=b.parent();b.detach();var w=h&&h.closest(v).length?h.length:0;v.contents().length>w?k=l(v.contents().eq(-1-w),c):(k=l(v,c,!0),w||v.detach()),k&&(m=g(j(k),e),i(k,m),w&&h&&a(k).parent().append(h))}else m=g(p.slice(0,q+1).join(o),e),i(k,m);return!0}function f(a,b){return a.innerHeight()>b.maxHeight}function g(b,c){for(;a.inArray(b.slice(-1),c.lastCharacter.remove)>-1;)b=b.slice(0,-1);return a.inArray(b.slice(-1),c.lastCharacter.noEllipsis)<0&&(b+=c.ellipsis),b}function h(a){return{width:a.innerWidth(),height:a.innerHeight()}}function i(a,b){a.innerText?a.innerText=b:a.nodeValue?a.nodeValue=b:a.textContent&&(a.textContent=b)}function j(a){return a.innerText?a.innerText:a.nodeValue?a.nodeValue:a.textContent?a.textContent:""}function k(a){do a=a.previousSibling;while(a&&1!==a.nodeType&&3!==a.nodeType);return a}function l(b,c,d){var e,f=b&&b[0];if(f){if(!d){if(3===f.nodeType)return f;if(a.trim(b.text()))return l(b.contents().last(),c)}for(e=k(f);!e;){if(b=b.parent(),b.is(c)||!b.length)return!1;e=k(b[0])}if(e)return l(a(e),c)}return!1}function m(b,c){return b?"string"==typeof b?(b=a(b,c),b.length?b:!1):b.jquery?b:!1:!1}function n(a){return a.outerHeight()}if(!a.fn.dotdotdot){a.fn.dotdotdot=function(b){if(0==this.length)return a.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){a(this).dotdotdot(b)});var e=this;e.data("dotdotdot")&&e.trigger("destroy_dot"),e.data("dotdotdot-style",e.attr("style")||""),e.css("word-wrap","break-word"),"nowrap"===e.css("white-space")&&e.css("white-space","normal"),e.bind_events=function(){return e.bind("update_dot",function(b,h){b.preventDefault(),b.stopPropagation(),i.maxHeight="number"==typeof i.height?i.height:n(e),i.maxHeight+=i.tolerance,"undefined"!=typeof h&&(("string"==typeof h||h instanceof HTMLElement)&&(h=a("<div />").append(h).contents()),h instanceof a&&(g=h)),p=e.wrapInner('<div class="dotdotdot" />').children(),p.empty().append(g.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var k=!1,l=!1;return j.afterElement&&(k=j.afterElement.clone(!0),k.show(),j.afterElement.detach()),f(p,i)&&(l="children"==i.wrap?c(p,i,k):d(p,e,p,i,k)),p.replaceWith(p.contents()),p=null,a.isFunction(i.callback)&&i.callback.call(e[0],l,g),j.isTruncated=l,l}).bind("isTruncated_dot",function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(e[0],j.isTruncated),j.isTruncated}).bind("originalContent_dot",function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(e[0],g),g}).bind("destroy_dot",function(a){a.preventDefault(),a.stopPropagation(),e.unwatch().unbind_events().empty().append(g).data("dotdotdot",!1)}),e},e.unbind_events=function(){return e.unbind("update_dot isTruncated_dot originalContent_dot destroy_dot"),e},e.watch=function(){if(e.unwatch(),"window"==i.watch){var b=a(window),c=b.width(),d=b.height();b.bind("resize_dot"+j.dotId,function(){c==b.width()&&d==b.height()&&i.windowResizeFix||(c=b.width(),d=b.height(),l&&clearInterval(l),l=setTimeout(function(){e.trigger("update_dot")},10))})}else k=h(e),l=setInterval(function(){var a=h(e);(k.width!=a.width||k.height!=a.height)&&(e.trigger("update_dot"),k=h(e))},100);return e},e.unwatch=function(){return a(window).unbind("resize_dot"+j.dotId),l&&clearInterval(l),e};var g=e.contents(),i=a.extend(!0,{},a.fn.dotdotdot.defaults,b),j={},k={},l=null,p=null;return i.lastCharacter.remove instanceof Array||(i.lastCharacter.remove=a.fn.dotdotdot.defaultArrays.lastCharacter.remove),i.lastCharacter.noEllipsis instanceof Array||(i.lastCharacter.noEllipsis=a.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),j.afterElement=m(i.after,e),j.isTruncated=!1,j.dotId=o++,e.data("dotdotdot",!0).bind_events().trigger("update_dot"),i.watch&&e.watch(),e},a.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},a.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}},a.fn.dotdotdot.debug=function(){};var o=1,p=a.fn.html;a.fn.html=function(c){return c!=b&&!a.isFunction(c)&&this.data("dotdotdot")?this.trigger("update",[c]):p.apply(this,arguments)};var q=a.fn.text;a.fn.text=function(c){return c!=b&&!a.isFunction(c)&&this.data("dotdotdot")?(c=a("<div />").text(c).html(),this.trigger("update",[c])):q.apply(this,arguments)}}}(window.jQuery||window.Zepto);/*!
 *
 * MediaElement.js
 * HTML5 <video> and <audio> shim and player
 * http://mediaelementjs.com/
 *
 * Creates a JavaScript object that mimics HTML5 MediaElement API
 * for browsers that don't understand HTML5 or can't play the provided codec
 * Can play MP4 (H.264), Ogg, WebM, FLV, WMV, WMA, ACC, and MP3
 *
 * Copyright 2010-2014, John Dyer (http://j.hn)
 * License: MIT
 *
 */
// Namespace
var mejs=mejs||{};mejs.version="2.22.0",mejs.meIndex=0,mejs.plugins={silverlight:[{version:[3,0],types:["video/mp4","video/m4v","video/mov","video/wmv","audio/wma","audio/m4a","audio/mp3","audio/wav","audio/mpeg"]}],flash:[{version:[9,0,124],types:["video/mp4","video/m4v","video/mov","video/flv","video/rtmp","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/m4a","audio/mpeg","video/dailymotion","video/x-dailymotion","application/x-mpegURL"]}],youtube:[{version:null,types:["video/youtube","video/x-youtube","audio/youtube","audio/x-youtube"]}],vimeo:[{version:null,types:["video/vimeo","video/x-vimeo"]}]},mejs.Utility={encodeUrl:function(a){return encodeURIComponent(a)},escapeHTML:function(a){return a.toString().split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},absolutizeUrl:function(a){var b=document.createElement("div");return b.innerHTML='<a href="'+this.escapeHTML(a)+'">x</a>',b.firstChild.href},getScriptPath:function(a){for(var b,c,d,e,f,g,h=0,i="",j="",k=document.getElementsByTagName("script"),l=k.length,m=a.length;l>h;h++){for(e=k[h].src,c=e.lastIndexOf("/"),c>-1?(g=e.substring(c+1),f=e.substring(0,c+1)):(g=e,f=""),b=0;m>b;b++)if(j=a[b],d=g.indexOf(j),d>-1){i=f;break}if(""!==i)break}return i},calculateTimeFormat:function(a,b,c){0>a&&(a=0),"undefined"==typeof c&&(c=25);var d=b.timeFormat,e=d[0],f=d[1]==d[0],g=f?2:1,h=":",i=Math.floor(a/3600)%24,j=Math.floor(a/60)%60,k=Math.floor(a%60),l=Math.floor((a%1*c).toFixed(3)),m=[[l,"f"],[k,"s"],[j,"m"],[i,"h"]];d.length<g&&(h=d[g]);for(var n=!1,o=0,p=m.length;p>o;o++)if(-1!==d.indexOf(m[o][1]))n=!0;else if(n){for(var q=!1,r=o;p>r;r++)if(m[r][0]>0){q=!0;break}if(!q)break;f||(d=e+d),d=m[o][1]+h+d,f&&(d=m[o][1]+d),e=m[o][1]}b.currentTimeFormat=d},twoDigitsString:function(a){return 10>a?"0"+a:String(a)},secondsToTimeCode:function(a,b){if(0>a&&(a=0),"object"!=typeof b){var c="m:ss";c=arguments[1]?"hh:mm:ss":c,c=arguments[2]?c+":ff":c,b={currentTimeFormat:c,framesPerSecond:arguments[3]||25}}var d=b.framesPerSecond;"undefined"==typeof d&&(d=25);var c=b.currentTimeFormat,e=Math.floor(a/3600)%24,f=Math.floor(a/60)%60,g=Math.floor(a%60),h=Math.floor((a%1*d).toFixed(3));lis=[[h,"f"],[g,"s"],[f,"m"],[e,"h"]];var j=c;for(i=0,len=lis.length;i<len;i++)j=j.replace(lis[i][1]+lis[i][1],this.twoDigitsString(lis[i][0])),j=j.replace(lis[i][1],lis[i][0]);return j},timeCodeToSeconds:function(a,b,c,d){"undefined"==typeof c?c=!1:"undefined"==typeof d&&(d=25);var e=a.split(":"),f=parseInt(e[0],10),g=parseInt(e[1],10),h=parseInt(e[2],10),i=0,j=0;return c&&(i=parseInt(e[3])/d),j=3600*f+60*g+h+i},convertSMPTEtoSeconds:function(a){if("string"!=typeof a)return!1;a=a.replace(",",".");var b=0,c=-1!=a.indexOf(".")?a.split(".")[1].length:0,d=1;a=a.split(":").reverse();for(var e=0;e<a.length;e++)d=1,e>0&&(d=Math.pow(60,e)),b+=Number(a[e])*d;return Number(b.toFixed(c))},removeSwf:function(a){var b=document.getElementById(a);b&&/object|embed/i.test(b.nodeName)&&(mejs.MediaFeatures.isIE?(b.style.display="none",function(){4==b.readyState?mejs.Utility.removeObjectInIE(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))},removeObjectInIE:function(a){var b=document.getElementById(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}},determineScheme:function(a){return a&&-1!=a.indexOf("://")?a.substr(0,a.indexOf("://")+3):"//"}},mejs.PluginDetector={hasPluginVersion:function(a,b){var c=this.plugins[a];return b[1]=b[1]||0,b[2]=b[2]||0,c[0]>b[0]||c[0]==b[0]&&c[1]>b[1]||c[0]==b[0]&&c[1]==b[1]&&c[2]>=b[2]?!0:!1},nav:window.navigator,ua:window.navigator.userAgent.toLowerCase(),plugins:[],addPlugin:function(a,b,c,d,e){this.plugins[a]=this.detectPlugin(b,c,d,e)},detectPlugin:function(a,b,c,d){var e,f,g,h=[0,0,0];if("undefined"!=typeof this.nav.plugins&&"object"==typeof this.nav.plugins[a]){if(e=this.nav.plugins[a].description,e&&("undefined"==typeof this.nav.mimeTypes||!this.nav.mimeTypes[b]||this.nav.mimeTypes[b].enabledPlugin))for(h=e.replace(a,"").replace(/^\s+/,"").replace(/\sr/gi,".").split("."),f=0;f<h.length;f++)h[f]=parseInt(h[f].match(/\d+/),10)}else if("undefined"!=typeof window.ActiveXObject)try{g=new ActiveXObject(c),g&&(h=d(g))}catch(i){}return h}},mejs.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",function(a){var b=[],c=a.GetVariable("$version");return c&&(c=c.split(" ")[1].split(","),b=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]),b}),mejs.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",function(a){var b=[0,0,0,0],c=function(a,b,c,d){for(;a.isVersionSupported(b[0]+"."+b[1]+"."+b[2]+"."+b[3]);)b[c]+=d;b[c]-=d};return c(a,b,0,1),c(a,b,1,1),c(a,b,2,1e4),c(a,b,2,1e3),c(a,b,2,100),c(a,b,2,10),c(a,b,2,1),c(a,b,3,1),b}),mejs.MediaFeatures={init:function(){var a,b,c=this,d=document,e=mejs.PluginDetector.nav,f=mejs.PluginDetector.ua.toLowerCase(),g=["source","track","audio","video"];c.isiPad=null!==f.match(/ipad/i),c.isiPhone=null!==f.match(/iphone/i),c.isiOS=c.isiPhone||c.isiPad,c.isAndroid=null!==f.match(/android/i),c.isBustedAndroid=null!==f.match(/android 2\.[12]/),c.isBustedNativeHTTPS="https:"===location.protocol&&(null!==f.match(/android [12]\./)||null!==f.match(/macintosh.* version.* safari/)),c.isIE=-1!=e.appName.toLowerCase().indexOf("microsoft")||null!==e.appName.toLowerCase().match(/trident/gi),c.isChrome=null!==f.match(/chrome/gi),c.isChromium=null!==f.match(/chromium/gi),c.isFirefox=null!==f.match(/firefox/gi),c.isWebkit=null!==f.match(/webkit/gi),c.isGecko=null!==f.match(/gecko/gi)&&!c.isWebkit&&!c.isIE,c.isOpera=null!==f.match(/opera/gi),c.hasTouch="ontouchstart"in window,c.svgAsImg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1");for(a=0;a<g.length;a++)b=document.createElement(g[a]);c.supportsMediaTag="undefined"!=typeof b.canPlayType||c.isBustedAndroid;try{b.canPlayType("video/mp4")}catch(h){c.supportsMediaTag=!1}c.supportsPointerEvents=function(){var a,b=document.createElement("x"),c=document.documentElement,d=window.getComputedStyle;return"pointerEvents"in b.style?(b.style.pointerEvents="auto",b.style.pointerEvents="x",c.appendChild(b),a=d&&"auto"===d(b,"").pointerEvents,c.removeChild(b),!!a):!1}(),c.hasFirefoxPluginMovingProblem=!1,c.hasiOSFullScreen="undefined"!=typeof b.webkitEnterFullscreen,c.hasNativeFullscreen="undefined"!=typeof b.requestFullscreen,c.hasWebkitNativeFullScreen="undefined"!=typeof b.webkitRequestFullScreen,c.hasMozNativeFullScreen="undefined"!=typeof b.mozRequestFullScreen,c.hasMsNativeFullScreen="undefined"!=typeof b.msRequestFullscreen,c.hasTrueNativeFullScreen=c.hasWebkitNativeFullScreen||c.hasMozNativeFullScreen||c.hasMsNativeFullScreen,c.nativeFullScreenEnabled=c.hasTrueNativeFullScreen,c.hasMozNativeFullScreen?c.nativeFullScreenEnabled=document.mozFullScreenEnabled:c.hasMsNativeFullScreen&&(c.nativeFullScreenEnabled=document.msFullscreenEnabled),c.isChrome&&(c.hasiOSFullScreen=!1),c.hasTrueNativeFullScreen&&(c.fullScreenEventName="",c.hasWebkitNativeFullScreen?c.fullScreenEventName="webkitfullscreenchange":c.hasMozNativeFullScreen?c.fullScreenEventName="mozfullscreenchange":c.hasMsNativeFullScreen&&(c.fullScreenEventName="MSFullscreenChange"),c.isFullScreen=function(){return c.hasMozNativeFullScreen?d.mozFullScreen:c.hasWebkitNativeFullScreen?d.webkitIsFullScreen:c.hasMsNativeFullScreen?null!==d.msFullscreenElement:void 0},c.requestFullScreen=function(a){c.hasWebkitNativeFullScreen?a.webkitRequestFullScreen():c.hasMozNativeFullScreen?a.mozRequestFullScreen():c.hasMsNativeFullScreen&&a.msRequestFullscreen()},c.cancelFullScreen=function(){c.hasWebkitNativeFullScreen?document.webkitCancelFullScreen():c.hasMozNativeFullScreen?document.mozCancelFullScreen():c.hasMsNativeFullScreen&&document.msExitFullscreen()}),c.hasiOSFullScreen&&f.match(/mac os x 10_5/i)&&(c.hasNativeFullScreen=!1,c.hasiOSFullScreen=!1)}},mejs.MediaFeatures.init(),mejs.HtmlMediaElement={pluginType:"native",isFullScreen:!1,setCurrentTime:function(a){this.currentTime=a},setMuted:function(a){this.muted=a},setVolume:function(a){this.volume=a},stop:function(){this.pause()},setSrc:function(a){for(var b=this.getElementsByTagName("source");b.length>0;)this.removeChild(b[0]);if("string"==typeof a)this.src=a;else{var c,d;for(c=0;c<a.length;c++)if(d=a[c],this.canPlayType(d.type)){this.src=d.src;break}}},setVideoSize:function(a,b){this.width=a,this.height=b}},mejs.PluginMediaElement=function(a,b,c){this.id=a,this.pluginType=b,this.src=c,this.events={},this.attributes={}},mejs.PluginMediaElement.prototype={pluginElement:null,pluginType:"",isFullScreen:!1,playbackRate:-1,defaultPlaybackRate:-1,seekable:[],played:[],paused:!0,ended:!1,seeking:!1,duration:0,error:null,tagName:"",muted:!1,volume:1,currentTime:0,play:function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?this.pluginApi.playVideo():this.pluginApi.playMedia(),this.paused=!1)},load:function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType||this.pluginApi.loadMedia(),this.paused=!1)},pause:function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?1==this.pluginApi.getPlayerState()&&this.pluginApi.pauseVideo():this.pluginApi.pauseMedia(),this.paused=!0)},stop:function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?this.pluginApi.stopVideo():this.pluginApi.stopMedia(),this.paused=!0)},canPlayType:function(a){var b,c,d,e=mejs.plugins[this.pluginType];for(b=0;b<e.length;b++)if(d=e[b],mejs.PluginDetector.hasPluginVersion(this.pluginType,d.version))for(c=0;c<d.types.length;c++)if(a==d.types[c])return"probably";return""},positionFullscreenButton:function(a,b,c){null!=this.pluginApi&&this.pluginApi.positionFullscreenButton&&this.pluginApi.positionFullscreenButton(Math.floor(a),Math.floor(b),c)},hideFullscreenButton:function(){null!=this.pluginApi&&this.pluginApi.hideFullscreenButton&&this.pluginApi.hideFullscreenButton()},setSrc:function(a){if("string"==typeof a)this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(a)),this.src=mejs.Utility.absolutizeUrl(a);else{var b,c;for(b=0;b<a.length;b++)if(c=a[b],this.canPlayType(c.type)){this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(c.src)),this.src=mejs.Utility.absolutizeUrl(c.src);break}}},setCurrentTime:function(a){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?this.pluginApi.seekTo(a):this.pluginApi.setCurrentTime(a),this.currentTime=a)},setVolume:function(a){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.setVolume(100*a):this.pluginApi.setVolume(a),this.volume=a)},setMuted:function(a){null!=this.pluginApi&&("youtube"==this.pluginType?(a?this.pluginApi.mute():this.pluginApi.unMute(),this.muted=a,this.dispatchEvent({type:"volumechange"})):this.pluginApi.setMuted(a),this.muted=a)},setVideoSize:function(a,b){this.pluginElement&&this.pluginElement.style&&(this.pluginElement.style.width=a+"px",this.pluginElement.style.height=b+"px"),null!=this.pluginApi&&this.pluginApi.setVideoSize&&this.pluginApi.setVideoSize(a,b)},setFullscreen:function(a){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.pluginApi.setFullscreen(a)},enterFullScreen:function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!0)},exitFullScreen:function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!1)},addEventListener:function(a,b,c){this.events[a]=this.events[a]||[],this.events[a].push(b)},removeEventListener:function(a,b){if(!a)return this.events={},!0;var c=this.events[a];if(!c)return!0;if(!b)return this.events[a]=[],!0;for(var d=0;d<c.length;d++)if(c[d]===b)return this.events[a].splice(d,1),!0;return!1},dispatchEvent:function(a){var b,c=this.events[a.type];if(c)for(b=0;b<c.length;b++)c[b].apply(this,[a])},hasAttribute:function(a){return a in this.attributes},removeAttribute:function(a){delete this.attributes[a]},getAttribute:function(a){return this.hasAttribute(a)?this.attributes[a]:""},setAttribute:function(a,b){this.attributes[a]=b},remove:function(){mejs.Utility.removeSwf(this.pluginElement.id)}},mejs.MediaElementDefaults={mode:"auto",plugins:["flash","silverlight","youtube","vimeo"],enablePluginDebug:!1,httpsBasicAuthSite:!1,type:"",pluginPath:mejs.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),flashName:"flashmediaelement.swf",flashStreamer:"",flashScriptAccess:"sameDomain",enablePluginSmoothing:!1,enablePseudoStreaming:!1,pseudoStreamingStartQueryParam:"start",silverlightName:"silverlightmediaelement.xap",defaultVideoWidth:480,defaultVideoHeight:270,pluginWidth:-1,pluginHeight:-1,pluginVars:[],timerRate:250,startVolume:.8,success:function(){},error:function(){}},mejs.MediaElement=function(a,b){return mejs.HtmlMediaElementShim.create(a,b)},mejs.HtmlMediaElementShim={create:function(a,b){var c,d,e={},f="string"==typeof a?document.getElementById(a):a,g=f.tagName.toLowerCase(),h="audio"===g||"video"===g,i=h?f.getAttribute("src"):f.getAttribute("href"),j=f.getAttribute("poster"),k=f.getAttribute("autoplay"),l=f.getAttribute("preload"),m=f.getAttribute("controls");for(d in mejs.MediaElementDefaults)e[d]=mejs.MediaElementDefaults[d];for(d in b)e[d]=b[d];return i="undefined"==typeof i||null===i||""==i?null:i,j="undefined"==typeof j||null===j?"":j,l="undefined"==typeof l||null===l||"false"===l?"none":l,k=!("undefined"==typeof k||null===k||"false"===k),m=!("undefined"==typeof m||null===m||"false"===m),c=this.determinePlayback(f,e,mejs.MediaFeatures.supportsMediaTag,h,i),c.url=null!==c.url?mejs.Utility.absolutizeUrl(c.url):"",c.scheme=mejs.Utility.determineScheme(c.url),"native"==c.method?(mejs.MediaFeatures.isBustedAndroid&&(f.src=c.url,f.addEventListener("click",function(){f.play()},!1)),this.updateNative(c,e,k,l)):""!==c.method?this.createPlugin(c,e,j,k,l,m):(this.createErrorMessage(c,e,j),this)},determinePlayback:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=[],r={method:"",url:"",htmlMediaElement:a,isVideo:"audio"!=a.tagName.toLowerCase(),scheme:""};if("undefined"!=typeof b.type&&""!==b.type)if("string"==typeof b.type)q.push({type:b.type,url:e});else for(f=0;f<b.type.length;f++)q.push({type:b.type[f],url:e});else if(null!==e)k=this.formatType(e,a.getAttribute("type")),q.push({type:k,url:e});else for(f=0;f<a.childNodes.length;f++)j=a.childNodes[f],1==j.nodeType&&"source"==j.tagName.toLowerCase()&&(e=j.getAttribute("src"),k=this.formatType(e,j.getAttribute("type")),p=j.getAttribute("media"),(!p||!window.matchMedia||window.matchMedia&&window.matchMedia(p).matches)&&q.push({type:k,url:e}));if(!d&&q.length>0&&null!==q[0].url&&this.getTypeFromFile(q[0].url).indexOf("audio")>-1&&(r.isVideo=!1),mejs.MediaFeatures.isBustedAndroid&&(a.canPlayType=function(a){return null!==a.match(/video\/(mp4|m4v)/gi)?"maybe":""}),mejs.MediaFeatures.isChromium&&(a.canPlayType=function(a){return null!==a.match(/video\/(webm|ogv|ogg)/gi)?"maybe":""}),c&&("auto"===b.mode||"auto_plugin"===b.mode||"native"===b.mode)&&(!mejs.MediaFeatures.isBustedNativeHTTPS||b.httpsBasicAuthSite!==!0)){for(d||(o=document.createElement(r.isVideo?"video":"audio"),a.parentNode.insertBefore(o,a),a.style.display="none",r.htmlMediaElement=a=o),f=0;f<q.length;f++)if("video/m3u8"==q[f].type||""!==a.canPlayType(q[f].type).replace(/no/,"")||""!==a.canPlayType(q[f].type.replace(/mp3/,"mpeg")).replace(/no/,"")||""!==a.canPlayType(q[f].type.replace(/m4a/,"mp4")).replace(/no/,"")){r.method="native",r.url=q[f].url;break}if("native"===r.method&&(null!==r.url&&(a.src=r.url),"auto_plugin"!==b.mode))return r}if("auto"===b.mode||"auto_plugin"===b.mode||"shim"===b.mode)for(f=0;f<q.length;f++)for(k=q[f].type,g=0;g<b.plugins.length;g++)for(l=b.plugins[g],m=mejs.plugins[l],h=0;h<m.length;h++)if(n=m[h],null==n.version||mejs.PluginDetector.hasPluginVersion(l,n.version))for(i=0;i<n.types.length;i++)if(k.toLowerCase()==n.types[i].toLowerCase())return r.method=l,r.url=q[f].url,r;return"auto_plugin"===b.mode&&"native"===r.method?r:(""===r.method&&q.length>0&&(r.url=q[0].url),r)},formatType:function(a,b){return a&&!b?this.getTypeFromFile(a):b&&~b.indexOf(";")?b.substr(0,b.indexOf(";")):b},getTypeFromFile:function(a){a=a.split("?")[0];var b=a.substring(a.lastIndexOf(".")+1).toLowerCase(),c=/(mp4|m4v|ogg|ogv|m3u8|webm|webmv|flv|wmv|mpeg|mov)/gi.test(b)?"video/":"audio/";return this.getTypeFromExtension(b,c)},getTypeFromExtension:function(a,b){switch(b=b||"",a){case"mp4":case"m4v":case"m4a":case"f4v":case"f4a":return b+"mp4";case"flv":return b+"x-flv";case"webm":case"webma":case"webmv":return b+"webm";case"ogg":case"oga":case"ogv":return b+"ogg";case"m3u8":return"application/x-mpegurl";case"ts":return b+"mp2t";default:return b+a}},createErrorMessage:function(a,b,c){var d=a.htmlMediaElement,e=document.createElement("div"),f=b.customError;e.className="me-cannotplay";try{e.style.width=d.width+"px",e.style.height=d.height+"px"}catch(g){}f||(f='<a href="'+a.url+'">',""!==c&&(f+='<img src="'+c+'" width="100%" height="100%" alt="" />'),f+="<span>"+mejs.i18n.t("Download File")+"</span></a>"),e.innerHTML=f,d.parentNode.insertBefore(e,d),d.style.display="none",b.error(d)},createPlugin:function(a,b,c,d,e,f){var g,h,i,j=a.htmlMediaElement,k=1,l=1,m="me_"+a.method+"_"+mejs.meIndex++,n=new mejs.PluginMediaElement(m,a.method,a.url),o=document.createElement("div");n.tagName=j.tagName;for(var p=0;p<j.attributes.length;p++){var q=j.attributes[p];q.specified&&n.setAttribute(q.name,q.value)}for(h=j.parentNode;null!==h&&null!=h.tagName&&"body"!==h.tagName.toLowerCase()&&null!=h.parentNode&&null!=h.parentNode.tagName&&null!=h.parentNode.constructor&&"ShadowRoot"===h.parentNode.constructor.name;){if("p"===h.parentNode.tagName.toLowerCase()){h.parentNode.parentNode.insertBefore(h,h.parentNode);break}h=h.parentNode}switch(a.isVideo?(k=b.pluginWidth>0?b.pluginWidth:b.videoWidth>0?b.videoWidth:null!==j.getAttribute("width")?j.getAttribute("width"):b.defaultVideoWidth,l=b.pluginHeight>0?b.pluginHeight:b.videoHeight>0?b.videoHeight:null!==j.getAttribute("height")?j.getAttribute("height"):b.defaultVideoHeight,k=mejs.Utility.encodeUrl(k),l=mejs.Utility.encodeUrl(l)):b.enablePluginDebug&&(k=320,l=240),n.success=b.success,o.className="me-plugin",o.id=m+"_container",a.isVideo?j.parentNode.insertBefore(o,j):document.body.insertBefore(o,document.body.childNodes[0]),("flash"===a.method||"silverlight"===a.method)&&(i=["id="+m,"isvideo="+(a.isVideo?"true":"false"),"autoplay="+(d?"true":"false"),"preload="+e,"width="+k,"startvolume="+b.startVolume,"timerrate="+b.timerRate,"flashstreamer="+b.flashStreamer,"height="+l,"pseudostreamstart="+b.pseudoStreamingStartQueryParam],null!==a.url&&("flash"==a.method?i.push("file="+mejs.Utility.encodeUrl(a.url)):i.push("file="+a.url)),b.enablePluginDebug&&i.push("debug=true"),b.enablePluginSmoothing&&i.push("smoothing=true"),b.enablePseudoStreaming&&i.push("pseudostreaming=true"),f&&i.push("controls=true"),b.pluginVars&&(i=i.concat(b.pluginVars)),window[m+"_init"]=function(){switch(n.pluginType){case"flash":n.pluginElement=n.pluginApi=document.getElementById(m);break;case"silverlight":n.pluginElement=document.getElementById(n.id),n.pluginApi=n.pluginElement.Content.MediaElementJS}null!=n.pluginApi&&n.success&&n.success(n,j)},window[m+"_event"]=function(a,b){var c,d,e;c={type:a,target:n};for(d in b)n[d]=b[d],c[d]=b[d];e=b.bufferedTime||0,c.target.buffered=c.buffered={start:function(a){return 0},end:function(a){return e},length:1},n.dispatchEvent(c)}),a.method){case"silverlight":o.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+m+'" name="'+m+'" width="'+k+'" height="'+l+'" class="mejs-shim"><param name="initParams" value="'+i.join(",")+'" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="'+b.pluginPath+b.silverlightName+'" /></object>';break;case"flash":mejs.MediaFeatures.isIE?(g=document.createElement("div"),o.appendChild(g),g.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+m+'" width="'+k+'" height="'+l+'" class="mejs-shim"><param name="movie" value="'+b.pluginPath+b.flashName+"?"+(new Date).getTime()+'" /><param name="flashvars" value="'+i.join("&amp;")+'" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="'+b.flashScriptAccess+'" /><param name="allowFullScreen" value="true" /><param name="scale" value="default" /></object>'):o.innerHTML='<embed id="'+m+'" name="'+m+'" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="'+b.flashScriptAccess+'" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" src="'+b.pluginPath+b.flashName+'" flashvars="'+i.join("&")+'" width="'+k+'" height="'+l+'" scale="default"class="mejs-shim"></embed>';break;case"youtube":var r;if(-1!=a.url.lastIndexOf("youtu.be"))r=a.url.substr(a.url.lastIndexOf("/")+1),-1!=r.indexOf("?")&&(r=r.substr(0,r.indexOf("?")));else{var s=a.url.match(/[?&]v=([^&#]+)|&|#|$/);s&&(r=s[1])}youtubeSettings={container:o,containerId:o.id,pluginMediaElement:n,pluginId:m,videoId:r,height:l,width:k,scheme:a.scheme},window.postMessage?mejs.YouTubeApi.enqueueIframe(youtubeSettings):mejs.PluginDetector.hasPluginVersion("flash",[10,0,0])&&mejs.YouTubeApi.createFlash(youtubeSettings,b);break;case"vimeo":var t=m+"_player";if(n.vimeoid=a.url.substr(a.url.lastIndexOf("/")+1),o.innerHTML='<iframe src="'+a.scheme+"player.vimeo.com/video/"+n.vimeoid+"?api=1&portrait=0&byline=0&title=0&player_id="+t+'" width="'+k+'" height="'+l+'" frameborder="0" class="mejs-shim" id="'+t+'" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',"function"==typeof $f){var u=$f(o.childNodes[0]),v=-1;u.addEvent("ready",function(){function a(a,b,c,d){var e={type:c,target:b};"timeupdate"==c&&(b.currentTime=e.currentTime=d.seconds,b.duration=e.duration=d.duration),b.dispatchEvent(e)}u.playVideo=function(){u.api("play")},u.stopVideo=function(){u.api("unload")},u.pauseVideo=function(){u.api("pause")},u.seekTo=function(a){u.api("seekTo",a)},u.setVolume=function(a){u.api("setVolume",a)},u.setMuted=function(a){a?(u.lastVolume=u.api("getVolume"),u.api("setVolume",0)):(u.api("setVolume",u.lastVolume),delete u.lastVolume)},u.getPlayerState=function(){return v},u.addEvent("play",function(){v=1,a(u,n,"play"),a(u,n,"playing")}),u.addEvent("pause",function(){v=2,a(u,n,"pause")}),u.addEvent("finish",function(){v=0,a(u,n,"ended")}),u.addEvent("playProgress",function(b){a(u,n,"timeupdate",b)}),u.addEvent("seek",function(b){v=3,a(u,n,"seeked",b)}),u.addEvent("loadProgress",function(b){v=3,a(u,n,"progress",b)}),n.pluginElement=o,n.pluginApi=u,n.success(n,n.pluginElement)})}}return j.style.display="none",j.removeAttribute("autoplay"),n},updateNative:function(a,b,c,d){var e,f=a.htmlMediaElement;for(e in mejs.HtmlMediaElement)f[e]=mejs.HtmlMediaElement[e];return b.success(f,f),f}},mejs.YouTubeApi={isIframeStarted:!1,isIframeLoaded:!1,loadIframeApi:function(a){if(!this.isIframeStarted){var b=document.createElement("script");b.src=a.scheme+"www.youtube.com/player_api";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),this.isIframeStarted=!0}},iframeQueue:[],enqueueIframe:function(a){this.isLoaded?this.createIframe(a):(this.loadIframeApi(a),this.iframeQueue.push(a))},createIframe:function(a){var b=a.pluginMediaElement,c=new YT.Player(a.containerId,{height:a.height,width:a.width,videoId:a.videoId,playerVars:{controls:0,wmode:"transparent"},events:{onReady:function(){c.setVideoSize=function(a,b){c.setSize(a,b)},a.pluginMediaElement.pluginApi=c,a.pluginMediaElement.pluginElement=document.getElementById(a.containerId),b.success(b,b.pluginElement),setInterval(function(){mejs.YouTubeApi.createEvent(c,b,"timeupdate")},250)},onStateChange:function(a){mejs.YouTubeApi.handleStateChange(a.data,c,b)}}})},createEvent:function(a,b,c){var d={type:c,target:b};if(a&&a.getDuration){b.currentTime=d.currentTime=a.getCurrentTime(),b.duration=d.duration=a.getDuration(),d.paused=b.paused,d.ended=b.ended,d.muted=a.isMuted(),d.volume=a.getVolume()/100,d.bytesTotal=a.getVideoBytesTotal(),d.bufferedBytes=a.getVideoBytesLoaded();var e=d.bufferedBytes/d.bytesTotal*d.duration;d.target.buffered=d.buffered={start:function(a){return 0},end:function(a){return e},length:1}}b.dispatchEvent(d)},iFrameReady:function(){for(this.isLoaded=!0,this.isIframeLoaded=!0;this.iframeQueue.length>0;){var a=this.iframeQueue.pop();this.createIframe(a)}},flashPlayers:{},createFlash:function(a){this.flashPlayers[a.pluginId]=a;var b,c=a.scheme+"www.youtube.com/apiplayer?enablejsapi=1&amp;playerapiid="+a.pluginId+"&amp;version=3&amp;autoplay=0&amp;controls=0&amp;modestbranding=1&loop=0";mejs.MediaFeatures.isIE?(b=document.createElement("div"),a.container.appendChild(b),b.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+a.scheme+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+a.pluginId+'" width="'+a.width+'" height="'+a.height+'" class="mejs-shim"><param name="movie" value="'+c+'" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="'+options.flashScriptAccess+'" /><param name="allowFullScreen" value="true" /></object>'):a.container.innerHTML='<object type="application/x-shockwave-flash" id="'+a.pluginId+'" data="'+c+'" width="'+a.width+'" height="'+a.height+'" style="visibility: visible; " class="mejs-shim"><param name="allowScriptAccess" value="'+options.flashScriptAccess+'"><param name="wmode" value="transparent"></object>'},flashReady:function(a){var b=this.flashPlayers[a],c=document.getElementById(a),d=b.pluginMediaElement;d.pluginApi=d.pluginElement=c,b.success(d,d.pluginElement),c.cueVideoById(b.videoId);var e=b.containerId+"_callback";window[e]=function(a){mejs.YouTubeApi.handleStateChange(a,c,d)},c.addEventListener("onStateChange",e),setInterval(function(){mejs.YouTubeApi.createEvent(c,d,"timeupdate")},250),mejs.YouTubeApi.createEvent(c,d,"canplay")},handleStateChange:function(a,b,c){switch(a){case-1:c.paused=!0,c.ended=!0,mejs.YouTubeApi.createEvent(b,c,"loadedmetadata");break;case 0:c.paused=!1,c.ended=!0,mejs.YouTubeApi.createEvent(b,c,"ended");break;case 1:c.paused=!1,c.ended=!1,mejs.YouTubeApi.createEvent(b,c,"play"),mejs.YouTubeApi.createEvent(b,c,"playing");break;case 2:c.paused=!0,c.ended=!1,mejs.YouTubeApi.createEvent(b,c,"pause");break;case 3:mejs.YouTubeApi.createEvent(b,c,"progress");break;case 5:}}},window.onYouTubePlayerAPIReady=function(){mejs.YouTubeApi.iFrameReady()},window.onYouTubePlayerReady=function(a){mejs.YouTubeApi.flashReady(a)},window.mejs=mejs,window.MediaElement=mejs.MediaElement,function(a,b,c){"use strict";var d={locale:{language:b.i18n&&b.i18n.locale.language||"",strings:b.i18n&&b.i18n.locale.strings||{}},ietf_lang_regex:/^(x\-)?[a-z]{2,}(\-\w{2,})?(\-\w{2,})?$/,methods:{}};d.getLanguage=function(){var a=d.locale.language||window.navigator.userLanguage||window.navigator.language;return d.ietf_lang_regex.exec(a)?a:null},"undefined"!=typeof mejsL10n&&(d.locale.language=mejsL10n.language),d.methods.checkPlain=function(a){var b,c,d={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};a=String(a);for(b in d)d.hasOwnProperty(b)&&(c=new RegExp(b,"g"),a=a.replace(c,d[b]));return a},d.methods.t=function(a,b){return d.locale.strings&&d.locale.strings[b.context]&&d.locale.strings[b.context][a]&&(a=d.locale.strings[b.context][a]),d.methods.checkPlain(a)},d.t=function(a,b){if("string"==typeof a&&a.length>0){var c=d.getLanguage();return b=b||{context:c},d.methods.t(a,b)}throw{name:"InvalidArgumentException",message:"First argument is either not a string or empty."}},b.i18n=d}(document,mejs),function(a,b){"use strict";"undefined"!=typeof mejsL10n&&(a[mejsL10n.language]=mejsL10n.strings)}(mejs.i18n.locale.strings),!function(a){"use strict";a.AS||(a.AS={})}(this),function(){"use strict";AS.message={PUBLICATION_LOADED:"publication:loaded",ISSUE_NAVIGATE:"issue:navigate",ISSUE_LOADED:"issue:loaded",ISSUE_LOADING_ERROR:"issue:loadingError",ISSUE_UNLOADED:"issue:unloaded",VARIANT_CHANGE:"variant:change",PAGE_NAVIGATE:"page:navigate",PAGE_NAVIGATE_NEXT:"page:navigateNext",PAGE_NAVIGATE_PREVIOUS:"page:navigatePrevious",PAGE_LOADED:"page:loaded",PAGE_INITIALISED:"page:initialised",PAGE_FOCUSED:"page:focused",FACING_PAGE_DISPLAY:"page:facing",APPLICATION_START:"app:start",TRACK_EVENT:"app:trackEvent",TRACK_PAGE:"app:trackPage",TOGGLE_FULL_SCREEN:"app:fullscreen:toggle",FULL_SCREEN_ENTER:"app:fullscreen:enter",FULL_SCREEN_EXIT:"app:fullscreen:exit",BOOKMARK:"app:bookmark",ZOOM:"app:zoom",ZOOM_MODE_TOGGLE:"app:zoommode:toggle",ZOOM_MODE_UPDATE:"app:zoommode:update",ZOOM_PAGEVIEW_INCREASE:"app:zoompageview:inc",ZOOM_PAGEVIEW_DECREASE:"app:zoompageview:dec",AUTO_FIT_PAGEVIEW:"app:autofit:pageview",ALERT:"app:alert",TOOLBAR_CLOSE:"app:toolbar:close",TOOLBAR_OPEN:"app:toolbar:open",TOOLBAR_MORE:"app:toolbar:more",HELP:"app:help",SHARE:"app:share",SHOW_TIMELINE:"app:showTimeline",HIDE_TIMELINE:"app:hideTimeline",FORCE_SHOW_TIMELINE:"app:forceshowTimeline",FORCE_HIDE_TIMELINE:"app:forcehideTimeline",NAVIGATION_SCRUB:"app:navgationscrub",CLOSE_POPUP:"app:closePopup",ORIENTATION_CHANGE:"app:orientationChange",ORIENTATION_UNAVAILABLE:"app:orientationUnavailable",ORIENTATION_AVAILABLE:"app:orientationAvailable",CLOSE_LOADING:"app:closeLoading",LOADING_OPEN:"app:loadingOpen",LOADING_CLOSE:"app:loadingClose",TOC_TOGGLE:"app:tocToggle",TOC_ITEM_TOGGLE:"app:tocItemToggle",TOC_HIDE:"app:tocHide",TOC_ON_SCREEN:"app:tocOnScreen",REFRESH_PAGE:"app:refreshPage",OFFLINE:"app:offline",ONLINE:"app:online",FIRST_LAUNCH:"app:firstLaunch",SHOW_GEOLOCATION:"widget:showgeolocation",SHOW_VIDEO:"widget:showVideo",SHOW_ZOOMABLE_IMAGE:"widget:showZoomableImage",PLAY_GLOBAL_AUDIO:"audio:play",STOP_GLOBAL_AUDIO:"audio:stop",SHOW_GLOBAL_AUDIO:"audio:showview",HIDE_GLOBAL_AUDIO:"audio:hideview",TOGGLE_GLOBAL_AUDIO:"audio:toggleview",NEXT_GLOBAL_AUDIO:"audio:next",PREV_GLOBAL_AUDIO:"audio:prev",UPDATE_GLOBAL_AUDIO:"audio:update",START_GLOBAL_AUDIO:"audio:start",TOOLBAR_PROXIMITY:"toolbar:proximity",TOOLBAR_WILL_SHOW:"toolbar:willopen",NOTIFICATION_SHOW:"notification:show",NOTIFICATION_HIDE:"notification:hide",IOS_HOME_SHOW:"ioshome:show",IOS_HOME_HIDE:"ioshome:hide",GOTO_STORE:"app:navigate:store",PRE_AUTHENTICATE:"app:preauth",PRE_AUTHENTICATED:"app:preauth:complete",AUTHENTICATE:"app:auth",AUTHENTICATED:"app:auth:complete",UNAUTHENTICATE:"app:unauth",UNAUTHENTICATED:"app:unauth:complete",RESIZE:"app:resize",TOGGLE_NAV_BARS:"app:togglenavbars",STORE:"app:store",SPREAD_VIEW_TOGGLE:"app:spreadview:toggle",STORE_LOGIN_OPEN:"app:login:store:open",ISSUE_LOGIN_OPEN:"app:login:issue:open",LOGIN_CLOSE:"app:login:close",OFFLINE_OPTIONS_TOGGLE:"offlineoptions:show",OFFLINE_OPTIONS_STATUS_CHANGE:"offlineoptions:status",OFFLINE_STORE_JSON_UPDATED:"offlinestore:updated",OFFLINE_STORE_JSON_READY:"offlinestore:ready",OFFLINE_ISSUE_COMPLETE:"offline:issuecomplete",OFFLINE_PAGE_READ_COMPLETE:"offline:page:read:complete",OFFLINE_PAGE_DOWNLOAD_COMPLETE:"offline:page:download:complete",OFFLINE_PAGE_PROCESS_COMPLETE:"offline:page:process:complete",OFFLINE_ISSUE_DELETE_COMPLETE:"offline:issuedeleted",OFFLINE_PAGE_DELETE_COMPLETE:"offline:pagedeleted",OFFLINE_DOWNLOAD_EVENT:"offline:downloadevent"},_.extend(AS.message,Backbone.Events)}(),function(){"use strict";function a(b,c){var d;for(var e in c)c.hasOwnProperty(e)&&null!==c[e]&&(d=c[e],"object"==typeof d&&d.constructor===Object?(b[e]=b[e]||{},a(b[e],d)):b[e]=d);return b}function b(a,c){var d,e;if(!_.isObject(a))return c(a);for(var f in a)a.hasOwnProperty(f)&&(d=a[f],
"object"==typeof d&&d.constructor===Object?b(a[f],c):(e=c(d),d!==e&&(a[f]=e)));return a}var c=function(a){this.target=a};_.extend(c.prototype,{wire:function(a){var b,c,d,e;for(b in a)if(a.hasOwnProperty(b)){if(c=a[b],_.isArray(c))for(e=[],d=0;d<c.length;d++)e.push(this.resolveInject(c[d]));else e=this.resolveInject(c);this.target[b]=e}},resolveInject:function(a){var b=_.isString(a)?AS.config.get(a):a;return b=b||a,_.isObject(b)&&b.hasOwnProperty("class")?b=this.createFactory(b["class"],b):_.isFunction(b)&&(b=this.createFactory(b)),b},createFactory:function(a,b){return function(c){var d=new a(c);return b&&_.extend(d,b),d}}});var d={injectId:null,inject:null,_setupWiring:function(){if(this.injectId){var a=AS.config.get(this.injectId);this.config(a)}else _.isObject(this.inject)&&this.config(this.inject)},config:function(a){var b=new c(this);b.wire(a)}};AS.config=function(a){for(var b in a)AS.config.register(b,a[b])},_.extend(AS.config,{table:{},register:function(c,d){_.isObject(d)?this.table[c]=a(this.table[c]||{},d):this.table[c]=d,_.defer(_.bind(function(){this.table[c]=b(this.table[c],function(a){return _.isString(a)&&0===a.indexOf("locale:")?a.substr(7).toLocaleString():a})},this))},get:function(a){if(!a)return _.clone(this.table);for(var b=a.split("."),c=this.table;c&&b.length;)a=b.shift(),c=c[a];return c},has:function(a){return!!this.get(a)},mixin:function(a){_.extend(a,d)}})}(),function(){"use strict";function a(a,b){return b+a.charAt(0).toUpperCase()+a.substr(1)}function b(){return AS.browser.webkit?"webkit":AS.browser.opera?"o":AS.browser.ie?"ms":document.body.style.MozTransform?"moz":""}function c(){return screen.height===$(window).outerHeight()&&screen.width===$(window).outerWidth()}function d(){AS.util.CURRENT_FRAMEWORK=AS.config.get("app.frameworkMode"),AS.message.off(AS.message.PUBLICATION_LOADED,d)}var e=60,f=1e3/e,g=navigator.userAgent,h=[/Mac OS X 10_8.*\b6.0.* Safari\b/];AS.orientation={locked:function(){return AS.config.get("publication.lockOrientation")},get:function(){return AS.browser.android||AS.browser.androidbuiltin?(AS.config.get("publication.orientation"),window.outerWidth,window.outerHeight,"undefined"!=typeof event&&"orientationchange"===event.type?0===event.target.orientation||180===event.target.orientation?"portrait":"landscape":window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape"):"undefined"!=typeof window.onorientationchange?0===window.orientation||180===window.orientation?"portrait":"landscape":AS.config.get("publication.orientation")},value:function(){return AS.config.get("publication.orientation")},desktop:function(){return"undefined"!=typeof window.onorientationchange?!1:!0},handheld:function(){return"undefined"!=typeof window.onorientationchange?!0:!1},checkFeature:function(){return"undefined"!=typeof window.onorientationchange?!0:!1},set:function(){var a=AS.orientation.get();$("body").removeClass("ori-landscape").removeClass("ori-portrait"),$("body").addClass("ori-"+a),AS.config.get("publication.lockOrientation")||(AS.config.get("publication").orientation=a)},setup:function(){var a=AS.orientation.get();$("body").removeClass("ori-landscape").removeClass("ori-portrait"),$("body").addClass("ori-"+a),AS.config.get("publication.lockOrientation")||(AS.config.get("publication").orientation=a)},isPortraitIssue:function(){return/portrait/.test(window.location.href)}},AS.browser={mac:/Macintosh/.test(g),win:/Windows/.test(g),desktop:/Windows/.test(g)||/Macintosh/.test(g),iphone:/iPhone/.test(g),ipad:/iPad/.test(g),ios:/iPad|iPhone|iPod/.test(g),ios5:/iPad|iPhone|iPod/.test(g)&&/OS 5|OS 4/.test(g),android:/Android/.test(g),androidbuiltin:/Android/.test(g)&&/Mozilla/.test(g)&&/Safari/.test(g)&&!/Chrome/.test(g),firefox:/Firefox/.test(g),webkit:/WebKit/.test(g),opera:/Opera/.test(g),ie:/MSIE/.test(g)||/Trident/.test(g)},AS.extensions=function(){var a=[];return{add:function(b){this.check(b)||a.push(b)},check:function(b){return _.contains(a,b)}}}(),AS.cookies={get:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return null},set:function(a,b,c,d){function e(){var a;return 4!==j.split(".").length||isNaN(j.charAt(0))?(a=_.last(j.split("."),i).join("."),a=a.split(".").length<=1?"":";domain="+a):a="",a}function f(){if(g=e(),document.cookie=a+"="+b+h+g+d,AS.cookies.get(a)!==b.toString()){if(i++,!(i<=j.split(".").length))return!1;f()}return!0}var g,h="",i=2,j=window.location.host;if(c){var k=new Date;k.setTime(k.getTime()+1e3*c),h=";expires="+k.toGMTString()}d=";path="+d;f()},remove:function(a){this.set(a,"",-1,"/")},detect:function(){document.cookie="cookie=1";var a=-1!==document.cookie.indexOf("cookie");return document.cookie="cookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",a}},AS.util={FULL_SCREEN_SUPPORTED:void 0,VENDOR_PREFIX:void 0,GPU_ENABLED:void 0,STANDALONE:"standalone"in navigator&&navigator.standalone,RETINA:!1,requestAnimationFrame:function(a){var b=this.vendorPrefixed("requestAnimationFrame");return"function"==typeof b?b.apply(window,arguments):setTimeout(a,f)},iframeCount:function(){return Modernizr.touch||AS.config.get("app.mobileOnly")?AS.browser.androidbuiltin||AS.browser.iphone||AS.browser.ios5?1:AS.browser.android?3:5:AS.util.isIE9()?5:7},cancelAnimationFrame:function(a){var b=this.vendorPrefixed("cancelAnimationFrame");"function"==typeof b&&b.apply(window,arguments),clearTimeout(a)},supportsFullScreen:function(){if(Modernizr.touch||AS.config.get("app.mobileOnly"))return!1;for(var a=0;a<h.length;a++)if(h[a].test(g))return!1;var b=document.body;return b&&(b.requestFullScreen||b.mozRequestFullScreen||b.webkitRequestFullScreen||AS.util.getInternetExplorerVersion()>=10)},isFullScreen:function(){return AS.util.getInternetExplorerVersion()>=10?c():"undefined"!=typeof document.fullscreen?c()?!0:document.fullscreen:"undefined"!=typeof document.mozFullScreen?c()?!0:document.mozFullScreen:"undefined"!=typeof document.webkitIsFullScreen?c()?!0:document.webkitIsFullScreen:void 0},requestFullScreen:function(a){a=a||document.documentElement,a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},exitFullScreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},vendorPrefixedStyle:function(a){var b=this.VENDOR_PREFIX;return b?"-"+b+"-"+a:a},vendorPrefixedEvent:function(b){function c(b){return function(c){return a(c,b)}}var d=this.VENDOR_PREFIX,e={webkit:c("webkit"),o:c("o"),ms:c("ms")},f=e[d];return"function"==typeof f?f(b):b.toLowerCase()},vendorPrefixed:function(b,c){c=c||window;var d=this.VENDOR_PREFIX;return d&&(b=a(b,d)),c.hasOwnProperty(b)?c[b]:null},isIE:function(){return-1!==AS.util.getInternetExplorerVersion()},isIE10:function(){return AS.util.getInternetExplorerVersion()>=10},isIE9:function(){return 9===AS.util.getInternetExplorerVersion()},canShowDoublePage:function(a){return!Modernizr.touch&&AS.config.get("app.facingPages")&&a<=window.innerWidth/2?!0:!1},getInternetExplorerVersion:function(){var a,b,c=-1;return"Microsoft Internet Explorer"===navigator.appName?(a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"),null!==b.exec(a)&&(c=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(a=navigator.userAgent,b=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})"),null!==b.exec(a)&&(c=parseFloat(RegExp.$1))),c},parseIssueId:function(a){var b=a.split(":");return b.pop(),b.pop()},isGpuEnabled:function(a){return a=a||window,AS.browser.androidbuiltin?!1:/MSIE/.test(a.navigator.userAgent)?!1:AS.browser.android?!0:/iPad|iPhone|iPod/.test(a.navigator.userAgent)?!0:/Chrome|Safari|Mozilla/.test(a.navigator.userAgent)},numberZero:function(a){return 0>a?a>-10?"0"+a:a.toString():10>a?"0"+a:a.toString()},timeStringFromSeconds:function(a){return Math.floor(a/60)+":"+AS.util.numberZero(Math.floor(a%60))},queryStringParam:function(a,b){var c=this.queryString(b);return c?c[a]:void 0},queryString:_.memoize(function(a){var b,c,d,e,f,g={};if(a=a||window.location.href,b=a.indexOf("#"),c=a.lastIndexOf("?"),-1===c)return void 0;for(d=a.substring(c+1,-1===b?void 0:b),e=d.split("&"),f=0;f<e.length;f++){var h=e[f].split("="),i=decodeURIComponent(h[0]),j=decodeURIComponent(h[1]);g[i]=j}return g}),stripURL:function(a){return a=a||window.location.href,a.split("?")[0]},stripLeadingSlash:function(a){return"/"===a.charAt(0)?a.substr(1):a},stripTrailingSlash:function(a){return"/"===a.charAt(a.length-1)?a.substr(0,a.length-1):a},cloneEvent:function(a,b){"string"!=typeof a&&(b=a,a=b.type);var c={};c.click=c.mousedown=c.mouseup=c.mousemove="MouseEvents";var d=document.createEvent(c[a]||"Events"),e=!0;if(b)for(var f in b)if("bubbles"===f)e=!!b[f];else try{d[f]=b[f]}catch(g){}return d.initEvent(a,e,!0,null,null,null,null,null,null,null,null,null,null,null,null),d.isDefaultPrevented=function(){return this.defaultPrevented},d},truncate:function(a,b){var c=a.innerHTML,d=c.split(" ");for(a.innerHTML="";d.length&&a.offsetHeight<=b;)a.innerHTML+=d.shift()+" ";d.length&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-1),a.innerHTML+="...")},iosDismissKeyboard:function(){var a=$("a").filter(":visible");return a?void a.first().focus():void $("<a/>",{href:"javascript:;"}).appendTo("body").css("display","block").focus().remove()},changeLocation:function(a){window.location=a},animateRotate:function(a){var b={startDegrees:0,targetDegrees:360,duration:1e3,callback:function(){}};_.extend(b,a),$({deg:b.startDegrees}).animate({deg:b.targetDegrees},{step:function(a){b.el.style[AS.util.vendorPrefixedEvent("transform")]="rotate("+a+"deg)"},duration:b.duration,easing:"linear",complete:b.callback})},restrictTextByLines:function(a,b){a.each(function(){var a,c=$(this).data("singleHeight");c||(a=$(this).html(),c=$(this).html("&nbsp").height(),$(this).html(a+"").data("singleHeight",c)),"function"==typeof $.fn.dotdotdot&&$(this).dotdotdot({height:c*b})})},isValidUrl:function(a){return/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/.test(a)},isValidBundleId:function(a){return/^([a-zA-Z]+).([a-zA-Z]+).([a-zA-Z]+)$/.test(a)},getCurrentScreenDimensions:function(){var a=AS.browser.android||AS.browser.androidbuiltin;return a?{width:screen.width,height:screen.height}:window.hasOwnProperty("orientation")&&90===Math.abs(window.orientation)?{width:screen.height,height:screen.width}:{width:screen.width,height:screen.height}},isModelViewMode:function(){return $(".modalView").length>0},CSSTransformString:function(a){var b,c,d,e=a.enable3D?!0:!1,f=a.origin;if(a.left||a.top){var g=a.left||0,h=a.top||0;b=e?"translate3D("+g+"px, "+h+"px, 0)":"translate("+g+"px, "+h+"px)"}if(a.scale&&(c=e?"scale3D("+a.scale+", "+a.scale+", 0)":"scale("+a.scale+")"),a.angle&&(d=e?"rotate3D(0,0,"+a.angle+"deg)":"rotate("+a.angle+"deg)"),!(b||c||d))return{};var i=b&&c?b+" "+c:b?b:c;d&&(i=i+" "+d);var j={};return j.transform=i,a.origin&&(j["transform-origin"]=f),a.duration&&(j["transition-duration"]=a.duration+"ms"),j}},AS.util.GPU_ENABLED=AS.util.isGpuEnabled(),AS.util.VENDOR_PREFIX=b(),AS.util.FULL_SCREEN_SUPPORTED=AS.util.supportsFullScreen(),AS.message.on(AS.message.PUBLICATION_LOADED,d,this),AS.frameworks={BROWSER:"browser",GSA:"GSA"},AS.NOTIFICATION_LEVEL={ERROR:1,WARN:2,INFO:3,VERBOSE:4,SILLY:5}}(),function(){"use strict";$.easing||($.easing={}),$.extend($.easing,{},{easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c}}),$.fn.stop||($.fn.stop=function(){return this}),String.prototype.toAlphaNumericString=function(){for(var a=this;a!==a.replace(/[^a-zA-Z0-9_.]+/,"");)a=a.replace(/[^a-zA-Z0-9_.]+/,"");return a}}(),function(){"use strict";function a(a){var b;return a=a||"short",b=("date-"+a).toLocaleString()}var b={interpolate:/\{\{\{(.+?)\}\}\}/g};Date.prototype.toLocaleDateString=Date.prototype.toLocaleString=function(b){return moment(this).format(a(b))},String.prototype.toLocaleDateString=function(b){return moment(this).format(a(b))},String.prototype.toLocaleString=function(){var a=String.prototype.toLocaleString;return function(c){var d=a.apply(this,arguments),e=_.extend(AS.config.get(),_.isObject(c)?c:{});return d=_.template(d,e,b)}}(),String.prototype.toConfiguredLocaleString=function(){function a(a,b,c){var d=AS.config.get("type."+a)?AS.config.get("type."+a):a,e=_.find(_.keys(b),function(a){return d.toLowerCase().match(new RegExp(a))});return e?b[e].toLocaleString():(c||d).toLocaleString()}var b;return b={login:function(){return a("login",{log:"login",sign:"signin"})},subscribe:function(){return a("subscribe",{subscribe:"subscribe",register:"register"})},logout:function(){return a("login",{log:"logout",sign:"signout"},"logout")},"login-waiting":function(){return a("login",{log:"login-waiting",sign:"signin-waiting"},"login-waiting")},"issue-login-subscribe":function(){return a("subscribe",{subscribe:"issue-login-subscribe",register:"issue-login-register"},"issue-login-subscribe")},"issue-login-title":function(){return a("login",{log:"issue-login-title",sign:"issue-signin-title"},"issue-login-title")},_default:function(){return this.toLocaleString()}},_.contains(_.keys(b),this.toString())?b[this]():_.bind(b._default,this)()},String.defaultLocale="en"}(),function(){"use strict";function a(a){a.preventDefault()}function b(b){b&&b.body&&$(b.body).on("touchmove",a)}function c(b){b&&b.body&&$(b.body).off("touchmove",a)}function d(a){var b=a.contentWindow,c=AS.Session.loadStateForCurrentPage();c&&"function"==typeof b.loadPageState&&b.loadPageState(c)}var e=AS.util.GPU_ENABLED,f=(AS.util.vendorPrefixedStyle("transform"),AS.util.vendorPrefixedStyle("transform-style")),g=AS.util.vendorPrefixedStyle("backface-visibility"),h=Modernizr.touch?["touchstart","touchmove","touchend","swipeleft","swiperight","tap"]:["mousedown","mouseup","click","mousewheel","wheel","DOMMouseScroll","keyup"],i=["function bridge( message ){","try {","parent.AS.PlatformBridge.request( message, window.location.href );","} catch(e){}","}","if( typeof PR !== 'undefined' ){","PR.notifyApp = bridge;","if( PR.Core ){ ","PR.Core.onAppNotifyDesktop = bridge;","}","}"].join("\n"),j=["function fetchAsset( asset, callback ) { try {","parent.AS.resourceManager.loadResource( asset, callback );","} catch(e) {} }","if(typeof PR !== 'undefined') {","if( PR.WidgetHelper ) {","PR.WidgetHelper.fetchAsset = fetchAsset;","}","}"].join("\n"),k="[class*='animation'] { "+g+": hidden; "+f+": flat; }";AS.ContentAdaptor={processIframe:function(a,c,d){function f(){var c=$(o.body);if($(c.children()[0]),$(o.body).on(h.join(" "),function(b){for(var c=b;c.originalEvent;)c=c.originalEvent;l(c,a)&&(c=AS.util.cloneEvent(c.type,c),a.parentNode.dispatchEvent(c))}),Modernizr.touch&&b(o),n(),e&&AS.browser.webkit){var d=o.createElement("style");d.innerHTML=k,o.body.appendChild(d)}if(AS.browser.desktop){if("function"==typeof p.linkReader)return m();g()}}function g(){var b=AS.config.get("widgets"),c=o.getElementsByTagName("head")[0],d=o.createElement("link");o.createElement("script"),b.reader=AS.router.readerURL,d.type="text/css",d.rel="stylesheet",d.href=b.reader+b.video.mediaElementCSSFile,d.media="screen",c.appendChild(d),_.defer(function(){if("function"==typeof a.contentWindow.loadReader)return void a.contentWindow.loadReader(b,jQuery);try{p.MediaElementWatch()}catch(c){}})}function m(){function a(a){"function"==typeof p.linkReader&&p.linkReader(a)}var b=AS.config.get("widgets");b.reader=AS.router.readerURL,p.linkReader({jQuery:jQuery}),p.widgetSettings=b,q.loadResource(b.reader+b.video.mediaElementJSFile,{success:function(b,c,d){a({js:b})},error:function(c){a({"js-file":b.reader+b.video.mediaElementJSFile})}}),q.loadResource(b.reader+b.video.mediaElementCSSFile,{success:function(b,c,d){a({css:b})},error:function(c){a({"css-file":b.reader+b.video.mediaElementCSSFile})}}),_.defer(function(){"function"==typeof p.MediaElementWatch?p.MediaElementWatch():void 0})}function n(){var a=o.createElement("script");a.innerHTML=i,AS.config.get("app.enableOffline")&&(a.innerHTML+=j),o.body.appendChild(a)}var o=a.contentDocument,p=($(o),a.contentWindow),q=AS.resourceManager;c?AS.offlineManager.read(d,{success:function(b){a.contentWindow.document.open("text/html","replace"),a.contentWindow.document.write(b),a.contentWindow.document.close(),f()},error:function(a){}}):f()},initialiseIframe:function(a){d(a)},disposeIframe:function(a){var b=$(a),d=$(a.contentDocument);a.contentDocument&&a.contentDocument.body&&(a.contentDocument.body.innerHTML=""),Modernizr.touch&&c(a.contentDocument),d.off(),b.off()}};var l=function(){function a(a,b){var d=c.map(function(b){return $(a.target).closest("[data-widget="+b+"]").length});return!("touchmove"===a.type&&_.max(d)>0)}function b(a,b){var c=b.contentWindow;return c.PR?c.PR.appCanScroll:!0}var c=["SLIDESHOW","SCROLLZONE","IMAGE360"];return function(c,d){var e=a(c,d),f=b(c,d);return e&&f}}()}(),function(){"use strict";AS.PlatformBridge={handlers:{changePage:"changePageHandler",navigateTo:"navigateToHandler",articleById:"articleByIdHandler",http:"webLinkHandler",https:"webLinkHandler",mailto:"mailToHandler",notification:"notificationHandler",alert:"alertHandler",geolocation:"geolocationHandler",localResource:"openFileHandler",video:"videoHandler",openImage:"openImageHandler",audio:"globalAudioHandler",reporting:"reportingHandler",internal:"internalHandler",screenshot:"screenshotHandler",savestate:"savestateHandler",resetstate:"resetstateHandler",jstap:"jsTapHandler",layer:"popupHandler"},widgetViews:{geolocationView:null,videoView:null,imageView:null},videoStats:{mediaStart:null,mediaStop:null},request:function(a,b){function c(a,b,c){for(var d=a.split(b);d.length>c;)d[c-1]=[d[c-1],d.splice(c,1)].join(b);return d}var d,e,f;return d=-1===a.indexOf("mailto:")?c(a,"://",2):c(a,":",2),2!==d.length&&"screenshot"!==d[0]?void 0:(e=d[0],f=d[1],void(this.handlers[e]&&this[this.handlers[e]].call(this,f,e,b)))},screenshotHandler:function(a){AS.message.trigger(AS.message.NOTIFICATION_SHOW,"screenshot-unavilable".toLocaleString())},internalHandler:function(a){if("string"!=typeof a)return!1;switch(a.toUpperCase()){case"ISSUES":return AS.message.trigger(AS.message.GOTO_STORE),!0;default:return!1}},reportingHandler:function(a){if("string"!=typeof a)return!1;try{if(a=JSON.parse(decodeURIComponent(a)),a.widget){var b=null!==a.widget.match("video"),c=null!==a.widget.match("audio");if(b||c){var d,e,f=(a.widget,a.action),g=a.path,h=1e3;if("play"===f)return this.videoStats.mediaStop=null,void(this.videoStats.mediaStart=(new Date).getTime());if(a={eventCategory:b?AS.Analytics.categories.VIDEO:AS.Analytics.categories.AUDIO,eventAction:g},"pause"===f){if(null===this.videoStats.mediaStart)return;this.videoStats.mediaStop=(new Date).getTime(),d=this.videoStats.mediaStop-this.videoStats.mediaStart,d>h&&(e=g,_.extend(a,{eventLabel:e,eventValue:d}),this.videoStats.mediaStop=null,this.videoStats.mediaStart=null)}}}return a.eventLabel=[AS.Session.getCurrentIssueId(),AS.Session.getCurrentArticleId(),a.label].join("/"),AS.message.trigger(AS.message.TRACK_EVENT,a),!0}catch(i){}},changePageHandler:function(a){if("string"!=typeof a)return!1;switch(a.toUpperCase()){case"NEXT":return AS.message.trigger(AS.message.PAGE_NAVIGATE_NEXT),!0;case"PREVIOUS":return AS.message.trigger(AS.message.PAGE_NAVIGATE_PREVIOUS),!0;default:return!1}},navigateToHandler:function(a){if("string"!=typeof a)return!1;try{if(a=JSON.parse(decodeURI(a)),a.articleId&&a.index){var b=AS.Session.getCurrentVariant().get("articles")[a.articleId],c=a.linkAnchor||null;"undefined"!=typeof b&&AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:Number(b)+Number(a.index),anchor:c})}else a.index&&AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:Number(a.index)});return!0}catch(d){}},geolocationHandler:function(a){var b=a.match(/-?\d+?.\d+/g),c=b[0],d=b[1];return AS.StateModel.get("isConnected")===!1&&AS.config.get("app.enableOffline")?void AS.message.trigger(AS.message.ALERT,"notification-offline-content-unavailable".toLocaleString()):(AS.message.trigger(AS.message.SHOW_GEOLOCATION,c,d),void(AS.extensions.check("Geolocation")&&this._trackEvent(AS.Analytics.categories.GEOLOCATION,a)))},articleByIdHandler:function(a){var b=AS.Session.getCurrentVariant().get("articles")[decodeURI(a)];"undefined"!=typeof b&&AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:Number(b)})},notificationHandler:function(a){AS.message.trigger(AS.message.NOTIFICATION_SHOW,a.toLocaleString())},alertHandler:function(a){AS.message.trigger(AS.message.ALERT,a.toLocaleString())},webLinkHandler:function(a,b){var c=b+"://"+a;if(AS.StateModel.get("isConnected")===!1&&AS.config.get("app.enableOffline"))return void AS.message.trigger(AS.message.ALERT,"notification-offline-content-unavailable".toLocaleString());if(window.open(c,"_blank"),AS.Session.getCurrentIssue()){var d=AS.Session.getCurrentIssueId(),e=AS.Session.getCurrentArticleId(),f=d+"/"+e;AS.message.trigger(AS.message.TRACK_EVENT,{eventCategory:AS.Analytics.categories.EXTERNAL_LINK,eventAction:a,eventLabel:f})}},mailToHandler:function(a){window.location.href="mailto:"+a,this._trackEvent(AS.Analytics.categories.EMAIL_LINK,a)},openFileHandler:function(a,b,c){var d=this.getAbsolutePath(a,c);AS.util.CURRENT_FRAMEWORK===AS.frameworks.GSA?this.notifyFramework("openFileHandler",a):window.open(d),this._trackEvent(AS.Analytics.categories.LOCAL_LINK,a)},videoHandler:function(a,b,c){var d;d=AS.StateModel.get("isConnected")&&!AS.config.get("app.enableOffline")?this.getAbsolutePath(a,c):a,AS.message.trigger(AS.message.SHOW_VIDEO,d),this._trackEvent(AS.Analytics.categories.VIDEO,a)},openImageHandler:function(a,b,c){var d=this.getAbsolutePath(a,c);AS.message.trigger(AS.message.SHOW_ZOOMABLE_IMAGE,d),this._trackEvent(AS.Analytics.categories.ZOOMABLE_IMAGE,a)},getAbsolutePath:function(a,b){return-1!==a.indexOf("data:")||-1!==a.indexOf("://")?a:b?b.replace(/\/(?:.(?!\/))+$/,"/"+a):a},notifyFramework:function(a,b){var c={};return c[AS.frameworks.GSA]=function(){return window.external.notify('{"type" : "'+a+'", "data" : "'+b+'" }'),!0},c._default=function(){return!1},_.contains(_.keys(c),AS.util.CURRENT_FRAMEWORK)?c[AS.util.CURRENT_FRAMEWORK]():c._default()},globalAudioHandler:function(a,b,c){var d=this.getAbsolutePath(a,c);AS.message.trigger(AS.message.PLAY_GLOBAL_AUDIO,{url:d}),this._trackEvent(AS.Analytics.categories.AUDIO,a)},savestateHandler:function(a){AS.Session.saveStateForCurrentPage(a)},resetstateHandler:function(){AS.Session.resetStateForCurrentPage()},jsTapHandler:function(){AS.Session.canTap=!1,_.delay(function(){AS.Session.canTap=!0},50)},popupHandler:function(a){this._trackEvent(AS.Analytics.categories.POPUP,a)},_trackEvent:function(a,b){if(AS.Session.getCurrentIssue()){var c=AS.Session.getCurrentIssueId(),d=AS.Session.getCurrentArticleId(),e=c+"/"+d;AS.message.trigger(AS.message.TRACK_EVENT,{eventCategory:a,eventAction:b,eventLabel:e})}}}}(),function(){"use strict";AS.config({app:{config:"reader-config.json",title:"App Studio",animConfig:"webreader/anim-config.json",fullScreenTooltip:{showDelay:1e3,hideDelay:5e3},auth:{authToken:"ASauth",authRoot:"",subscribeUrl:"",issue:"",passwordRequestUrl:"",launchLogin:!1,loginModalDelay:1e3,publicationCode:""},loading:{image:"webreader/images/loading-logo.png",backgroundColor:"#ffffff",color:"#333333"},params:{logLevel:-1},frameworkMode:"browser",workerBasePath:"webreader/scripts/workers",enableCookies:!0,enableOffline:!1,enablePromoted:!0,enableExternal:!0,mobileOnly:!1,backgroundLoading:!1,facingPages:!0,autofit:!0,images:{favicon:"webreader/images/favicon.png"}},animation:{loaderView:{fadeDuration:1500,fadeEasing:"easeOutSine"},issue:{pageMoveDuration:600,pageMoveEasing:"easeOutSine",arrowFadeDuration:150,touch:{pageMoveDuration:300}},toolbar:{fadeDuration:1e3,fadeEasing:"easeOutSine",touch:{fadeDuration:300}},store:{},zoom:{scaleDuration:200}},features:{timelineScrubber:!0,tableOfContents:!0,pageNavigation:!0,toolbarView:!0,opaqueOverlay:!0,navigatorView:!0,storeAccessibility:!0},widgets:{video:{mediaElementPluginPath:"video-player/",mediaElementJSFile:"video-player/mediaelement-and-player.js",mediaElementCSSFile:"video-player/mediaelementplayer.css",mediaElementControls:["playpause","progress","tracks","volume"],mediaElementControlsAlwaysShow:!1}},meta:[{name:"msapplication-TileColor",content:"#f0f0f0"},{name:"msapplication-TileImage",content:"webreader/images/apple-touch-icon.png"}],icons:{appleTouchIcon:{href:"webreader/images/apple-touch-icon.png",rel:"apple-touch-icon"},appleTouchIcon76x76:{href:"webreader/images/apple-touch-icon-76x76.png",size:"76x76",rel:"apple-touch-icon"},appleTouchIcon120x120:{href:"webreader/images/apple-touch-icon-120x120.png",size:"120x120",rel:"apple-touch-icon"},appleTouchIcon144x144:{href:"webreader/images/apple-touch-icon-144x144.png",size:"144x144",rel:"apple-touch-icon"},appleTouchIcon152x152:{href:"webreader/images/apple-touch-icon-152x152.png",size:"152x152",rel:"apple-touch-icon"},appleTouchIcon180x180:{href:"webreader/images/apple-touch-icon-180x180.png",size:"180x180",rel:"apple-touch-icon"},appleTouchIcon192x192:{href:"webreader/images/apple-touch-icon-192x192.png",size:"192x192",rel:"icon"}},loading:{appleTouchStartupImage640x920:{href:"webreader/images/apple-touch-startup-image-640x920.png",width:"320px",height:"480px",rel:"apple-touch-startup-image",pixelDensity:"2"},appleTouchStartupImage640x1096:{href:"webreader/images/apple-touch-startup-image-640x1096.png",width:"320px",height:"568px",rel:"apple-touch-startup-image",pixelDensity:"2"},appleTouchStartupImage768x1004:{href:"webreader/images/apple-touch-startup-image-768x1004.png",width:"768px",height:"1024px",rel:"apple-touch-startup-image",orientation:"portrait"},appleTouchStartupImage1024x748:{href:"webreader/images/apple-touch-startup-image-1024x748.png",width:"768px",height:"1024px",rel:"apple-touch-startup-image",orientation:"landscape"},appleTouchStartupImage1536x2008:{href:"webreader/images/apple-touch-startup-image-1536x2008.png",width:"768px",height:"1024px",rel:"apple-touch-startup-image",orientation:"portrait",pixelDensity:"2"},appleTouchStartupImage2048x1496:{href:"webreader/images/apple-touch-startup-image-2048x1496.png",width:"768px",height:"1024px",rel:"apple-touch-startup-image",orientation:"landscape",pixelDensity:"2"},appleTouchStartupImage750x1294:{href:"webreader/images/apple-touch-startup-image-750x1294.png",width:"375px",height:"667px",rel:"apple-touch-startup-image",orientation:"portrait"},appleTouchStartupImage1242x2148:{href:"webreader/images/apple-touch-startup-image-1242x2148.png",width:"414",height:"736px",rel:"apple-touch-startup-image",orientation:"portrait"}},dimensions:{portrait:{page:{width:768,height:1004},thumbnail:{width:125,height:163},store:{width:130,height:170,gutter:20,maxCols:6},timeline:{height:256}},landscape:{page:{width:1024,height:748},thumbnail:{width:164,height:120},store:{width:200,height:214,gutter:30},timeline:{height:223}}},scrubber:{height:48,contentScrubberSpace:30},zoomtoolbar:{items:[{title:"Auto Fit",cssClass:"zoomtoolbaritem",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" enable-background="new 0 0 30 30"><style type="text/css">.st0{fill:#676767;}</style><path class="st0" d="M23.6 3.9C20.7 1.5 17 .4 13.2.8c-3.3.4-6.3 1.8-8.6 4.1v-.5c0-.9-.5-1.4-1.3-1.4s-1.4.5-1.5 1.4v5c0 .8.7 1.4 1.4 1.4H8.4c.7 0 1.3-.7 1.2-1.4C9.6 8.6 9 8 8.3 8h-.7c3.5-3.4 9.2-3.8 13.2-.7 2.1 1.7 3.3 4 3.6 6.6.3 2.6-.5 5.2-2.1 7.3-1.7 2.1-4 3.3-6.6 3.6-2.6.3-5.2-.5-7.2-2.1-.5-.4-1-.6-1.6-.5s-1.1.3-1.5.8-.6 1-.5 1.6.3 1.1.8 1.5c2.6 2 5.8 3.2 9 3.2.5 0 1.1 0 1.6-.1 3.7-.3 7.2-2.2 9.6-5.2 4.7-6.1 3.8-15.1-2.3-20.1z"/></svg>',buttonAction:AS.message.AUTO_FIT_PAGEVIEW,allowedFrameworks:["browser","GSA"]},{title:"Zoom Increase",cssClass:"zoomtoolbaritem",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" enable-background="new 0 0 30 30"><style type="text/css">.st0{fill:#676767;}</style><path class="st0" d="M12.3 26.4V3.9c0-1.4 1.2-2.6 2.6-2.6 1.4 0 2.6 1.2 2.6 2.6v22.5c0 1.4-1.2 2.6-2.6 2.6-1.5 0-2.6-1.2-2.6-2.6zM26.1 17.7H3.5c-1.4 0-2.6-1.2-2.6-2.6 0-1.4 1.2-2.6 2.6-2.6H26c1.4 0 2.6 1.2 2.6 2.6.1 1.5-1.1 2.6-2.5 2.6z"/></svg>',buttonAction:AS.message.ZOOM_PAGEVIEW_INCREASE,allowedFrameworks:["browser","GSA"]},{title:"Zoom Decrease",cssClass:"zoomtoolbaritem",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" enable-background="new 0 0 30 30"><style type="text/css">.st0{fill:#676767;}</style><path class="st0" d="M26.1 17.7H3.5c-1.4 0-2.6-1.2-2.6-2.6 0-1.4 1.2-2.6 2.6-2.6H26c1.4 0 2.6 1.2 2.6 2.6.1 1.5-1.1 2.6-2.5 2.6z"/></svg>',buttonAction:AS.message.ZOOM_PAGEVIEW_DECREASE,allowedFrameworks:["browser","GSA"]},{title:"Exit Zoom View",cssClass:"zoomtoolbaritem",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" enable-background="new 0 0 30 30"><style type="text/css">.st0{fill:#676767;}</style><path class="st0" d="M21 24.8L5.1 8.9c-1-1-1-2.7 0-3.7s2.7-1 3.7 0l15.9 15.9c1 1 1 2.7 0 3.7-1.1 1.1-2.7 1-3.7 0zM24.6 8.9l-16 16c-1 1-2.7 1-3.7 0s-1-2.7 0-3.7L20.8 5.3c1-1 2.7-1 3.7 0 1.1 1 1.1 2.6.1 3.6z"/></svg>',buttonAction:AS.message.ZOOM_MODE_TOGGLE,allowedFrameworks:["browser","GSA"]}]},toolbar:{items:[{title:"Window",cssClass:"windowmode",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><g ><path d="M16.402 6.052l-3.26 3.26 2.322 2.32 3.26-3.258 2.45 2.45.515-7.74-7.74.517zM6.656 15.795l3.26-3.26 2.323 2.323-3.26 3.26 2.45 2.45-7.74.516.515-7.74z"/></g></svg>',tooltip:"tooltip-fullscreen-enter",buttonAction:AS.message.TOGGLE_FULL_SCREEN,allowedFrameworks:["browser"]},{title:"Store",cssClass:"store",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><g ><path d="M22.148 7.49l-.032-.018c-.05-.03-.103-.06-.16-.083v-.01L14.263 3c-.183-.046-.383-.078-.605-.078-.207 0-.394.028-.568.07l-8.042 4.58c-.088.08-.14.175-.14.277 0 .096.045.185.125.265l7.962 4.843c.42.163.533.163.662.163.12 0 .354 0 .697-.17l7.93-4.823c.08-.08.124-.168.124-.263 0-.144-.1-.27-.26-.374zM22.148 11.496l-.032-.02c-.05-.03-.103-.058-.16-.083v-.008l-.897-.51-6.705 4.076c-.344.17-.578.17-.697.17-.13 0-.24 0-.662-.162l-6.718-4.085-1.23.7c-.087.084-.14.177-.14.278 0 .098.046.19.126.27l7.962 4.84c.42.165.533.165.662.165.12 0 .354 0 .697-.17l7.93-4.826c.08-.08.124-.168.124-.264-.002-.14-.1-.267-.262-.37zM22.148 15.29l-.032-.018c-.05-.03-.103-.058-.16-.083v-.01l-.897-.51-6.705 4.077c-.344.17-.578.17-.697.17-.13 0-.24 0-.662-.164l-6.72-4.083-1.228.7c-.088.083-.14.176-.14.278 0 .097.045.187.125.267l7.962 4.842c.42.165.533.165.662.165.12 0 .354 0 .697-.17l7.93-4.825c.08-.08.124-.17.124-.264 0-.142-.1-.27-.26-.373z"/></g></svg>',tooltip:"store",buttonAction:AS.message.GOTO_STORE,allowedFrameworks:["browser"]},{title:"Contents",cssClass:"store",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><g ><circle cx="13.042" cy="19.781" r="2.303"/><circle cx="13.042" cy="12.084" r="2.303"/><path d="M13.042 2.083c1.272 0 2.302 1.027 2.302 2.304 0 1.27-1.03 2.303-2.302 2.303-1.273 0-2.304-1.03-2.304-2.303 0-1.276 1.03-2.304 2.304-2.304z"/></g></svg>',tooltip:"TOC",buttonAction:AS.message.TOC_TOGGLE,allowedFrameworks:["browser","GSA"]},{title:"Share",cssClass:"sharing",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><path  d="M19.115 14.63c-.843 0-1.598.36-2.132.933l-7.13-3.23c.02-.117.04-.233.04-.358 0-.133-.022-.258-.04-.387l7.076-3.05c.535.608 1.31 1 2.185 1 1.615 0 2.926-1.31 2.926-2.927 0-1.613-1.31-2.923-2.925-2.923-1.613 0-2.926 1.31-2.926 2.924 0 .14.02.275.042.408l-7.066 3.047C8.63 9.447 7.848 9.05 6.97 9.05c-1.618 0-2.93 1.31-2.93 2.925 0 1.617 1.312 2.925 2.93 2.925.922 0 1.735-.438 2.27-1.106l7.01 3.176c-.04.19-.06.384-.06.586 0 1.615 1.31 2.926 2.926 2.926 1.617 0 2.926-1.31 2.926-2.926 0-1.618-1.31-2.927-2.927-2.927z"/></svg>',
tooltip:"social-sharing",buttonAction:AS.message.SHARE,view:"AS.SharingView",allowedFrameworks:["browser","GSA"]},{title:"Help",cssClass:"help",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="25" height="28.125" viewBox="0 0 25 28.125"><path  d="M8.375 4.477c1.06-.684 2.348-1.02 3.89-1.02 2.032 0 3.712.482 5.043 1.45 1.347.966 2.01 2.402 2.01 4.297 0 1.166-.29 2.15-.863 2.944-.347.484-.992 1.1-1.968 1.853l-.94.743c-.525.402-.863.87-1.033 1.41-.11.34-.167.867-.177 1.586H10.7c.05-1.517.198-2.562.427-3.138.228-.58.826-1.248 1.794-2l.98-.762c.32-.244.575-.508.77-.795.364-.495.547-1.034.547-1.628 0-.68-.202-1.3-.606-1.857-.39-.56-1.112-.84-2.168-.84-1.037 0-1.777.344-2.207 1.035-.432.686-.65 1.408-.65 2.15H5.7c.103-2.552.998-4.363 2.675-5.428zm2.23 15.103h4.014v3.883h-4.015V19.58z"/></svg>',tooltip:"help-menu-title",buttonAction:AS.message.HELP,allowedFrameworks:["browser","GSA"]},{title:"Audio",cssClass:"audio",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><path  d="M23.152 12.742l-.312 4.47c-.035.517-.486.91-1.004.873l-1.525-.107c-.52-.036-.91-.485-.872-1.004l.312-4.47c.03-.42.332-.743.72-.837-.282-3.464-3.187-6.196-6.722-6.196-3.53 0-6.43 2.725-6.72 6.18.458.033.837.382.872.855l.312 4.47c.035.518-.355.968-.875 1.005l-1.525.107c-.518.036-.97-.357-1.004-.874l-.312-4.47c-.027-.397.195-.75.533-.912.204-4.644 4.022-8.35 8.718-8.35 4.682 0 8.49 3.684 8.717 8.308.418.118.72.5.687.954zm-4.56 1.93c0 2.656-2.154 4.81-4.81 4.81-2.655 0-4.806-2.154-4.806-4.81 0-2.654 2.15-4.808 4.807-4.808 2.655 0 4.81 2.154 4.81 4.81zm-2.358 0l-3.924-2.267v4.535l3.924-2.267z"/></svg>',tooltip:"audio-player",buttonAction:AS.message.TOGGLE_GLOBAL_AUDIO,allowedFrameworks:["browser","GSA"]},{title:"Bookmarks",cssClass:"bookmarking",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><path  d="M16.517 3.083H6.93c-.3 0-.542.24-.542.54v16.92c0 .3.243.54.54.54l4.694-5.812 4.895 5.813c.3 0 .54-.24.54-.54V3.623c0-.298-.242-.54-.54-.54zM13.56 8.925m-.715-2.198-2.31 0-.717 2.198 1.872 1.36"/></svg>',tooltip:"bookmark-title",buttonAction:AS.message.BOOKMARK,allowedFrameworks:["browser","GSA"]},{title:"Zoom",svgData:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path  d="M6.025 10.427V7.795L3.39 7.793V6.037h2.635v-2.63h1.752v2.63h2.635v1.756H7.777v2.634z"/><path  d="M18 15.907l-5.26-5.266c.69-1.075 1.094-2.35 1.094-3.722C13.834 3.098 10.737 0 6.916 0 3.096 0 0 3.097 0 6.917s3.097 6.92 6.916 6.92c1.375 0 2.654-.407 3.732-1.1L15.904 18 18 15.907zM1.8 6.917C1.8 4.097 4.096 1.8 6.916 1.8s5.118 2.296 5.118 5.117c0 2.823-2.297 5.12-5.118 5.12-2.82 0-5.116-2.297-5.116-5.12z"/></svg>',tooltip:"help-zoom-title",buttonAction:AS.message.ZOOM,allowedFrameworks:["browser","GSA"]},{title:"Spread View",cssClass:"spreadview",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 69.9 25" enable-background="new 0 0 69.9 25"><g ><path d="M6.7 3v3.4H3v15.7h15V3zM6.7 3L3 6.4"/></g><g ><path d="M36.7 3v3.4H33v15.7h15V3zM36.7 3L33 6.4"/></g><g ><path d="M60.3 3v3.4H64v15.7H49V3zM60.3 3L64 6.4"/></g></svg>',tooltip:"spread-view",buttonAction:AS.message.SPREAD_VIEW_TOGGLE,view:"AS.SpreadView",allowedFrameworks:["browser"]},{title:"Toggle Zoom Mode",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" enable-background="new 0 0 30 30"><style type="text/css">.st0{fill:#676767;} .st1{fill:none;}</style><path class="st0" d="M11.8 18.8V7.6c0-.7.6-1.3 1.3-1.3.7 0 1.3.6 1.3 1.3v11.2c0 .7-.6 1.3-1.3 1.3-.7 0-1.3-.6-1.3-1.3zM18.7 14.4H7.5c-.7 0-1.3-.6-1.3-1.3 0-.7.6-1.3 1.3-1.3h11.2c.7 0 1.3.6 1.3 1.3 0 .8-.5 1.3-1.3 1.3z"/><path class="st1" d="M21.8 13.2c0 4.8-3.8 8.6-8.7 8.6-4.8 0-8.7-3.9-8.7-8.7s3.9-8.6 8.7-8.6c4.8 0 8.7 3.9 8.7 8.7z"/><path class="st0" d="M28 24.9L23.1 20c-.1-.1-.2-.2-.3-.2 1.3-1.9 2-4.2 2-6.6 0-6.4-5.2-11.8-11.7-11.8S1.5 6.7 1.5 13.2s5.2 11.7 11.7 11.7c2.7 0 5.1-.9 7-2.4l.2.2 4.9 4.9c.7.6 1.9.6 2.7 0 .7-.7.7-2 0-2.7zm-14.9-3.1c-4.8 0-8.7-3.9-8.7-8.7s3.9-8.6 8.7-8.6c4.8 0 8.7 3.9 8.7 8.7 0 4.8-3.8 8.6-8.7 8.6z"/></svg>',buttonAction:AS.message.ZOOM_MODE_TOGGLE,allowedFrameworks:["browser","GSA"]}]},toc:{tocWidth:290,openList:!1,showImage:!0,showDescription:!0},toolbarItems:{socialSharing:!0,globalAudioPlayer:!0},timelineScrubber:{mouseHoverNavigation:!1},sharing:{options:{facebookShare:!0,twitterShare:!0,emailShare:!0,linkedinShare:!0}},offline:{dbName:"appstudio"},analytics:{GoogleAnalyticsInternal:{trackingId:"UA-15261962-27",enhancedLinkAttribution:!1,anonymizeIp:!1}}})}(),function(){"use strict";function a(a){AS.Session.getCurrentIssue()&&_.extend(a,{dimension2:AS.Session.getCurrentIssue().getCurrentArticle().type,dimension3:AS.Session.getCurrentPage().get("section").name,dimension4:AS.Session.getCurrentPageIndex().toString()}),AS.Session.authenticated&&_.extend(a,{dimension5:AS.Session.userid})}AS.message.on(AS.message.APPLICATION_START,function(){var a=new AS.structs.Set,b="analytics.GoogleAnalyticsInternal";if(a.add(AS.config.get(b).trackingId),AS.config.has(AS.Analytics.GADelegate.configKey)){var c=AS.config.get(AS.Analytics.GADelegate.configKey).trackingId;if("string"==typeof c&&c.length>0){var d=AS.config.get(AS.Analytics.GADelegate.configKey).enhancedLinkAttribution;void 0!==d&&(AS.config.get(b).enhancedLinkAttribution=d);var e=AS.config.get(AS.Analytics.GADelegate.configKey).anonymizeIp;void 0!==e&&(AS.config.get(b).anonymizeIp=e),a.add(AS.config.get(AS.Analytics.GADelegate.configKey).trackingId)}}AS.config.get(b).trackingId=a.getValues(),AS.config.get("analytics").GoogleAnalytics=AS.config.get(b),AS.Analytics.registerDelegate(AS.Analytics.GADelegate),AS.Analytics.initialize()}),AS.Analytics={categories:{APPLICATION:"Application",ISSUE:"Issue",BOOKMARK:"Bookmark",EXTERNAL_LINK:"ExternalLink",SHARE:"Share",VIDEO:"PlayVideo",AUDIO:"PlayAudio",EMAIL_LINK:"EmailLink",FLIP:"Flip",ZOOMABLE_IMAGE:"ZoomableImage",GEOLOCATION:"Geolocation",POPUP:"Popup",LOCAL_LINK:"LocalLink",USER_ID:"User Id",CUSTOM_VARIABLE:"Custom Variable"},actions:{VIEW:"View",FULLSCREEN:"Fullscreen",ADD:"Add",INTERACT:"Interact",EMAIL:"Email",TWITTER:"Twitter",FACEBOOK:"Facebook",LINKEDIN:"LinkedIn",PLAYDURATION:"PlayDuration",AUTHENTICATED:"AUTHENTICATED",UNAUTHENTICATED:"UNAUTHENTICATED",USER_TRACKING:"User Tracking"},initialized:!1,delegates:[],initialize:function(){_.bindAll(this),this.initialized=!0,AS.message.on(AS.message.ONLINE,this.onlineChange),AS.message.on(AS.message.OFFLINE,this.onlineChange),this.setupEvents()},onlineChange:function(){this.setupEvents(),this.initDelegates()},setupEvents:function(){var a=AS.resourceManager.isOnline?"on":"off";AS.message[a](AS.message.TRACK_EVENT,this.trackEvent),AS.message[a](AS.message.TRACK_PAGE,this.trackPageView),AS.message[a](AS.message.UNAUTHENTICATED,this.stopTrackingUser),AS.message[a](AS.message.AUTHENTICATED,this.startTrackingUser)},initDelegates:function(){this.forEach(function(a){a.initialize()})},registerDelegate:function(a){this.delegates.push(a),a.configKey&&(a.config=AS.config.get(a.configKey)),a.initialize()},trackEvent:function(b){this.initialized&&(a(b),this.forEach(function(a){a.hasOwnProperty("trackEvent")&&a.trackEvent(b)}))},startTrackingUser:function(a,b){this.initialized&&this.forEach(function(c){c.hasOwnProperty("startTrackingUser")&&c.startTrackingUser(a,b)})},stopTrackingUser:function(a,b){this.initialized&&this.forEach(function(c){c.hasOwnProperty("stopTrackingUser")&&c.stopTrackingUser(a,b)})},trackPageView:function(a){this.initialized&&this.forEach(function(b){b.hasOwnProperty("trackPageView")&&b.trackPageView(a)})},resetTracking:function(a){this.initialized&&this.forEach(function(b){b.hasOwnProperty("resetTracking")&&b.resetTracking(a)})},forEach:function(a){this.delegates.forEach(a)}},AS.Analytics.GADelegate={configKey:"analytics.GoogleAnalytics",trackerNames:[],config:void 0,initialize:function(){if(!this.isInitialized()&&AS.resourceManager.isOnline){var a=(window._gaq=window._gaq||[],this),b=this.config.trackingId;!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),_.each(b,function(b){var c=b.toAlphaNumericString();ga("create",b,{name:c}),a.config.enhancedLinkAttribution===!0&&ga(c+".require","linkid","linkid.js"),a.config.anonymizeIp===!0&&ga(c+".set","anonymizeIp",!0),a.trackerNames.push(c)})}},trackEvent:function(a){this.isInitialized()&&_.each(this.trackerNames,function(b){ga(b+".send","event",a)})},startTrackingUser:function(a,b){var c=b&&b.userid?b.userid:"";""!==c&&this.dispatchUserIdTrackingEvent(AS.Analytics.actions.AUTHENTICATED,c)},stopTrackingUser:function(a,b){var c=b&&b.userid?b.userid:"";""!==c&&this.dispatchUserIdTrackingEvent(AS.Analytics.actions.UNAUTHENTICATED,c)},dispatchUserIdTrackingEvent:function(a,b){this.isInitialized()&&(ga("set","dimension5",a+":"+b),this.trackEvent({eventCategory:AS.Analytics.categories.CUSTOM_VARIABLE,eventAction:AS.Analytics.actions.USER_TRACKING,eventLabel:"-"}))},trackPageView:function(a){this.isInitialized()&&_.each(this.trackerNames,function(b){ga(b+".send","pageview",a)})},resetTracking:function(a){this.isInitialized()&&(window["ga-disable-"+AS.config.get("analytics")]=a)},isInitialized:function(){return"undefined"!=typeof ga}}}(),function(){"use strict";AS.PublicationModel=Backbone.Model.extend({idAttribute:"name",parse:function(a){var b;for(b in a)"issues"!==b&&a.hasOwnProperty(b)&&this.set(b,a[b],{silent:!0});var c=new AS.IssueSummaryCollection(a.issues),d=this;this.set("issues",c,{silent:!0}),c.forEach(function(a){a.set("publication",d)}),this.setUserAccess(!AS.AuthProxy.enabled||AS.Session.authenticated),this.storeLayout()},initialize:function(){this.urlRoot=AS.config.get("publication.urlRoot"),this.url=this.urlRoot+AS.config.get("publication.configFilename")},storeLayout:function(){var a=this.get("issues");a.length>0&&a.at(0).set("type","promoted")},setUserAccess:function(a,b){this.get("issues").forEach(function(c){var d=c.get("isFree")||a&&(!b||b.indexOf(c.get("actualId"))>=0);c.set("viewable",d)})},hasSubscriptionIssues:function(){for(var a=this.get("issues"),b=0;b<a.length;b++)if(!a.at(b).get("isFree"))return!0;return!1}})}(),function(){"use strict";var a=Backbone.Model.extend({defaults:{isConnected:!0,isZoomMode:!1},initialize:function(){var a=this;_.bindAll(this),AS.message.on(AS.message.OFFLINE,a.offline),AS.message.on(AS.message.ONLINE,a.online),AS.message.on(AS.message.ZOOM_MODE_TOGGLE,a.toggleZoomMode)},offline:function(){this.set("isConnected",!1)},online:function(){this.set("isConnected",!0)},toggleZoomMode:function(){this.set("isZoomMode",!this.get("isZoomMode")),AS.message.trigger(AS.message.ZOOM_MODE_UPDATE)},isZoomMode:function(){return this.get("isZoomMode")}});AS.StateModel=new a}(),function(){"use strict";AS.PageModel=Backbone.Model.extend({defaults:function(){return{isLoading:!1,isLoaded:!1,article:void 0,variant:void 0,index:void 0,url:void 0,anchorPoint:null}},url:function(){return this.resolveUrl(this.get("url"))},thumbnailUrl:function(){return this.resolveUrl(this.get("thumbnail"))},resolveUrl:function(a){return this.get("issue").urlRoot()+"/"+a},load:function(){this.set("isLoaded",!1),this.trigger(AS.PageModel.LOAD_START)},index:function(){return this.collection.indexOf(this)},loadComplete:function(){this.set("isLoaded",!0),this.set("isLoading",!1),this.set("isActive",!1),this.trigger(AS.PageModel.LOAD_COMPLETE),AS.message.trigger(AS.message.PAGE_LOADED,this.index())}}),_.extend(AS.PageModel,{LOAD_START:"page:loadStart",LOAD_COMPLETE:"page:loadComplete"})}(),function(){"use strict";AS.VariantModel=Backbone.Model.extend({defaults:{currentPageIndex:0,orientation:"landscape",pages:[],fontSize:"16"},initialize:function(a){var b=[],c={},d=this,e=0;a.pages.forEach(function(f){var g=f.section,h=b[b.length-1];g||(g={name:"contents",colour:"#999999",pages:[]}),h&&h.name===g.name||(b.push(g),g.pages=[],h=g),f.section=h,f.issue=a.issue,f.variant=d,f.index=e,e++,h.pages.push(f),c[g.name]||(c[g.name]={name:g.name,colour:g.colour,pages:[]}),c[g.name].pages.push(f)}),this.set({pages:new AS.PageCollection(a.pages),sections:b,singleSections:c,dimensions:AS.config.get("dimensions."+a.orientation)})}})}(),function(){"use strict";function a(a,b){var c;return c=b.filter(function(b){return b.get("orientation")===a})[0]}AS.IssueModel=Backbone.Model.extend({defaults:{scrolling:!1},offline:!1,url:function(){return this.urlRoot()+"/issue.json"},fetch:function(){function a(a){b.offline=a,b.constructor.__super__.fetch.apply(b,c)}var b=this,c=arguments;this.offlineCheck(a)},urlRoot:function(){var a=this.get("summary"),b="/";return a&&(b=AS.util.RETINA&&a.has("retinaBundle")?a.get("retinaBundle"):a.get("bundle"),b=b.replace(".zip","")),b=AS.util.stripTrailingSlash(b)},parse:function(b){var c=this,d=this.get("summary"),e=AS.config.get("publication.orientation");if(b=JSON.parse(decodeURIComponent(JSON.stringify(b))),b.id||(b.id=d.get("actualId")),!b.id)throw new Error("Issue ID not specified for issue '"+b.name+"'.");return b.actualId=b.id,b.id=AS.util.parseIssueId(b.id),b.contents=new AS.PageCollection(b.contents),b.variants.forEach(function(a){a.issue=c,a.articles={},a.pages.forEach(function(c,d){var e=c.contents[0].href,f=e.substr(1);try{c.article=b.contents.get(f).toJSON(),"undefined"==typeof a.articles[c.article.id]&&(a.articles[c.article.id]=d)}catch(g){throw new Error("Unmapped page in contents array: "+e)}})}),b.variants=new AS.VariantCollection(b.variants),b.currentVariant=a(e,b.variants),b.currentVariant||(b.currentVariant=b.variants.at(0)),this.loaded=!0,b},setCurrentVariant:function(a){var b=this.getVariantByName(a);b&&(this.set("currentVariant",b),AS.message.trigger(AS.message.VARIANT_CHANGE,a))},getVariantByName:function(b){return a(b,this.get("variants"))},getPageById:function(a){var b;return this.get("variants").forEach(function(c){b=b||c.get("pages").get(a)}),b},getCurrentPage:function(){var a=this.get("currentVariant"),b=a.get("currentPageIndex"),c=a.get("pages").at(b);return c},getCurrentArticle:function(){var a=this.getCurrentPage();return a?a.get("article"):void 0},isValid:function(){var a=this.get("currentVariant"),b=a.get("pages");return b&&b.length>0},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this);return a.isFree=this.get("isFree")||!1,a.isOffline=this.offline,a},offlineCheck:function(a){var b,c,d;d=this.get("publication")?this.get("publication").id:AS.router.publicationModel.id,b=d+"-"+this.get("summary").id,AS.offlineManager.read(b,{success:function(b){c=!1,b&&(c=!0),"function"==typeof a&&a(c)},error:function(b){"function"==typeof a&&a(!1)}})}})}(),function(){"use strict";AS.IssueSummaryModel=Backbone.Model.extend({defaults:{imageSrc:""},masterKeys:["bundle","retinaBundle","tabletIssuePath","media:thumbnail","thumbnails","media:content","previews"],set:function(a,b){return"object"==typeof a&&(_.each(this.masterKeys,function(b){if(a.hasOwnProperty(b)){var c=a[b];if("object"==typeof c)for(var d in c)c.hasOwnProperty(d)&&(c[d]=this.convertURL(c[d]));else a[b]=this.convertURL(a[b])}},this),a.publishedDate=moment(a.publishedDate).toDate(),a.actualId=a.id,a.id=AS.util.parseIssueId(a.id),a.type="normal",a.pubtitle=AS.config.get("publication.title"),a.orientation=AS.config.get("publication.orientation"),a.promo="store-promo".toLocaleString()),Backbone.Model.prototype.set.apply(this,arguments)},convertURL:function(a){return a.search(/http/)>=0?a:(this.urlRoot=AS.config.get("publication.urlRoot"),a=AS.util.stripLeadingSlash(a),this.urlRoot+a)},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this);return a.isFree=this.get("isFree")||!1,a}})}(),function(){"use strict";AS.ToolbarItemModel=Backbone.Model.extend({defaults:{title:"",cssClass:"",svgData:"",tooltip:"",buttonAction:"",view:null,allowedFrameworks:[]}})}(),function(){"use strict";AS.IssueSummaryCollection=Backbone.Collection.extend({model:AS.IssueSummaryModel,comparator:function(a){return-a.get("publishedDate")}})}(),function(){"use strict";AS.VariantCollection=Backbone.Collection.extend({model:AS.VariantModel,getByOrientation:function(a){return this.filter(function(b){return b.get("orientation")===a})[0]}})}(),function(){"use strict";AS.PageCollection=Backbone.Collection.extend({model:AS.PageModel})}(),function(){"use strict";AS.ToolbarItemCollection=Backbone.Collection.extend({model:AS.ToolbarItemModel})}(),function(){"use strict";AS.PageLoadController=function(){_.bindAll(this),this.inProgress=!1},_.extend(AS.PageLoadController.prototype,{queue:void 0,currentPageIndex:0,inProgress:!1,$iframe:void 0,nextTimeoutId:0,visitedSet:void 0,initQueue:function(a){var b=this;this.model=a,this.inProgress=!1;var c=function(a){var c=document.createElement("iframe");c.id="page-loader",c.style.display="none",c.setAttribute("data-enablescripts","false"),c.setAttribute("sandbox","allow-same-origin allow-scripts"),b.$iframe=c,document.body.appendChild(c),c.addEventListener("load",a)};if(Modernizr.touch)c(function(){AS.message.trigger(AS.message.CLOSE_LOADING)});else{var d=AS.config.get("app.backgroundLoading");(AS.StateModel.get("isConnected")===!1||AS.util.isIE())&&(d=!1),d===!1||this.$iframe||(this.inProgress=!0,c(this.iframeLoadComplete))}this.queue=this.model.get("pages").clone(),this.queue.comparator=this.loadSequenceComparator,this.visitedSet=new AS.structs.Set},start:function(a){this.inProgress||(this.startIndex=void 0,this.bringToFront("undefined"==typeof a?0:a),this.inProgress=!0,this.currentPageIndex=0)},pause:function(){this.inProgress&&(clearTimeout(this.nextTimeoutId),this.cancelCurrentLoadingPage(),this.inProgress=!1)},resume:function(){this.inProgress||(this.inProgress=!0,this.next())},shift:function(a){clearTimeout(this.nextTimeoutId),this.queue&&(this.pause(),this.bringToFront(a),this.resume())},cancelCurrentLoadingPage:function(){clearTimeout(this.nextTimeoutId),this.currentLoadingPage&&this.currentLoadingPage.off(AS.PageModel.LOAD_COMPLETE,this.pageLoadComplete)},bringToFront:function(a){a!==this.startIndex&&(this.startIndex=a,this.currentPageIndex=0,this.queue&&this.queue.sort())},next:function(){return clearTimeout(this.nextTimeoutId),this.queue&&this.currentPageIndex!==this.queue.length?(this.currentLoadingPage=this.queue.at(this.currentPageIndex),void(this.currentLoadingPage?(this.currentLoadingPage.on(AS.PageModel.LOAD_COMPLETE,this.pageLoadComplete),this.currentLoadingPage.load(),!this.visitedSet.contains(this.currentLoadingPage.url())&&this.$iframe?(this.inProgress=!0,this.$iframe.contentWindow.location.replace(this.currentLoadingPage.url())):this.visitedSet.getValues().length<this.queue.length&&this.$iframe&&this.pageLoadComplete()):this.pageLoadComplete())):void this.pause()},loadSequenceComparator:function(a,b){var c=this.model.get("pages"),d=c.indexOf(a),e=c.indexOf(b),f=Math.abs(this.startIndex-d),g=Math.abs(this.startIndex-e+.5);return f-g},iframeLoadComplete:function(){if(this.$iframe){var a=this.$iframe;"undefined"==typeof a.stop?a.contentDocument.execCommand("Stop"):a.stop(),a.contentWindow&&a.contentWindow.offScreen&&a.contentWindow.offScreen(),a.contentDocument.body.innerHTML="",this.currentLoadingPage&&this.visitedSet.add(this.currentLoadingPage.url())}this.currentLoadingPage&&this.currentLoadingPage.loadComplete()},pageLoadComplete:function(){this.cancelCurrentLoadingPage(),this.currentPageIndex++,this.inProgress&&(this.nextTimeoutId=setTimeout(this.next,100))}})}(),function(){"use strict";var a=AS.util.iframeCount(),b=Math.floor(a/2);AS.PageListViewController=function(a){_.bindAll(this),this.pageListView=a,this.pages=[],this.frames=[],this.unusedFrames=[],this.currentPage=void 0},AS.PageListViewController.prototype={pages:void 0,frames:void 0,unusedFrames:void 0,currentPage:void 0,pageListView:void 0,setFrameCount:function(a){var b;if(this.releaseAllFrames(),this.frames.length>a)for(;this.frames.length>a;)this.frames.pop().dispose();else for(;this.frames.length<a;)b=new AS.PageFrameView,this.frames.push(b),this.unusedFrames.push(b)},addPage:function(a,b){void 0===b?this.pages.push(a):this.pages[b]=a},getPageAt:function(a){return this.pages[a]},releaseFrame:function(a){a.release(),-1===this.unusedFrames.indexOf(a)&&this.unusedFrames.push(a)},assignFrame:function(a){if(a.frameView)return a.validate(),a.frameView;var b=this.unusedFrames.shift(),c=this;return b&&a.attachFrameView(b),this.frames=this.frames.sort(this.framesComparator),_.each(this.frames,function(a){a.$el.attr("data-index",c.frames.indexOf(a))}),b},pageForFrame:function(a){var b;return _.each(this.pages,function(c){c.frameView===a&&(b=c)}),b},framesComparator:function(a,b){var c=this.pageForFrame(a),d=this.pageForFrame(b),e=c?c.pageIndex:0,f=d?d.pageIndex:0;return e-f},assignAllFrames:function(a){var c,d,e=this,f=Math.max(a-b,0),g=Math.min(a+b,this.pages.length-1);for(c=0;f>c;c++)d=this.pages[c],d.frameView&&this.releaseFrame(d.frameView);for(c=g+1;c<this.pages.length;c++)d=this.pages[c],d.frameView&&this.releaseFrame(d.frameView);for(_.each(this.frames,function(a){var b=a.pageIndex();-1!==b&&(f>b||b>g)&&e.releaseFrame(a)}),c=f;g>=c;c++)this.assignFrame(this.pages[c])},releaseAllFrames:function(){this.pages.forEach(function(a){a.releaseFrameView()}),this.frames.forEach(this.releaseFrame)},getCurrentPage:function(){return this.currentPage},setCurrentPage:function(a){this.currentPage=a,a&&this.assignAllFrames(this.getCurrentPageIndex())},getCurrentPageIndex:function(){return this.getCurrentPage().pageIndex},setCurrentPageIndex:function(a){return this.setCurrentPage(this.pages[a]),this.currentPage},updatePageVisibility:function(a){_.each(this.pages,function(b){b.updateVisibility(a)})},disposePages:function(){_.each(this.pages,function(a){a.dispose()}),this.pages=[]},disposeUnusedPages:function(){for(var a=0;this.pages.length>this.pageListView.collection.length;)this.pages.pop().dispose(),a++}}}(),function(){"use strict";var a="ASlaunch";AS.AppController=function(){_.bindAll(this),this.pageLoadController=new AS.PageLoadController,this.audioController=new AS.AudioPlayerController,AS.message.on(AS.message.ISSUE_LOADED,this.issueLoaded),AS.message.on(AS.message.ISSUE_UNLOADED,this.issueUnloaded),AS.message.on(AS.message.PUBLICATION_LOADED,this.onPublicationLoaded),AS.message.on(AS.message.VARIANT_CHANGE,this.variantChanged),AS.message.on(AS.message.PAGE_INITIALISED,this.pageNavigate),AS.message.on(AS.message.TOGGLE_FULL_SCREEN,this.toggleFullScreen),AS.message.on(AS.message.SHOW_GEOLOCATION,this.onShowGeolocation),AS.message.on(AS.message.SHOW_VIDEO,this.onShowVideo),AS.message.on(AS.message.SHOW_ZOOMABLE_IMAGE,this.onShowZoomableImage),this.orientationSetup()},_.extend(AS.AppController.prototype,{widgetViews:{geolocationView:null,videoView:null,imageView:null},issueLoaded:function(a){this.model=a,this.audioController.start()},startQueue:function(){var a=this.model.get("currentVariant");this.pageLoadController.initQueue(a),this.pageLoadController.start(a.get("currentPageIndex"))},variantChanged:function(a){this.pageLoadController.pause(),_.delay(this.startQueue)},issueUnloaded:function(){this.pageLoadController.pause(),this.audioController.stop()},pageNavigate:function(a){this.pageLoadController.shift(a)},toggleFullScreen:function(a){var b=AS.util.isFullScreen();b?(AS.util.exitFullScreen(),AS.message.trigger(AS.message.FULL_SCREEN_EXIT)):(AS.util.requestFullScreen(a),AS.message.trigger(AS.message.FULL_SCREEN_ENTER))},onShowGeolocation:function(a,b){return AS.extensions.check("Geolocation")?(this.widgetViews.geolocationView||(this.widgetViews.geolocationView=new AS.GeolocationView(this.getPageDimensions())),this.widgetViews.geolocationView.render(),void this.widgetViews.geolocationView.openGeolocation(a,b)):void AS.message.trigger(AS.message.NOTIFICATION_SHOW,"geolocation-unavailable".toLocaleString())},onShowVideo:function(a){this.widgetViews.videoView||(this.widgetViews.videoView=new AS.PopupVideoView(this.getPageDimensions())),this.widgetViews.videoView.render(),this.widgetViews.videoView.initVideo(a)},onShowZoomableImage:function(a){this.widgetViews.imageView||(this.widgetViews.imageView=new AS.ZoomableImageView(this.getPageDimensions())),this.widgetViews.imageView.render(),this.widgetViews.imageView.initImage(a)},getPageDimensions:function(){if(this.model){var a=this.model.get("currentVariant"),b=a.get("dimensions").page;return b}},orientationSetup:function(a){AS.orientation.checkFeature()&&!AS.config.get("publication.lockOrientation")&&(AS.orientation.setup(),$(window).on("orientationchange",function(){AS.message.trigger(AS.message.ORIENTATION_CHANGE,AS.orientation.get())}))},onPublicationLoaded:function(){AS.cookies.get(a)||_.defer(function(){AS.message.trigger(AS.message.FIRST_LAUNCH)}),AS.cookies.set(a,!0,2592e3,"/")}})}(),function(){"use strict";AS.AudioTrackCollection=Backbone.Collection.extend({model:AS.AudioTrack}),AS.AudioTrack=Backbone.Model.extend({defaults:{playing:!1,audioUrl:"",currentDuration:"0",totalDuration:"0",updateScrubber:!0,trackNumber:0,totalTracks:0},togglePlay:function(){this.set("playing",!this.get("playing"))}}),AS.AudioPlayerController=function(a){"undefined"==typeof a&&(a=!0),_.bindAll(this),a&&this.initialize()},_.extend(AS.AudioPlayerController.prototype,{$audioEl:void 0,id:"ASGlobalAudioPlayer",audioController:void 0,useMediaElement:!1,mediaElement:void 0,mediaElementSetup:!1,mediaElementInstantPlay:!1,audioQueue:new AS.AudioTrackCollection,currentAudioTrack:0,initialize:function(){this.mediaElementCheck(),this.injectAudioElement(),AS.message.on(AS.message.PLAY_GLOBAL_AUDIO,this.addAudioTrack),AS.message.on(AS.message.PREV_GLOBAL_AUDIO,this.prevTrack),AS.message.on(AS.message.NEXT_GLOBAL_AUDIO,this.nextTrack),AS.message.on("audio:displayTracks",this.displayTracks)},mediaElementCheck:function(){Modernizr.touch||AS.browser.ie?this.useMediaElement=!1:this.useMediaElement=!0},addAudioTrack:function(a){if(this.audioQueue.length<1||this.audioQueue.at(0).get("audioUrl")!==a.url){var b=new AS.AudioTrack({audioUrl:a.url});this.audioQueue.add(b,{at:0}),this.playAudio(b)}else this.audioQueue.at(0).togglePlay()},injectAudioElement:function(){return this.$audioEl?this.$audioEl:(this.$audioEl=$("<audio>",{id:this.id}),this.$audioEl.on("timeupdate",this.updateTime),this.$audioEl.on("loadeddata",this.loadedmetadata),$("body").append(this.$audioEl),void(this.audioControl=this.$audioEl[0]))},setupMediaElement:function(){var a=this;this.mediaElementSetup||(this.mediaElement=new MediaElement(this.id,{enablePluginDebug:!1,pluginPath:AS.router.readerURL+"video-player/",success:function(b,c){a.mediaElementSetup=!0,a.mediaElementInstantPlay&&(a.mediaElementInstantPlay=!1,b.play())},error:function(a){var b="audio-missing";/\.(ASND|WAV|AIFF|MP3|ogg|oga|AIF|AIFC)$/i.test(a.getAttribute("src"))&&(b="audio-flash"),AS.message.trigger(AS.message.NOTIFICATION_SHOW,b.toLocaleString())}}))},changeAudioController:function(){this.audioControl=this.mediaElement},playAudio:function(a){if("undefined"==typeof a)return void this.audioQueue.at(this.currentAudioTrack).set("playing",!0);var b=a.get("audioUrl");a.set("trackNumber",this.currentAudioTrack),a.set("totalTracks",this.audioQueue.length),this.view.setModel(a),"string"==typeof b&&(this.mediaElementSetup?(this.audioControl=this.mediaElement,this.audioControl.setSrc(b)):this.$audioEl.attr("src",b)),this.useMediaElement&&!this.mediaElementSetup&&(this.setupMediaElement(),this.changeAudioController()),this.audioQueue.at(this.currentAudioTrack).set("playing",!0),a.on("change:playing",this.toggleAudio),AS.message.on(AS.message.UPDATE_GLOBAL_AUDIO,this.updateAudioTime),this.useMediaElement?this.mediaElementSetup?this.audioControl.play():this.mediaElementInstantPlay=!0:this.audioControl.play()},pauseAudio:function(){this.audioControl.pause(),this.audioQueue.at(this.currentAudioTrack).set("playing",!1)},toggleAudio:function(){this.audioControl.paused?this.audioControl.play():this.audioControl.pause()},updateTime:function(a){var b=a.target.currentTime;try{this.audioQueue.at(this.currentAudioTrack).set("currentDuration",b)}catch(c){}},updateAudioTime:_.throttle(function(){this.audioControl.currentTime=this.audioQueue.at(this.currentAudioTrack).get("currentDuration")},1e3),loadedmetadata:function(a){var b=a.target.duration;this.audioQueue.at(this.currentAudioTrack).set("totalDuration",b)},nextTrack:function(){this.currentAudioTrack>0&&(this.currentAudioTrack=this.currentAudioTrack-1,this.playAudio(this.audioQueue.at(this.currentAudioTrack)))},prevTrack:function(){this.currentAudioTrack<this.audioQueue.length-1&&(this.currentAudioTrack=this.currentAudioTrack+1,this.playAudio(this.audioQueue.at(this.currentAudioTrack)))},displayTracks:function(){_.each(this.audioQueue.models,function(a){},this)},start:function(){try{this.audioQueue.reset({silent:!0})}catch(a){}this.view=new AS.AudioView({model:new AS.AudioTrack}),$("body").append(this.view.render().el),this.view.hideView()},stop:function(){this.$audioEl.attr("src",""),this.view&&this.view.remove()}})}(),function(){"use strict";AS.View=function(){Backbone.View.apply(this,arguments),this._setupWiring()},AS.View.extend=Backbone.View.extend,_.extend(AS.View.prototype,Backbone.View.prototype,{renderedOnce:!1,render:function(){var a=this.renderTemplate();if(a){var b=$(a),c=b.get(0).attributes;c=_.object(_.pluck(c,"name"),_.pluck(c,"value")),this.renderedOnce?(this.$el.html(b.html()),this.$el.attr(c)):this.setElement(b)}return this.renderedOnce=!0,this},renderTemplate:function(){var a;return this.template&&("string"==typeof this.template&&(this.template=AS.View.resolveTemplate(this.template)),"function"==typeof this.template&&(a=this.template(this.toJSON()))),a},toJSON:function(){return this.model?this.model.toJSON():null}}),AS.View.resolveTemplate=function(a){return"undefined"!=typeof window.JST?window.JST[a]:_.template($("#"+a).html())},AS.config.mixin(AS.View.prototype),AS.SingletonView=function(){AS.View.apply(this,arguments),this._setupWiring()},AS.SingletonView.extend=AS.View.extend,AS.SingletonView.getInstance=function(){return void 0===this._instance&&(this._instance=new this),this._instance},_.extend(AS.SingletonView.prototype,AS.View.prototype),AS.config.mixin(AS.SingletonView.prototype)}(),function(){"use strict";AS.util.vendorPrefixedEvent("transitionEnd"),AS.PopupView=AS.View.extend({events:Modernizr.touch?{"focus input":"onInputFocus","touchend a":"onAnchorClick","touchmove .popup-back":"onTouchmove","touchmove .popup-content":"onTouchmove"}:{"click .popup-back":"close","click .popup-content":"contentClick"},initialize:function(){_.bindAll(this),AS.message.on(AS.message.RESIZE,this.resize)},render:function(){return AS.View.prototype.render.call(this),this.$content=this.$(".popup-content"),this},resize:function(){var a=-10;this.$content.children().each(function(){a+=this.offsetHeight}),this.$content.animate({height:a+"px","margin-top":-Math.round(a/2)+"px"})},open:function(a){this.$el.css("display","").addClass("popup"),_.delay(_.bind(function(){this.$(".popup-content").css({"margin-left":-(this.$content.width()/2)+"px","margin-top":-(this.$content.height()/2)+"px"}),this.$el.addClass("popup-open")},this)),$(document).on("keyup",this.keydownHandler)},close:function(a){this.$el.removeClass("popup-open"),setTimeout(this.closeEnd,300),$(document).off("keyup",this.keydownHandler)},closeEnd:function(a){this.$el.css("display","none"),AS.browser.ios&&AS.util.iosDismissKeyboard()},contentClick:function(a){a.stopPropagation()},keydownHandler:function(a){27===a.which&&this.close(null,!0)},onInputFocus:function(a){},onAnchorClick:function(a){AS.browser.ios&&($(a.currentTarget).click(),a.preventDefault())},onTouchmove:function(a){a.preventDefault(),a.stopPropagation()}})}(),function(){"use strict";var a=!1;AS.AppView=AS.View.extend({
tagName:"div",id:"app-view",className:"appview",modalView:null,popupVideo:null,currentView:void 0,initialize:function(){_.bindAll(this),AS.orientation.desktop()&&$(window).on("resize",this.windowResize),$(document).on(AS.util.vendorPrefixedEvent("fullscreenchange").toLowerCase(),this.fullScreenChange),AS.message.on(AS.message.ISSUE_LOADED,this.issueLoaded),AS.message.on(AS.message.VARIANT_CHANGE,this.variantChanged),AS.message.on(AS.message.TOGGLE_FULL_SCREEN,this.toggleFullScreen),AS.message.on(AS.message.SHOW_IN_POPUP,this.onShowInPopup),AS.message.on(AS.message.SHOW_VIDEO,this.onShowVideo),this.setupTouchHead(),this.setMetaTags()},render:function(){return this.$el.toggleClass("full-screen-supported",AS.util.FULL_SCREEN_SUPPORTED),AS.message.trigger(AS.message.TRACK_PAGE,{page:window.location.href}),this},initView:function(a,b,c){function d(a,b){var c=$("<style />");c.attr("id","store"),c.attr("type","text/css"),c.html(a),$("head").append(c),_.defer(b)}function e(a,b){$.ajax({url:a.stylesheet,dataType:"text",async:!0,success:function(c){d(c,function(){a.stylesheetLoaded=!0,b()})}})}function f(a,b){function c(){a.$el.hide(),$("body").removeClass(a.id+"-view"),$("html").removeClass(a.id+"-html"),b()}0===a.el.style.opacity||"0"===a.el.style.opacity?_.defer(c):a.$el.animate({opacity:"0"},{duration:350,complete:c}),a.offScreen&&a.offScreen()}function g(a){return a.stylesheetLoaded||a.renderedOnce?(a.$el.show(),i.currentView=a,$("html").addClass(a.id+"-html"),$("body").addClass(a.id+"-view"),void _.defer(function(){a.update&&a.update(),"function"==typeof c&&c(),a.$el.animate({opacity:1},{duration:350,complete:function(){a.onScreen&&a.onScreen()}})})):h(a,g)}function h(a,b){function c(){var c=a.render().el;c.parentElement||i.$el.append(c),b&&b(a)}return!a.stylesheet||a.stylesheetLoaded?c():void e(a,c)}var i=this;this.currentView!==a?this.currentView?(f(this.currentView,function(){g(a)}),h(a)):g(a):b?(h(a),g(a)):"function"==typeof c&&c()},issueLoaded:function(a){var b=a.get("currentVariant"),c=b.get("orientation");this.variantChanged(c),AS.message.trigger(AS.message.TRACK_EVENT,{eventCategory:AS.Analytics.categories.ISSUE,eventAction:AS.Analytics.actions.VIEW,eventLabel:a.get("actualId")})},variantChanged:function(a){this.$el.removeClass().addClass(a)},windowResize:function(){var b=this;AS.message.trigger(AS.message.RESIZE),_.delay(function(){a!==AS.util.isFullScreen()&&b.fullScreenChange()},250)},fullScreenChange:function(b){a=AS.util.isFullScreen(),$("body").toggleClass("fullScreen",a),AS.util.isFullScreen()?AS.message.trigger(AS.message.FULL_SCREEN_ENTER):AS.message.trigger(AS.message.FULL_SCREEN_EXIT)},onShowInPopup:function(a){this.modalView||(this.modalView=new AS.ModalView,this.modalView.render(a))},setupTouchHead:function(){(Modernizr.touch||AS.config.get("app.mobileOnly"))&&(this.setTouchIcons(),this.setTouchAppTitle(),this.setTouchLoadScreens(),this.applyTouchClass())},setTouchAppTitle:function(){$("head").append('<meta name="apple-mobile-web-app-title" content="'+AS.config.get("publication.title")+'">')},setTouchIcons:function(){var a,b=AS.config.get("icons"),c=AS.config.get("userIcons"),d={};c=_.pick(c,function(a){return"string"==typeof a.href&&a.href.length}),_.merge(d,b,c),d&&($("head link[rel=apple-touch-icon]").remove(),_.each(d,function(b,c){a=$("<link></link>"),a.attr("href",b.href).attr("rel",b.rel),b.size&&a.attr("sizes",b.size),$("head").append(a)}))},setTouchLoadScreens:function(){var a,b,c=AS.config.get("loading"),d=AS.config.get("userLoading"),e={};d=_.pick(d,function(a){return"string"==typeof a.href&&a.href.length}),_.merge(e,c,d),e&&_.each(e,function(c,d){b="",a=$("<link></link>"),a.attr("href",c.href).attr("rel",c.rel),c.width&&(b+="(device-width: "+c.width+")"),c.height&&(b+=" and (device-height: "+c.height+")"),c.orientation&&(b+=" and (orientation: "+c.orientation+")"),c.pixelDensity&&(b+=" and (-webkit-device-pixel-ratio: "+c.pixelDensity+")"),a.attr("media",b),$("head").append(a)})},setMetaTags:function(){var a,b=AS.config.get("meta");b&&_.each(b,function(b,c){a=$("<meta />",b),$("head").append(a)})},applyTouchClass:function(){$("html").addClass("touch").removeClass("no-touch")}})}(),function(){"use strict";AS.OfflineModel=Backbone.Model.extend({defaults:{offlineTitle:"offline-title".toLocaleString(),offlineText:"offline-text".toLocaleString(),loaderColor:AS.config.get("app.loading.backgroundColor"),loaderFontColor:AS.config.get("app.loading.color")}}),AS.OfflineView=AS.View.extend({template:"nooffline-tmpl",model:new AS.OfflineModel,initialize:function(){_.bindAll(this)},render:function(){AS.View.prototype.render.call(this);var a=AS.config.get("app.loading");return this.$("#loading-image").on("load",function(){$(this).parent().css({"margin-top":-this.height/2,"margin-left":-this.width/2})}).attr("src",a.image),this}})}(),function(){"use strict";AS.IssueView=AS.View.extend({id:"issue",injectId:"IssueView",rendered:!1,stylesheet:"webreader/stylesheets/issue.css",$pagelistview:void 0,$scrubberview:void 0,dimensions:null,initialize:function(){_.bindAll(this),AS.orientation.desktop()&&AS.message.on(AS.message.RESIZE,this.layout)},render:function(){var a=this,b=this.model.get("currentVariant");return this.dimensions=b.get("dimensions"),this.rendered?(this.children.forEach(function(b){b.model=a.model,b.render()}),this.$pagelistview=this.$el.find("#pagelistview"),this.$scrubberview=this.$el.find("#navigation-wrapper"),this.layout(),this):(AS.View.prototype.render.call(this),this.children=this.components.map(function(b){return b({model:a.model})}),this.children.forEach(function(b){a.$el.append(b.render().$el)}),this.rendered=!0,this.$pagelistview=this.$el.find("#pagelistview"),this.$scrubberview=this.$el.find("#navigation-wrapper"),this.layout(),this)},layout:function(){function a(){return d=k+j+l+i,e=f-d,e>0?{contentTop:e/2,scrubberTop:e/2+k+j+l}:null}function b(){return d=k+j+i,e=f-d,e>0?{contentTop:e/2,scrubberTop:e/2+k+j}:0}var c,d,e,f=$(window).height(),g=Modernizr.touch||AS.config.get("app.mobileOnly"),h=AS.config.get("scrubber"),i=h.height,j=h.contentScrubberSpace,k=this.dimensions.page.height,l=this.dimensions.timeline.height,m=f-i,n=!1,o=0,p=0,q="",r=k,s="",t=0,u=parseInt(AS.Session.getCurrentPage().toJSON().properties.height,10);!isNaN(u)&&m>=u&&(r=k=u),k>m?(o=0,p=0,q=i+"px"):(c=a())?(p=c.contentTop+"px",s=c.scrubberTop+"px",n=!0):(c=b())?(p=c.contentTop+"px",g||(s=c.scrubberTop+"px")):p=(m-k)/2,g&&(q=0),n?AS.message.trigger(AS.message.FORCE_SHOW_TIMELINE,AS.ScrubberTimeline.PERMANENT):AS.message.trigger(AS.message.FORCE_HIDE_TIMELINE),this.$pagelistview.css({"margin-top":o,top:p,bottom:q,"max-height":r});var v=parseInt(AS.Session.getCurrentPage().toJSON().properties.width,10),w=AS.util.getCurrentScreenDimensions();isNaN(v)&&(v="portrait"===AS.Session.getCurrentVariant().get("orientation")?768:1024),!isNaN(v)&&w.width>=v?AS.util.canShowDoublePage(v)?this.$pagelistview.css({width:v,"margin-left":-1*v}):this.$pagelistview.css({width:v,"margin-left":-1*(v/2)}):w.width<v?(this.$pagelistview.css({"margin-left":-1*(w.width/2)}),this.$(".right-arrow").css({left:w.width})):(this.$pagelistview.css({width:"","margin-left":""}),this.$(".right-arrow").css({left:this.dimensions.page.width})),this.$scrubberview.css({top:s,bottom:t})},offScreen:function(){this.children.forEach(function(a){a.offScreen&&a.offScreen()})},onScreen:function(){this.children.forEach(function(a){a.onScreen&&a.onScreen()})}})}(),function(){"use strict";var a=500,b="show",c="hide";AS.LoaderModel=Backbone.Model.extend({defaults:function(){return AS.config.get("app.loading")}}),AS.LoaderView=AS.View.extend({template:"loader-tmpl",isShowing:!1,loaded:!1,orientationChange:!1,iframeCount:AS.util.iframeCount(),iframeLoaded:0,animationTime:1e3,animationEase:null,showScreen:function(){return"loader-show"},showLoader:function(){return this.showScreen()+" loader-loading"},showRotate:function(){return this.showScreen()+" loader-rotate"},showComplete:function(){return"loader-complete"},showHide:function(){return"loader-hide"},initialize:function(){_.bindAll(this);var a=AS.config.get("app.loading");this.model=new AS.LoaderModel,this.model.set(a),this.animationTime=AS.config.get("animation.loaderView.fadeDuration"),this.animationEase=AS.config.get("animation.loaderView.fadeEasing"),a&&(this.template="loadercustom-tmpl"),(Modernizr.touch||AS.config.get("app.mobileOnly"))&&(AS.message.on(AS.message.ORIENTATION_AVAILABLE,this.orientationAvailable),AS.message.on(AS.message.ORIENTATION_UNAVAILABLE,this.orientationUnavailable)),this.render()},attachEvents:function(){AS.message.on(AS.message.PAGE_LOADED,this.hide),AS.message.on(AS.message.ISSUE_LOADING_ERROR,this.hide),AS.message.on(AS.message.STORE,this.hideLoader),AS.message.on(AS.message.CLOSE_LOADING,this.hideLoader)},removeEvents:function(){AS.message.off(AS.message.PAGE_LOADED,this.hide),AS.message.off(AS.message.ISSUE_LOADING_ERROR,this.hide),AS.message.off(AS.message.STORE,this.hideLoader),AS.message.off(AS.message.CLOSE_LOADING,this.hideLoader)},loadIssue:function(a,b,c){this.$el.removeClass();var d=this;this.loadingIndex=c?c:1,this.showTheLoader(function(){d.attachEvents(),AS.message.trigger(AS.message.LOADING_OPEN,{issueId:a,variant:b,pageNumber:c})})},showTheLoader:function(a){this.$el.find(".message").hide(),this.$el.find(".loading").show(),this.$el.removeClass("loader-display-none"),this.$el.addClass(this.showLoader()).css("opacity",0),this.animateTheLoader(b,a)},animateTheLoader:function(a,c){this.$el.animate({opacity:a===b?1:0},this.animationTime,this.animationEase,c)},orientationUnavailable:function(){this.oriChange=!0,$("body").addClass("issue-hide"),this.$el.removeClass("loader-display-none"),this.$el.addClass(this.showRotate()).css("opacity",1),this.$el.find(".message").hide(),this.$el.find(".not-available").show()},orientationAvailable:function(){$("body").removeClass("issue-hide"),this.hideLoader(),this.$el.find(".message").hide(),this.$el.find(".loading").show()},hide:function(b){this.iframeLoaded+=1,b+=1,this.orientationChange||parseInt(b,10)!==parseInt(this.loadingIndex,10)||(this.$el.addClass(this.showComplete()),_.delay(this.hideLoader,a),this.loadingIndex=void 0)},render:function(){if(this.rendered)return this;AS.View.prototype.render.call(this),this.rendered=!0;var a=AS.config.get("app.loading"),b=this,c=new Image;return c.src=a.image,c.onload=function(){b.$("#loading-image").attr("src",a.image).parent().css({"margin-top":-this.height/2,"margin-left":-this.width/2}),b.$("#loading-text").css({"margin-top":this.height/2})},this},hideLoader:_.debounce(function(){var a=this;this.animateTheLoader(c,function(){a.removeEvents(),a.$el.removeClass(),a.$el.addClass("loader-display-none"),a.$el.find(".message").hide()}),this.loadingIndex=void 0},a)})}(),function(){"use strict";var a=AS.util.vendorPrefixedEvent("transitionEnd"),b=["#9d261d","#f89406","#b4b4b4","#00adef","#46a546"];AS.NotificationModel=Backbone.Model.extend({defaults:{homeScreen:"home-screen".toLocaleString(),logLevel:AS.NOTIFICATION_LEVEL.INFO,currentMsg:""}}),AS.NotificationView=AS.View.extend({template:"notification-tmpl",model:new AS.NotificationModel,$message:void 0,$messageBar:void 0,currentMsg:"",$iosHome:void 0,standalone:!1,showing:!1,options:{userDismiss:!1,timer:5e3,level:AS.NOTIFICATION_LEVEL.INFO},events:{"click .close":"hide"},initialize:function(){_.bindAll(this),this.render(),window.navigator.standalone&&(this.standalone=!0),AS.message.on(AS.message.NOTIFICATION_SHOW,this.show),AS.message.on(AS.message.NOTIFICATION_HIDE,this.hide),this.model.on("change:currentMsg",this.setCurrentMessage)},render:function(){return AS.View.prototype.render.call(this),this.$message=this.$(".inner-message"),this.$messageBar=this.$("#messageBar"),this},hide:function(){this.model.set("currentMsg","")},show:function(a,b){function c(b,c){"function"==typeof e[c]&&e[c](b,a)}var d=_.extend(_.clone(this.options),b||{}),e=this.handleOption(this);d.level>this.model.get("logLevel")||(_.forEach(d,c),this.model.set("currentMsg",a))},setCurrentMessage:function(b,c){if(!c)return this.$message.html(""),void this.$messageBar.removeClass("active");if(!b.previous("currentMsg"))return this.$message.html(c),void this.$messageBar.addClass("active");var d=function(a){this.currentMsg=c,this.$message.html(c),this.$message.removeClass("change")};this.$message.one(a,_.bind(d,this)).addClass("change")},handleOption:function(a){var b=a;return{userDismiss:function(a){b.showClose(a)},timer:function(a,c){b.startHideTimer(a,c)},level:function(a){b.levelColour(a)}}},showClose:function(a){this.$(".close").toggleClass("hide",!a)},startHideTimer:function(a,b){var c=function(){return this.model.get("currentMsg")===b?this.$el.is(":hover")?void this.$el.one("mouseleave",_.bind(function(){AS.message.trigger(AS.message.NOTIFICATION_HIDE)},this)):void AS.message.trigger(AS.message.NOTIFICATION_HIDE):void 0};_.delay(_.bind(c,this),a||5e3)},levelColour:function(a){return"undefined"!=typeof b[a-1]?void this.$messageBar.css({background:b[a-1]}):void this.$messageBar.css({background:"#b4b4b4"})}})}(),function(){"use strict";AS.ModalView=AS.View.extend({backgroundModal:null,isOpen:!1,gutter:120,pageDimensions:null,events:Modernizr.touch?{"touchstart .dummyContainer":"onModalClick_"}:{"click .dummyContainer":"onModalClick_"},initialize:function(a){_.bindAll(this),this.pageDimensions=a},render:function(a){return this.renderedOnce||AS.View.prototype.render.call(this),$("body").append(this.el),AS.orientation.desktop()&&$(document).on("keyup",this.keydownHandler),this.delegateEvents(this.events),this},keydownHandler:function(a){27===a.which&&(this.removeView(),$(document).off("keyup",this.keydownHandler))},removeView:function(){$(this.el).remove(),AS.message.trigger(AS.message.CLOSE_POPUP),this.isOpen=!1},onModalClick_:function(a){this.isValidTarget(a.target)&&this.removeView()},isValidTarget:function(a){return $(a).hasClass("dummyContainer")||$(a).hasClass("popupHolder")}})}(),function(){"use strict";AS.IE9IframeView=AS.View.extend({template:AS.View.resolveTemplate("ie9iframe-tmpl"),initialize:function(){},render:function(){return $(this.el).html(this.template()),this}})}(),function(){"use strict";var a=Modernizr.touch;AS.TTipView=AS.View.extend({template:"ttip-tmpl",defaults:{ttipAlign:"middle",ttipContent:"There is no content for this widget",ttipWidth:"",ttipSide:"top",ttipHeight:"",ttipDistance:10,ttipTextAlign:"center"},initialize:function(){_.bindAll(this),a=Modernizr.touch||AS.config.get("app.mobileOnly"),a||($("body").delegate("[data-ttip-content]","mouseenter",this.showttip),this.render())},render:function(){return AS.View.prototype.render.call(this),this.$el.hide(),this},showttip:function(a){var b=$(a.currentTarget),c=b.data(),d=this.mergeDefaults(c),e=b.offset(),f={left:e.left,top:e.top,height:b.outerHeight(),width:b.outerWidth(),windowHeight:$(window).height(),windowWidth:$(window).width(),offset:d.ttipDistance};this.$el.hide(),this.removeAttr(),this.$el.find("span").html(d.ttipContent),this.$el.css({width:d.ttipWidth,height:d.ttipHeight}),this.$el.addClass(this.setArrowPosition(d.ttipSide)),this.$el.addClass(this.setArrowAlign(d.ttipAlign)),this.$el.addClass(this.setTextAlign(d.ttipTextAlign)),this.$el.css(this.setPosition(d.ttipSide,d.ttipAlign,f)),this.$el.show(),b.on("mouseleave.ttip click.ttip",this.mouseOut)},setPosition:function(a,b,c){var d;switch(a){case"bottom":d={top:parseInt(c.top,10)+parseInt(c.height,10)+parseInt(c.offset,10)+"px"},"right"===b?d.right=parseInt(c.windowWidth,10)-parseInt(c.width,10)-parseInt(c.left,10)+"px":"left"===b?d.left=parseInt(c.left,10):(d.left=parseInt(c.left,10)+parseInt(c.width,10)/2,d["margin-left"]="-"+this.$el.outerWidth()/2+"px");break;case"top":d={bottom:parseInt(c.windowHeight,10)-parseInt(c.top,10)+parseInt(c.offset,10)+"px"},"right"===b?d.right=parseInt(c.windowWidth,10)-parseInt(c.width,10)-parseInt(c.left,10)+"px":"left"===b?d.left=parseInt(c.left,10):(d.left=parseInt(c.left,10)+parseInt(c.width,10)/2,d["margin-left"]="-"+this.$el.outerWidth()/2+"px");break;case"left":d={right:parseInt(c.windowWidth,10)-parseInt(c.left,10)+parseInt(c.offset,10)+"px",top:parseInt(c.top,10)+parseInt(c.height-this.$el.outerHeight(),10)/2+"px"};break;case"right":d={left:parseInt(c.left,10)+parseInt(c.width,10)+parseInt(c.offset,10)+"px",top:parseInt(c.top,10)+parseInt(c.height-this.$el.outerHeight(),10)/2+"px"}}return d},setArrowPosition:function(a){var b;switch(a){case"bottom":b="arrow-top";break;case"top":b="arrow-bottom";break;case"left":b="arrow-right";break;case"right":b="arrow-left"}return b},setArrowAlign:function(a){var b;switch(a){case"right":b="arrow-align-right";break;case"left":b="arrow-align-left";break;case"middle":b="arrow-align-middle"}return b},setTextAlign:function(a){var b;switch(a){case"left":b="ttip-text-align-left";break;case"center":b="ttip-text-align-center";break;case"right":b="ttip-text-align-right"}return b},removeAttr:function(){this.$el.attr("style",""),this.$el.attr("class","")},mouseOut:function(a){this.$el.hide(),$(a.currentTarget).off(".ttip")},mergeDefaults:function(a){var b={},c=this.defaults;for(var d in c)b[d]=c[d];for(var e in a)b[e]=a[e];return b}})}(),function(){"use strict";var a="ASreturn",b="AScreds";AS.AuthToken=Backbone.Model.extend({defaults:function(){return{publication:void 0,username:void 0,password:void 0,authenticated:!1,authenticationError:void 0,authenticating:!1,availableIssues:[],userid:""}},initialize:function(a){_.bindAll(this),this.set("config",AS.config.get("app.auth"))},credentials:function(a){return"undefined"==typeof a?{username:this.get("username"),password:this.get("password")}:void this.set(a)},beginAuthentication:function(){this.set({authenticated:!1,authenticationError:void 0,authenticating:!0})},endAuthentication:function(a,b){var c=!!a;this.set({authenticated:!c,authenticationError:a,authenticating:!1}),c||AS.message.trigger(AS.message.AUTHENTICATED,b,{username:this.get("username"),password:this.get("password"),userid:this.get("userid")})},reset:function(a){var b=_.extend(this.defaults(),a||{});this.set(b)}});var c=function(){function b(a){var b=_.template(a,{redirect:window.location});return b}return{preAuthenticate:function(){!this.enabled||AS.cookies.get(this.config.authToken)?(AS.cookies.set(this.config.authToken,"true",31536e3,"/"),AS.cookies.get(a)&&(AS.util.changeLocation(window.location+AS.cookies.get(a)),AS.cookies.remove(a)),AS.message.trigger(AS.message.PRE_AUTHENTICATED),AS.message.trigger(AS.message.AUTHENTICATED)):(AS.cookies.set(a,window.location.hash,9e5),AS.util.changeLocation(b(this.endpoint)))}}}(),d=function(){function a(a,b){return btoa([a,b].join(":"))}function c(a){var b=atob(a).split(":");return{username:b[0],password:b[1]}}var d;return{extractDataFromPub:function(a){return a.get("issues").map(function(a){return{issueId:a.get("actualId"),publishedDate:a.get("publishedDate")}})},request:function(c,d,e){var f=d.get("publication"),g=d.credentials(),h=this.publicationCode||f.id,i=[this.endpoint,h,c].join("/"),j=a(g.username,g.password),k={issues:this.extractDataFromPub(f)};if(AS.util.isIE9()){var l=function(a){var c=JSON.parse(a.data),d={};if(c.error)return e(c.error);try{d=JSON.parse(c.responseText)}catch(f){}return 200!==c.status?e("Server returned status of : "+c.status):200!==d.status&&"undefined"!=typeof d.status?e("Server responded with : "+d.message+" ("+d.status+")"):(c.issues||(c={issues:c}),AS.cookies.set(b,j,2592e3,"/"),void e(null,c))};window.addEventListener("message",l,!1);var m={target:i,data:JSON.stringify(k),auth:j},n=document.getElementById("ie9Frame");_.defer(_.bind(function(){n.contentWindow.postMessage(JSON.stringify(m),"*")},this))}else $.ajax({type:"POST",async:!0,crossDomain:!0,url:i,dataType:"json",data:JSON.stringify(k),contentType:"application/json",headers:{Authorization:"Basic "+j},success:function(a,c){if(a.status>=401){var d=a.messageHTML||a.message;return void e(d||"login-auth-fail".toLocaleString())}a.issues||(a={issues:a}),AS.cookies.set(b,j,2592e3,"/"),e(null,a)},error:function(a,b){var c;try{c=a.responseText?JSON.parse(a.responseText):void 0}catch(d){c={message:d}}(0===a.status||a.status>=404)&&(b="login-timeout".toLocaleString()),e(c&&c.message?c.message:b)}})},authenticate:function(a){function b(b,c){if(b)return a.endAuthentication(b);var d=c.issues?c.issues:c,e=AS.Session.getCurrentIssueId(),f=[],g=!1,h=null;if(c.user&&a.set("userid",c.user),f=_.filter(d,function(a){return 200===a.status}),f=_.pluck(f,"issue"),g=_.contains(f,e),e&&!g){var i=_.where(d,{issue:e})[0],j=i.messageHTML||i.message;h=i?j:"The issue is not available with the credentials provided"}a.set("availableIssues",d),a.endAuthentication(h,f)}return a.beginAuthentication(),AS.StateModel.get("isConnected")?void this.request("authorise",a,b):a.endAuthentication({msg:"Unable to connect to server"})},preAuthenticate:function(){d=AS.cookies.get(b),d&&(d=c(d),AS.message.on(AS.message.PUBLICATION_LOADED,this.publicationLoaded,this)),_.defer(function(){AS.message.trigger(AS.message.PRE_AUTHENTICATED)})},publicationLoaded:function(a){if(d){var b=new AS.AuthToken({publication:a});b.credentials(d),this.authenticate(b)}}}}(),e={publication:c,issue:d};AS.AuthProxy={enabled:!0,endpoint:void 0,level:"publication",enabledLevels:{publication:!0,issue:!0,none:!1,"":!1},requiresAuthentication:!0,initialize:function(a){_.bindAll(this),this.config=a,this.endpoint=this.config.authRoot,this.level=this.config.level,this.publicationCode=this.config.publicationCode,this.enabled=this.enabledLevels[this.level],this.requiresAuthentication=this.enabled&&"issue"===this.level;var b=e[this.level];if(_.extend(this,b),this.enabled){var c=this;AS.message.on(AS.message.PRE_AUTHENTICATE,function(){c.preAuthenticate()}),AS.message.on(AS.message.AUTHENTICATE,function(a){c.authenticate(a)}),AS.message.on(AS.message.UNAUTHENTICATE,function(){c.unauthenticate()})}},preAuthenticate:void 0,authenticate:void 0,unauthenticate:function(){AS.cookies.remove(b),AS.message.trigger(AS.message.UNAUTHENTICATED,null,{userid:AS.Session.getCurrentUserId()})}},AS.message.on(AS.message.APPLICATION_START,function(){AS.AuthProxy.initialize(AS.config.get("app.auth"))})}(),function(){"use strict";AS.GeolocationView=AS.ModalView.extend({template:"geolocation-tmpl",mapCanvas:void 0,initialize:function(a){_.bindAll(this),AS.ModalView.prototype.initialize.call(this,a)},render:function(){return this.isOpen||(AS.ModalView.prototype.render.call(this),this.$(".popupHolder").css({width:this.pageDimensions.width-this.gutter,height:this.pageDimensions.height-this.gutter}),this.mapCanvas=this.$("#mapCanvas").get(0),this.isOpen=!0),this},openGeolocation:function(a,b){this.createMap(a,b)},createMap:function(a,b){var c={center:new google.maps.LatLng(a,b),zoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP},d=new google.maps.Map(this.mapCanvas,c);new google.maps.Marker({position:new google.maps.LatLng(a,b),map:d})}})}(),function(){"use strict";AS.PopupVideoView=AS.ModalView.extend({template:"popupvideo-tmpl",videoEl:null,mediaElementPluginPath:"webreader/video-player/",initialize:function(a){_.bindAll(this),AS.ModalView.prototype.initialize.call(this,a)},render:function(){return AS.ModalView.prototype.render.call(this),this.$(".popupHolder").css({width:"100%",height:"100%"}),this.videoEl=this.$("video")[0],this},setupMediaElement:function(){var a=this,b=1920,c=1080,d=this.calculateVideoScale(b,c);this.mediaElementSetup||(this.mediaElement=new MediaElement("modelvideo",{enablePluginDebug:!1,pluginPath:AS.router.readerURL+"video-player/",defaultVideoWidth:b*d,defaultVideoHeight:c*d,success:function(b,c){$("#"+b.id).css({position:"fixed",right:0,left:0,top:0,bottom:"48px","background-color":"#000000",margin:"auto"}),a.mediaElementSetup=!0,b.play(),a.$("video").removeClass("hide").addClass("show")},error:function(a){var b="video-missing";/\.(FLV|MP4|M4A|MOV|MP4V|3GP|3G2)$/i.test(a.getAttribute("src"))&&(b="video-flash"),AS.message.trigger(AS.message.NOTIFICATION_SHOW,b.toLocaleString())}}))},initVideo:function(a){this.$("video").attr("src",a),this.$("video").removeClass("show").addClass("hide"),$(".pv-close").on("click",this.onModalClick_),AS.message.on(AS.message.RESIZE,this.setMargin),AS.browser.firefox||this.$("video").attr("autoplay","true"),AS.browser.firefox?this.setupMediaElement():$(this.videoEl).on("loadedmetadata",this.onLoadedMetadata)},onLoadedMetadata:function(){$(this.videoEl).off("loadedmetadata",this.onLoadedMetadata),this.$("video").css({top:0,left:0,right:0,bottom:0,height:"auto",width:"auto",margin:"auto",position:"absolute"}),this.sizeVideoToDocument(),this.$("video").removeClass("hide").addClass("show")},sizeVideoToDocument:function(){var a=0===document.body.clientWidth?window.innerWidth:document.body.clientWidth,b=0===document.body.clientHeight?window.innerHeight:document.body.clientHeight,c=a-this.gutter,d=b-this.gutter,e=d/c,f=this.videoEl.videoHeight/this.videoEl.videoWidth,g=e>f?!0:!1;g?this.$("video").css("width",c+"px"):this.$("video").css("height",d+"px")},calculateVideoScale:function(a,b){var c=document.body.clientWidth,d=document.body.clientHeight,e=(c-this.gutter)/a,f=(d-this.gutter)/b,g=f>e?e:f;return g},setMargin:function(){var a=this.$("video"),b=40,c=((0===document.body.clientWidth?window.innerWidth:document.body.clientWidth)-a.width())/2;c>b?a.css("margin","auto"):a.css("margin",b+"px")},onModalClick_:function(a){this.isValidTarget(a.target)&&(this.videoEl.pause&&this.videoEl.pause(),this.videoEl.src="",AS.ModalView.prototype.onModalClick_.call(this,a),this.$("video").removeClass("show").addClass("hide"),AS.message.off(AS.message.RESIZE,this.setMargin))}})}(),function(){"use strict";var a=.95;AS.ZoomableImageView=AS.ModalView.extend({template:"zoomableimage-tmpl",imageEl:null,_scrollInstance:null,initialize:function(a){_.bindAll(this),AS.ModalView.prototype.initialize.call(this,a)},render:function(){return AS.ModalView.prototype.render.call(this),this.$(".popupHolder").css({margin:50*(1-a)+"%"}),this.imageEl=this.$("img")[0],this.$spinner=this.$(".spinner"),$(this.imageEl).on("load",this.onImageLoad_),$(".zw-close").on("click",this.removeView),this},initImage:function(a){this.$spinner.show(),this.imageEl.src=a},onImageLoad_:function(a){$(this.imageEl).off("load",this.onImageLoad_),this.$spinner.hide(),this._scrollInstance=new IScroll(".zoom-widget",{zoom:!0,scrollX:!0,scrollY:!0,mouseWheel:!0,wheelAction:"zoom"})},removeView:function(){this.imageEl.src="",this.$el.detach(),AS.message.trigger(AS.message.CLOSE_POPUP),this.isOpen=!1},onModalClick_:function(a){this.isValidTarget(a.target)&&this.removeView()}})}(),function(){"use strict";AS.StoreFootView=AS.View.extend({events:{click:"click"},initialize:function(){_.bindAll(this,"render");var a=AS.config.get("buildTime").split("_").join(" ");this.template="storefooter-tmpl",this.model=new Backbone.Model({version:AS.config.get("version"),buildNumber:AS.config.get("buildNumber"),branch:AS.config.get("branch"),timestamp:moment(a).format("ddd MMM Do YYYY, h:mm:ss a")}),this.model.bind("change",this.render)},click:function(a){if(a.shiftKey){var b=AS.config.get("gitcommit"),c="https://github.com/mobileiq/appstudio-html5-core/commit/"+b;window.open(c,"_blank")}}})}(),function(){"use strict";AS.StoreHeadView=AS.View.extend({offline:!1,libraryPressed:!1,events:{"click #fullscr":"toggleFullScreen","click #login-button":"login","click #logout-button":"logout","click #btnLibrary":"onLibraryPress","click #get-app":"getApp"},initialize:function(){_.bindAll(this),this.offline=AS.config.get("app.enableOffline")?!0:!1,this.template="storeheader-tmpl";var a="";AS.router.connection||(a="active"),this.model=new Backbone.Model(_.extend(AS.config.get("publication"),{greeting:"greeting".toLocaleString(),subscribeUrl:AS.config.get("app.auth.subscribeUrl"),username:"",offline:this.offline,isConnected:AS.StateModel.get("isConnected"),activeClass:a})),this.model.bind("change",this.render),this.listenTo(AS.StateModel,"change:isConnected",this.updateConnection),AS.Session.authenticated&&this.onAuthenticated(null,AS.Session.authCredentials),AS.message.on(AS.message.FULL_SCREEN_ENTER,this.fullScreenEnter),AS.message.on(AS.message.FULL_SCREEN_EXIT,this.fullScreenExit),AS.message.on(AS.message.AUTHENTICATED,this.onAuthenticated),AS.message.on(AS.message.UNAUTHENTICATED,this.onAuthenticated),AS.message.on(AS.message.NOTIFICATION_SHOW,this.onNotifyShow),AS.message.on(AS.message.NOTIFICATION_HIDE,this.onNotifyHide)},render:function(){var a=!!AS.util.supportsFullScreen();return AS.View.prototype.render.call(this),this.$fullScreenButton=this.$("#fullscr"),this.$fullScreenButton.attr("data-ttip-content",this.getTooltipEnterMessage()),this.$fullScreenButton.toggle(a),this.offline&&(this.$libraryButton=this.$("#btnLibrary"),AS.StateModel.get("isConnected")?this.$libraryButton.attr("data-ttip-content","Setup offline access to issues."):this.$libraryButton.attr("data-ttip-content","You are viewing the offline library")),this.updateConnection(),this.updateSmartBannerButton(),this},updateConnection:function(a){this.model.set("isConnected",AS.StateModel.get("isConnected")),this.toggleLibrary(a)},getTooltipEnterMessage:function(){return"fullscreen".toLocaleString()},getTooltipExitMessage:function(){return"fullscreen-exit".toLocaleString()},toggleFullScreen:function(){if(AS.util.isIE10()){var a=AS.util.isFullScreen()?"fullscreen-alert-exit":"fullscreen-alert-enter",b=a.toLocaleString();AS.message.trigger(AS.message.ALERT,b)}else AS.message.trigger(AS.message.TOGGLE_FULL_SCREEN)},fullScreenEnter:function(){this.$("#fullscr").data("ttipContent",this.getTooltipExitMessage()),this.$("#fullscr").html('<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><g ><path d="M18.61 8.277L21.69 5.2l-2.194-2.194-3.078 3.08-2.314-2.315-.488 7.312 7.31-.49zM8.962 17.93l-3.08 3.077-2.193-2.193 3.08-3.078-2.317-2.317 7.312-.487-.49 7.31z"/></g></svg>'),AS.message.trigger(AS.message.TRACK_EVENT,{eventCategory:AS.Analytics.categories.APPLICATION,eventAction:AS.Analytics.actions.FULLSCREEN,eventLabel:document.title})},fullScreenExit:function(){this.$("#fullscr").data("ttipContent",this.getTooltipEnterMessage()),this.$("#fullscr").html('<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><g ><path d="M16.402 6.052l-3.26 3.26 2.322 2.32 3.26-3.258 2.45 2.45.515-7.74-7.74.517zM6.656 15.795l3.26-3.26 2.323 2.323-3.26 3.26 2.45 2.45-7.74.516.515-7.74z"/></g></svg>')},login:function(){AS.message.trigger(AS.message.STORE_LOGIN_OPEN)},logout:function(){AS.message.trigger(AS.message.UNAUTHENTICATE)},onAuthenticated:function(a,b){this.model.set("username",b&&b.username?b.username:""),_.debounce(this.render)},matchButtonSizes:function(){var a,b=this.$("#login-button, #subscribe-button");b.width("auto"),a=b.map(function(){return+$(this).css("width").replace("px","")}).get(),b.css({width:Math.max.apply(Math,a)})},onLibraryPress:function(a){AS.router.connection&&(this.libraryPressed=!this.libraryPressed,this.toggleLibrary(a))},toggleLibrary:function(a){this.$("#btnLibrary").toggleClass("active",this.libraryPressed||!AS.StateModel.get("isConnected")),AS.message.trigger(AS.message.OFFLINE_OPTIONS_STATUS_CHANGE,{libraryPressed:this.libraryPressed})},onNotifyShow:function(a){this.$(".store-tools").css({top:"51px"})},onNotifyHide:function(a){this.$(".store-tools").css({top:"15px"})},getApp:function(){var a=AS.config.get("smartBanner");a&&(AS.browser.ios&&a.ios.enabled?AS.util.isValidBundleId(a.ios.id)?$.ajax({dataType:"jsonp",url:"https://itunes.apple.com/lookup?bundleId="+a.ios.id,success:function(a,b,c){a.resultCount?location.href=a.results[0].trackViewUrl:void 0},error:function(a,b,c){}}):AS.util.isValidUrl(a.ios.id)?location.href=a.ios.id:void 0:AS.browser.android&&a.android.enabled&&(AS.util.isValidBundleId(a.android.id)?location.href="https://play.google.com/store/apps/details?id="+a.android.id:AS.util.isValidUrl(a.android.id)?location.href=a.android.id:void 0));
},updateSmartBannerButton:function(){var a=AS.config.get("smartBanner");(!a||AS.browser.ios&&!a.ios.enabled||AS.browser.kindle&&!a.kindle.enabled||AS.browser.android&&!a.android.enabled)&&this.$("#get-app").remove()}})}(),function(){"use strict";AS.StoreBannerView=AS.View.extend({initialize:function(){_.bindAll(this,"render"),this.template="storebanner-tmpl",this.model=new Backbone.Model({bannerHeight:AS.config.get("app.banner.height"),bannerSrc:this.getBannerSrc()})},getBannerSrc:function(){var a=AS.config.get("app.banner.source");return-1!==a.indexOf(".zip")&&(a=a.replace(".zip","/index.html")),a}})}(),function(){"use strict";AS.StoreNavView=AS.View.extend({storeNavTemplate:AS.View.resolveTemplate("storenav-tmpl"),tagName:"nav",initialize:function(){_.bindAll(this,"render"),this.model=new Backbone.Model({items:["Store","Library"]}),this.template="storenav-tmpl",this.model.bind("change",this.render)}})}(),function(){"use strict";AS.StoreGridView=AS.View.extend({template:"storeissuecontainer-tmpl",numIssues:0,loadedCounter:0,issueViews:null,promotedView:null,loading:!1,rendered:!1,hasScrollBarRefresh:!1,promotedIssueEnabled:null,$list:null,$more:null,$window:$(window),initialize:function(){this.promotedIssueEnabled=AS.config.get("app.enablePromoted"),this.hasBanner=AS.config.get("app.banner.enabled"),this.bannerLocation=AS.config.get("app.banner.source"),_.bindAll(this),this.issueViews=[],this.numIssues=this.model.get("issues").length,this.appendLoadEvents()},render:function(){return this.rendered?void 0:(AS.View.prototype.render.call(this),this.rendered=!0,this.$list=this.$("#issueContainer"),this.$promoted=this.$("#promotedIssue"),this.$banner=this.$("#externalBanner"),this.promotedIssueEnabled||this.$promoted.remove(),this.renderBanner(),this.$more=this.$("#more"),AS.util.isIE9()&&_.delay(this.ie9AnimateSpinner,250),this)},renderBanner:function(){return this.hasBanner&&""!==this.bannerLocaction?(this.bannerView=new AS.StoreBannerView,void this.loadBanner(this.bannerView.model.get("bannerSrc"),this.displayBanner,this.removeBanner)):this.removeBanner()},displayBanner:function(){this.$banner.append(this.bannerView.render().el)},loadBanner:function(a,b,c){$.ajax({url:a,type:"GET",cache:!1,success:b,error:c})},removeBanner:function(){return this.$banner.remove()},update:function(){_.each(this.issueViews,function(a){a.update()}),this.promotedView&&this.promotedView.update()},ie9AnimateSpinner:function(){this.loadedCounter!==this.numIssues&&AS.util.animateRotate({el:$("#more")[0],targetDegrees:360,duration:1e3,callback:this.ie9AnimateSpinner})},appendLoadEvents:function(){this.on("loadMore",this.onLoadMore),this.$window.on("scroll",this.onWindowScroll),this.$window.on("resize",this.onWindowScroll)},destroyLoadEvents:function(){this.off("loadMore",this.onLoadMore),this.$window.off("scroll",this.onWindowScroll),this.$window.off("resize",this.onWindowScroll)},onWindowScroll:function(a){this.getLoadMoreVisible()&&this.trigger("loadMore")},onLoadMore:function(a){if(!this.loading){window.innerHeight<$("#app-view").innerHeight()&&!this.hasScrollBarRefresh&&(this.hasScrollBarRefresh=!0,this.restrictLinesOnViews()),this.loading=!0;var b=this.model.get("issues");if(b.length>this.loadedCounter){var c=b.at(this.loadedCounter);c.set("subscribeUrl",AS.config.get("app").auth.subscribeUrl),this.promotedIssueEnabled&&null===this.promotedView?this.appendPromoted(new AS.StorePromotionView({model:c})):this.appendIssue(new AS.StoreGridIssueView({model:c}))}else this.onThumbLoaded(null)}},restrictLinesOnViews:function(){this.promotedView&&this.promotedView.restrictLines(),_.each(this.issueViews,function(a){a.restrictLines()})},onThumbLoaded:function(a){this.loadedCounter=this.loadedCounter+1,this.loading=!1,(0===this.numIssues||this.loadedCounter===this.numIssues)&&(this.$more.hide(),this.destroyLoadEvents()),this.getLoadMoreVisible()&&this.trigger("loadMore")},appendIssue:function(a){this.issueViews.push(a),this.$list.append(a.render().el),a.loadThumb(this.onThumbLoaded)},appendPromoted:function(a){this.promotedView=a,this.$promoted.append(a.render().el),a.loadThumb(this.onThumbLoaded)},getLoadMoreVisible:function(){return 0===this.issueViews.length?!0:this.$window.scrollTop()+this.$window.innerHeight()>this.issueViews[this.issueViews.length-1].el.offsetTop}})}(),function(){"use strict";AS.StoreGridIssueView=AS.View.extend({currentCallback:null,template:"storeissue-tmpl",initialize:function(){_.bindAll(this),this.addEvents()},render:function(){return AS.View.prototype.render.call(this),this},update:function(){this.restrictLines()},loadThumb:function(a){var b=this;if(a=this.storeCallback(a),!this.getImageURL())return a(new Error("Thumbnail not specified for "+this.model.get("id"))),void this.$("img ").css("opacity",0);this.restrictLines();var c=function(){var c=b.$("img"),d=b.getImageURL();b.attachLoadEvents(a,c,d),c.attr("src",d)};AS.browser.android||AS.browser.androidbuiltin?c():_.delay(c,AS.util.isIE9()?50:0)},storeCallback:function(a){return a===_.noop&&null!==this.currentCallback?this.currentCallback:(this.currentCallback=a,this.currentCallback)},forgetCallback:function(){this.currentCallback=null},attachLoadEvents:function(a,b,c){b.on("load",{callback:a,image:b,src:c},this.onThumbLoaded),b.on("error",{callback:a,image:b,src:c},this.onThumbLoaded)},destroyLoadEvents:function(a){a.off("load",this.onThumbLoaded),a.off("error",this.onThumbLoaded)},addEvents:function(){AS.message.on(AS.message.RESIZE,this.restrictLines),AS.message.on(AS.message.ORIENTATION_CHANGE,this.onOrientationChange),this.model.on("change:viewable",this.onViewableChange)},removeEvents:function(){AS.message.off(AS.message.RESIZE,this.restrictLines),AS.message.off(AS.message.ORIENTATION_CHANGE,this.onOrientationChange),this.model.off("change:viewable",this.onViewableChange)},onThumbLoaded:function(a){return this.destroyLoadEvents(a.data.image),"error"===a.type?(a.data.callback(new Error("Thumbnail load error for "+this.model.get("id")+" SRC: "+a.data.src)),void $(a.data.image).css("opacity",0)):(this.fadeContentIn(a.data.image),a.data.callback(),void this.forgetCallback())},onViewableChange:function(){this.model.set("imageSrc",this.getImageURL()),this.render(),this.update()},fadeContentIn:function(a){$(a).animate({opacity:1},{duration:300})},onOrientationChange:function(a){this.loadThumb(_.noop)},getImageURL:function(){var a=this.model.get("thumbnails"),b={landscape:["ln_450","landscape"],portrait:["pt_456","portrait"]};return a[_.find(b[AS.orientation.get()],function(b){return a[b]})]},restrictLines:function(){AS.util.restrictTextByLines(this.$(".h2"),2)}})}(),function(){"use strict";AS.StorePromotionView=AS.StoreGridIssueView.extend({className:"promotion",template:"storepromotion-tmpl",restrictLines:function(){AS.util.restrictTextByLines(this.$(".info h2"),2),AS.util.restrictTextByLines(this.$(".info p"),6)},loadThumb:function(a){var b=this;return a=this.storeCallback(a),this.getImageURL()?void _.delay(function(){var c=b.$("img"),d=b.getImageURL();b.attachLoadEvents(a,c,d),c.attr("src",d),b.$(".background-container").css("background-image","url("+d+")")},AS.util.isIE9()?50:0):void a(new Error("Thumbnail not specified for "+this.model.get("id")))},onThumbLoaded:function(a){var b=null,c="show";this.destroyLoadEvents(a.data.image),this.restrictLines(),"error"===a.type&&(b=new Error("Thumbnail load error for "+this.model.get("id")+" SRC: "+a.data.src),c="hide"),$(a.data.image)[c](),this.fadeContentIn(".issue-info"),a.data.callback(b),this.forgetCallback()},render:function(){return AS.View.prototype.render.call(this),this.loadThumb(_.noop),this}})}(),function(){"use strict";var a=AS.config.get("app.auth.loginModalDelay");AS.util.vendorPrefixedEvent("transitionEnd"),AS.StoreView=AS.View.extend({id:"store",className:"container",stylesheet:"webreader/stylesheets/store.css",initialize:function(){_.bindAll(this),this.$el.addClass(AS.config.get("publication.orientation")),AS.message.on(AS.message.FIRST_LAUNCH,this.onFirstLaunch),AS.message.on(AS.message.OFFLINE_OPTIONS_STATUS_CHANGE,this.offlineShowHide),AS.message.on(AS.message.ORIENTATION_CHANGE,this.onOrientationChange)},render:function(){return this.rendered?(this.update(),this):(this.$el.empty(),this.headView=new AS.StoreHeadView,this.gridView=new AS.StoreGridView({model:this.model}),this.footView=new AS.StoreFootView,this.$el.append(this.headView.render().el),this.$el.append(this.gridView.render().el),this.$el.append(this.footView.render().el),this.$el.css({opacity:0}),AS.config.get("app.enableOffline")?this.$el.find(".offline-download-btn").show():this.$el.find(".offline-download-btn").hide(),this.rendered=!0,this)},update:function(){this.gridView.trigger("loadMore"),this.gridView.update(),this.offlineShowHide({libraryPressed:!1})},onFirstLaunch:function(){!AS.Session.authenticated&&AS.config.get("app.auth.launchLogin")&&_.delay(function(){AS.message.trigger(AS.message.STORE_LOGIN_OPEN)},a)},onOrientationChange:function(a){this.$el.removeClass("landscape portrait").addClass(a)},offlineShowHide:function(a){a.libraryPressed===!1&&AS.StateModel.get("isConnected")?this.$(".issue").removeClass("noFlow"):this.$(".issue:not(.library-issue)").addClass("noFlow")}})}(),function(){"use strict";var a=AS.util.vendorPrefixedEvent("transitionEnd");AS.MasterLoginView=AS.PopupView.extend({$highlight:null,model:new AS.AuthToken,events:_.extend({},AS.PopupView.prototype.events),initialize:function(){AS.PopupView.prototype.initialize.apply(this),this.model.on("change:authenticationError",this.authenticationError),this.model.on("change:authenticating",this.authenticatingChange),this.model.on("change:authenticated",this.authenticatedChange),AS.message.on(AS.message.LOGIN_CLOSE,this.close)},render:function(){return AS.PopupView.prototype.render.call(this),this.rendered||(this.rendered=!0,$(document.body).append(this.el)),this},submit:function(a){a.preventDefault(),this.$(".error-message").removeClass("show");var b=this.$("#usernamefield"),c=this.$("#passwordfield"),d={username:b.val(),password:c.val()};b.removeClass("error").removeAttr("data-ttip-content"),c.removeClass("error").removeAttr("data-ttip-content"),d.username?d.password?(this.model.credentials(d),AS.message.trigger(AS.message.AUTHENTICATE,this.model)):this.showFieldError(c,"invalid-password".toLocaleString()):this.showFieldError(b,"invalid-username".toLocaleString())},emptyFields:function(){this.$("#usernamefield").val(""),this.$("#passwordfield").val("")},showFieldError:function(a,b){a.addClass("error"),AS.util.isIE9()?this.$(".error-message").addClass("show").html(b):(a.attr("placeholder",b),_.defer(_.bind(function(){this.highlightError(a)},this)))},highlightError:function(b){var c=this.$highlight||b.clone(),d=function(){c.addClass("noTransition").removeClass("flash").remove()};this.$highlight=c,c.appendTo(b.parent()),c.attr("placeholder",b.attr("placeholder")),c.css({position:"absolute",top:b.position().top,left:b.position().left}),_.defer(function(){c.removeClass("noTransition").addClass("flash")}),c.on(a,function(){d()})},open:function(){this.rendered||this.render(),this.emptyFields(),this.model.reset({publication:AS.Session.getPublication()}),AS.PopupView.prototype.open.call(this),AS.util.isIE9()?setTimeout(function(){this.$("#usernamefield").placeholder(),this.$("#passwordfield").placeholder()},1):$("#usernamefield").focus()},close:function(){this.reset(),AS.PopupView.prototype.close.call(this),AS.util.isIE9()&&(this.rendered=!1)},keydownHandler:function(a){27===a.which&&this.close()},reset:function(){return this.$(".error-message").html("").removeClass("show"),this},authenticatingChange:function(){this.$el.toggleClass("waiting",this.model.get("authenticating")),this.model.get("authenticating")&&this.$("#login").html("login-waiting".toConfiguredLocaleString())},authenticatedChange:function(){this.model.get("authenticated")&&(this.$("#login").html("login".toConfiguredLocaleString()),this.close())},authenticationError:function(){var a=this.model.get("authenticationError");a&&(this.$(".error-message").addClass("show").html(a),this.$("#login").html("login".toConfiguredLocaleString()))},resize:function(a){return this}}),_.extend(AS.MasterLoginView,AS.SingletonView)}(),function(){"use strict";AS.StoreLoginView=AS.MasterLoginView.extend({template:"storelogin-tmpl",events:_.extend({"submit #login-form":"submit","click #login":"submit","click #cancel":"close"},AS.MasterLoginView.prototype.events)}),AS.message.on(AS.message.STORE_LOGIN_OPEN,function(){AS.StoreLoginView.getInstance().reset().open()})}(),function(){"use strict";AS.IssueLoginView=AS.MasterLoginView.extend({template:"issuelogin-tmpl",events:_.extend({"click  #cancel":"cancel","submit #login-form":"submit","reset  #login-form":"close"},AS.MasterLoginView.prototype.events),authenticatedChange:function(){this.model.get("authenticated")&&this.close(null,!0)},authenticationError:function(){var a=this.model.get("authenticationError");a&&this.$(".error-message").addClass("show").html(a),this.$("input[type=submit]").attr("value","login".toConfiguredLocaleString())},close:function(a,b){return b?(this.reset(),AS.PopupView.prototype.close.call(this),this):this},cancel:function(a){a.preventDefault(),this.reset(),AS.router.gotoStore()},keydownHandler:function(a){27===a.which&&this.cancel(a)}}),AS.message.on(AS.message.ISSUE_LOGIN_OPEN,function(){AS.message.trigger(AS.message.CLOSE_LOADING),AS.IssueLoginView.getInstance().reset().open()}),AS.message.on(AS.message.STORE,function(){AS.IssueLoginView.getInstance().close(null,!0)})}(),function(){"use strict";var a=AS.util.vendorPrefixedEvent("transitionEnd");AS.TooltipView=AS.View.extend({options:null,$parent:null,template:"",defaults:{orientation:"bottom",margin:0,userInteraction:!0},initialize:function(a,b,c){var d;this.options={},this.$parent=a,this.template="tooltip-tmpl",_.bindAll(this),this.model=b?new Backbone.Model(b):new Backbone.Model({content:"This tooltip has not been initialised with a model"}),AS.View.prototype.render.call(this);for(d in this.defaults)this.options[d]=this.defaults[d];c&&this.setOptions(c),this.options.userInteraction&&this.$parent.on("mouseover",this.checkShow)},render:function(){return this.rendered?this.$content.text(this.model.get("content")):(AS.View.prototype.render.call(this),this.$content=this.$(".tooltip-content"),this.rendered=!0),this},setOptions:function(a){var b;for(b in a)this.options[b]=a[b]},checkShow:function(a){if(this.$parent[0]===a.target){var b=!1;this.$parent.children().each(function(){this===a.relatedTarget&&(b=!0)}),b||this.show()}},show:function(){this.$parent.append(this.render().el),this.positionTooltip(),this.$el.removeClass("transparent"),this.options.userInteraction&&this.$parent.on("mouseout",this.checkHide)},checkHide:function(a){if(this.$parent[0]===a.target){var b=!1;this.$parent.children().each(function(){this===a.relatedTarget&&(b=!0)}),b||this.hide()}var c=!1;this.$parent.children().each(function(){this===a.target&&this.parentNode!==a.relatedTarget&&(c=!0)}),c&&this.hide()},hide:function(){this.$el.on(a,this._hideEndTransition),this.$el.addClass("transparent")},_hideEndTransition:function(){this.$el.off(a,this._hideEndTransition),this.$el.remove(),this.options.userInteraction&&this.$parent.on("mouseover",this.checkShow)},positionTooltip:function(){var a=this.el,b=this.el.parentNode;this.$el.addClass("tooltip-temp");var c=a.querySelector(".arrow"),d=0,e=0,f=a.offsetWidth,g=a.offsetHeight,h=b.offsetWidth,i=b.offsetHeight;switch(this.$el.removeClass("tooltip-temp"),this.options.orientation){case"top":$(c).removeClass().addClass("arrow arrow-bottom"),d=h/2-f/2,e=-g-c.offsetHeight-this.options.margin;break;case"right":$(c).removeClass().addClass("arrow arrow-left"),d=h+c.offsetWidth+this.options.margin,e=-(g/2)+i/2;break;case"bottom":$(c).removeClass().addClass("arrow arrow-top"),d=h/2-f/2,e=c.offsetHeight+i+this.options.margin;break;case"left":$(c).removeClass().addClass("arrow arrow-right"),d=-f-c.offsetWidth-this.options.margin,e=-(g/2)+i/2;break;case"default":throw new Error("Tooltip orientation is not set")}("auto"===this.$el.css("left")||"0px"===this.$el.css("left"))&&this.$el.css("left",d+"px"),("auto"===this.$el.css("top")||"0px"===this.$el.css("top"))&&this.$el.css("top",e+"px"),"moz"===AS.util.VENDOR_PREFIX&&(this.$el.css("left",d+"px"),this.$el.css("top",e+"px"),"fullscr"===b.id&&this.$el.css("left","-125px"))},removeEvents:function(){this.$parent.off("mouseover",this.checkShow),this.$parent.off("mouseover",this.checkHide),this.$parent.off("mouseout",this.checkShow),this.$parent.off("mouseout",this.checkHide),this.$parent.off(a,this._hideEndTransition)},reset:function(){this.removeEvents(),this.options.userInteraction&&this.$parent.on("mouseover",this.checkShow)},remove:function(){this.removeEvents(),this.$el.remove()},dispose:function(){this.remove()}})}(),function(){"use strict";AS.PageFrameView=Backbone.View.extend({tagName:"iframe",loaded:!1,offline:!1,iScroll:void 0,initialize:function(a){_.bindAll(this),this.updateConnection()},addEvents:function(){this.listenTo(AS.StateModel,"change:isConnected",this.updateConnection)},removeEvents:function(){this.stopListening(AS.StateModel)},updateConnection:function(a){try{this.window().isOnline(AS.StateModel.get("isConnected"))}catch(b){}},render:function(){return this.$el.attr("data-webapp","true").attr("data-autoplay","false").attr("scrolling","no"),this},load:function(a,b){this.url=a,this.offline=b,this.url=this.url.replace("//","/").replace(":/","://"),this.loaded=!1;var c=AS.util.queryString(a)||{};a=[AS.util.stripURL(this.url),$.param(_.extend(c,AS.config.get("app.params")||{}))].join("?"),this.locationMatch(a)||(this.loaded=!1,this.location(a),this.$el.one("load",this.iframeLoaded))},pageIndex:function(){if(this.el.parentElement){var a=$(this.pageView());return parseInt(a.attr("data-index"),10)}return-1},pageView:function(){return this.$el.parents(".page").get(0)},isContentLoaded:function(){var a=this.el.contentDocument;return a&&""!==a.innerHTML?"complete"===this.el.contentDocument.readyState:!1},window:function(){return this.el.contentWindow},location:function(a){return"undefined"==typeof a?String(this.window().location):(this.offline?this.window().location.replace("about:blank"):this.window().location.replace(a),void this.$el.attr("data-src",a))},locationMatch:function(a){var b=this.location();return b.indexOf(a)===b.length-a.length},iframeLoaded:function(){AS.ContentAdaptor.processIframe(this.el,this.offline,this.url),this.prepareOffScreen(),this.offline?this.$el.one("load",this.watchForWidgets):this.watchForWidgets()},accept:function(a){a.visit(this)},getDocumentHead:function(){return this.isContentLoaded()?this.el.contentDocument.documentElement:void 0},getPageWidth:function(){return this.width||$(this.el).width()},getBoundingClientRect:function(){return this.el.parentElement.getBoundingClientRect()},addScrollInjection:function(a){var b=this.window(),c=this;this.iScroll=a,b.scrollTo=function(b,d){_.defer(function(){a.scrollTo(0,-d,0),c.setScrollY(d)})}},watchForWidgets:function(){var a=this.window();try{a.isOnline(AS.StateModel.get("isConnected"))}catch(b){}try{if(a.PR.Core.initialized)return this.iframeInitialised()}catch(b){}this.iframeInitTimeoutId=setTimeout(this.iframeInitialised,1e3);try{a.radio(a.PR.Event.PR_INITIALIZED).subscribe(this.iframeInitialised)}catch(b){}},iframeInitialised:function(){var a=this.window();clearTimeout(this.iframeInitTimeoutId);try{a.radio(a.PR.Event.PR_INITIALIZED).unsubscribe(this.iframeInitialised),AS.ContentAdaptor.initialiseIframe(this.el)}catch(b){}this.loaded=!0,this.trigger(AS.PageFrameView.LOADED)},fixHeight:function(){isNaN(this.height)&&this.el.contentDocument.body&&(this.height=this.el.contentDocument.body.scrollHeight),this.$el.height(this.height)},fixWidth:function(a){isNaN(a)?isNaN(this.width)&&this.el.contentDocument.body&&(this.width=this.el.contentDocument.body.scrollWidth):this.width=a},onScreen:function(){if(this.loaded){var a=this.window();if(this.el.contentDocument&&a.onScreen)try{var b=parseFloat(AS.config.get("animation.loaderView.fadeDuration"),10);b=isNaN(b)?1e3:3*b,_.delay(a.onScreen,b),_.delay(this.focus,b+100),this.updateConnection(),this.addEvents(),this.trigger(AS.PageFrameView.ONSCREEN)}catch(c){}}},prepareOffScreen:function(){if(!AS.browser.ios){if(this.$el.css({"overflow-x":"hidden","overflow-y":"hidden"}),!this.el.contentDocument)throw new Error("No contentDocument. Uh-oh.");$(this.el.contentDocument.body).css({"overflow-x":"hidden","overflow-y":"hidden"})}},offScreen:function(){var a=this.window();if(a&&a.offScreen)try{a.offScreen(),this.removeEvents()}catch(b){}},refresh:function(a){var b=this;this.loaded=!1,this.window().location.reload(),this.$el.one("load",function(){b.on(AS.PageFrameView.LOADED,b.onScreen),b.iframeLoaded(),"function"==typeof a&&a()})},focus:function(){this.$el.focus()},dispose:function(){this.removeEvents(),AS.ContentAdaptor.disposeIframe(this.$el.get(0)),this.$el.remove().empty()},release:function(){this.trigger(AS.PageFrameView.RELEASE),this.dispose()},setScrollY:function(a){this.window().scrollY=Math.abs(a)}},{LOADED:"pageframeview:loaded",ONSCREEN:"pageframeview:onscreen",RELEASE:"pageframeview:release"})}(),function(){"use strict";AS.PageResizeVisitor={CSS_TRANSITION_END_PROPERTY:"transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",visit:function(a){if(a.isContentLoaded()){var b=a.getDocumentHead(),c=window.innerWidth/a.getPageWidth();if($(b).on(this.CSS_TRANSITION_END_PROPERTY,function(){$(b).off(this.CSS_TRANSITION_END_PROPERTY),a.$el.css(AS.util.CSSTransformString({left:"0",top:"0"}))}),1>c){var d=Modernizr.touch?"left top 0px":"center top 0px";$("#pagelist > .current").length>1&&(d=a.getBoundingClientRect().left<window.innerWidth/3?"top right":"top left"),$(b).css(AS.util.CSSTransformString({scale:c,origin:d,duration:.1})),_.delay(function(){a.$el.css("visibility","visible")},1)}else $(b).css(AS.util.CSSTransformString({scale:1})),a.$el.css("visibility","visible").css(AS.util.CSSTransformString({left:"0",top:"0"}));_.defer(_.bind(function(){a.iScroll.refresh()},this))}}}}(),function(){"use strict";function a(a,b){var c,d={left:37,up:38,right:39,down:40};return b=b.toLowerCase(),c=d[b],a.keyCode===c||a.keyIdentifier&&a.keyIdentifier.toLowerCase()===b}var b=AS.util.iframeCount();AS.PageView=AS.View.extend({template:"issuepage-tmpl",pageWidth:void 0,frameView:void 0,loaded:!1,zoomFactor:1,pageHeight:1024,initialize:function(a){_.bindAll(this),a&&(this.pageWidth=a.pageWidth,this.pageIndex=a.pageIndex,a.model&&this.setModel(a.model))},setModel:function(a){this.model&&this.model.off(AS.PageModel.LOAD_START,this.modelLoad),this.model=a,this.model.on(AS.PageModel.LOAD_START,this.modelLoad)},modelLoad:function(){this.frameView&&!this.load()&&this.model.loadComplete()},shouldAutofit:function(){return Modernizr.touch&&window.innerWidth<this.pageWidth&&AS.config.get("app.autofit")},load:function(){var a=this.model.url();if(this.loaded||this.frameView.$el&&this.frameView.locationMatch(a))return this.loaded=!0,this.$el.addClass("loaded"),!1;this.zoomFactor=1,this.shouldAutofit()&&this.iScroll&&(this.iScroll.options.scrollY=!1,this.iScroll.options.scrollX=!1,_.delay(this.updateScrolling,0)),this.loaded=!1,this.model.set("isLoading",!0),this.$el.removeClass("loaded");var b=parseInt(this.model.get("properties").width,10);isNaN(b)||(this.pageWidth=b),this.frameView.$el.css("width",this.pageWidth);var c=AS.util.getCurrentScreenDimensions();this.$el.css("width",Math.min(c.width,this.pageWidth)),this.$el.find(".page-content").css("width",this.pageWidth);var d=parseInt(this.model.get("properties").height,10);return isNaN(d)||(this.pageHeight=d),this.frameView.$el.css("height",this.pageHeight),this.frameView.on(AS.PageFrameView.LOADED,this.iframeLoaded),this.frameView.on(AS.PageFrameView.ONSCREEN,this.iframeOnScreen),this.shouldAutofit()?this.frameView.$el.css("visibility","hidden").css(AS.util.CSSTransformString({left:"10000",top:"10000",origin:"0 0"})):AS.config.get("app.autofit")&&this.frameView.$el.css("visibility","visible").css(AS.util.CSSTransformString({left:"0",top:"0",origin:"0 0"})),this.frameView.load(a,this.model.get("offline")),!0},iframeOnScreen:function(){this.jumpToAnchor()},jumpToAnchor:function(){var a=this.model.get("anchorPoint"),b=this.frameView.window();try{a&&b.PR.Bridge.navigateToElement(a,this.zoomFactor)}catch(c){}this.model.set("anchorPoint",null)},iframeLoaded:function(){this.frameView.off(AS.PageFrameView.LOADED,this.iframeLoaded),this.frameView.addScrollInjection(this.iScroll),this.loaded=!0,this.model.loadComplete(),this.isCurrent()?_.delay(this.onScreen):_.delay(this.prepareOffScreen),this.$el.addClass("loaded"),this.shouldAutofit()&&this.autofitView(),this.frameView.isContentLoaded()&&$(this.frameView.getDocumentHead()).css("background-color","#0a0a0a")},autofitView:function(){_.delay(_.bind(function(){this.applyAutofit(),this.zoomFactor=window.innerWidth/this.pageWidth,this.updatePageDimensions(this.zoomFactor),this.iScroll.enable(),_.delay(this.updateScrolling,0)},this),this.getOnScreenDelay()+112)},getOnScreenDelay:function(){var a=parseFloat(AS.config.get("animation.loaderView.fadeDuration"),10);return a=isNaN(a)?1e3:3*a},applyAutofit:function(){this.frameView&&this.frameView.accept(AS.PageResizeVisitor)},render:function(){var a=this,b=this.model.thumbnailUrl();return this.rendered||(AS.View.prototype.render.call(this),this.$content=this.$(".page-content"),this.iScroll=new IScroll(this.el,{scrollX:!0,scrollY:!0,scrollbars:!0,interactiveScrollbars:!0,bounce:!1,momentum:!0,mouseWheel:!0,checkDOMChanges:!1}),this.iScroll.on("scrollStart",this.onScrollStart),this.iScroll.on("scrollEnd",this.onScrollEnd),this.rendered=!0),AS.resourceManager.loadResource(b,{success:this.applyBackgroundImageToIframe,error:function(c){a.applyBackgroundImageToIframe(b)}}),this},zoomInc:_.debounce(function(){this.zoom(.1)},AS.config.get("animation.zoom").scaleDuration),zoomDec:_.debounce(function(){this.zoom(-.1)},AS.config.get("animation.zoom").scaleDuration),zoom:function(a){this.zoomFactor+=a,this.zoomFactor=Math.max(this.zoomFactor,window.innerWidth<this.pageWidth?window.innerWidth/this.pageWidth:1),this.zoomFactor=Math.min(this.zoomFactor,2),this.updateZoom(this.zoomFactor)},updatePageDimensions:function(a){var b=this.pageHeight*a,c=this.pageWidth*a;this.$el.find(".page-content").height(b).width(c),this.frameView&&(a>1?this.frameView.$el.height(b).width(c):this.frameView.$el.height(this.pageHeight).width(this.pageWidth)),this.$el.css("background-size",c),this.$el.find(".page-content").css("background-size",c)},updateZoom:function(a){this.frameView&&$(this.frameView.getDocumentHead()).css(AS.util.CSSTransformString({origin:"top left",scale:a,duration:AS.config.get("animation.zoom").scaleDuration})),this.updatePageDimensions(a),_.defer(_.bind(function(){this.iScroll.refresh()},this))},applyBackgroundImageToIframe:function(a){if(!this.loaded&&(this.$el.removeClass("loaded").css("background-image",'url( "'+a+'")').css("width",this.pageWidth+"px"),AS.config.get("app.autofit"))){var b="100% auto";Modernizr.touch&&this.pageWidth>window.innerWidth&&(b=window.innerWidth+"px"),this.$el.css("background-size",b).css("background-repeat","no-repeat"),this.$el.find(".page-content").css("background-image",'url( "'+a+'")').css("background-size",b).css("background-repeat","no-repeat")}},onScrollStart:function(){this.iScroll.moved=!0,this.$el.addClass("scrolling")},onScrollEnd:function(){this.$el.removeClass("scrolling"),this.frameView&&this.frameView.setScrollY(this.iScroll.y)},attachFrameView:function(a){this.frameView=a,this.frameView.on(AS.PageFrameView.RELEASE,this.releaseFrameView),this.frameView.height=parseInt(this.model.get("properties").height,10),this.$content.append(this.frameView.render().$el)},releaseFrameView:function(){this.frameView&&(Modernizr.touch&&this.restoreToDefaultZoom(),this.frameView.off(AS.PageFrameView.LOADED,this.iframeLoaded),this.frameView.off(AS.PageFrameView.ONSCREEN,this.iframeOnScreen),this.frameView.off(AS.PageFrameView.RELEASE,this.releaseFrameView),this.frameView=null),this.model&&this.model.set("isLoading",!1),this.loaded=!1,this.$el.removeClass("loaded")},dispose:function(){this.frameView&&this.releaseFrameView(),this.model=void 0,this.$el.remove().empty()},validate:function(){this.frameView?this.frameView.isContentLoaded()&&!this.loaded&&this.frameView.iframeInitialised():this.$el.removeClass("loaded")},isCurrent:function(){return this.$el.hasClass("current")},updateVisibility:function(a){var c,d=parseInt(this.$el.attr("data-x"),10),e=this.pageWidth*(b/2+1);return c=d>a-e&&a+e>d,this.$el.toggleClass("active",c),c},focus:function(){this.frameView&&this.frameView.focus()},fixHeight:function(){this.frameView&&(this.frameView.fixHeight(),this.$content.height(this.frameView.height))},onScreen:function(){if(this.loaded){var a=this.model.get("issue").get("actualId"),b=this.model.get("section").name,c=this.model.get("article").id,d=this.model.index(),e="/Article/",f=this.model.get("article").title;-1!==f.toLowerCase().indexOf("advert")&&(e="/Advert/"),AS.message.trigger(AS.message.TRACK_PAGE,{page:a+e+b+"/"+c+"/"+d}),AS.message.on(AS.message.REFRESH_PAGE,this.refresh),this.frameView&&this.frameView.onScreen(),this.$el.addClass("loaded"),this.fixHeight(),this.frameView&&this.frameView.fixWidth(this.pageWidth),_.delay(_.bind(function(){Modernizr.touch&&this.updateZoom(this.zoomFactor),this.iScroll.options.scrollY=!0,this.iScroll.options.scrollX=!0,this.iScroll.enable(),this.updateScrolling()},this),this.shouldAutofit()?this.getOnScreenDelay()+112:0),AS.message.on(AS.message.ZOOM_PAGEVIEW_INCREASE,this.zoomInc),AS.message.on(AS.message.ZOOM_PAGEVIEW_DECREASE,this.zoomDec),AS.message.on(AS.message.AUTO_FIT_PAGEVIEW,this.restoreToDefaultZoom)}},refresh:function(a){if(("undefined"==typeof a||a===this.pageIndex)&&this.frameView){var b=this,c=function(){Modernizr.touch&&b.updateZoom(b.zoomFactor)};this.frameView.refresh(c)}},updateScrolling:function(){this.iScroll.refresh()},prepareOffScreen:function(){AS.message.off(AS.message.AUTO_FIT_PAGEVIEW,this.restoreToDefaultZoom),AS.message.off(AS.message.ZOOM_PAGEVIEW_DECREASE,this.zoomDec),AS.message.off(AS.message.ZOOM_PAGEVIEW_INCREASE,this.zoomInc),AS.message.off(AS.message.REFRESH_PAGE,this.refresh),this.iScroll.options.scrollY=!1,this.iScroll.disable(),_.delay(this.updateScrolling,0),this.frameView&&this.frameView.prepareOffScreen()},restoreToDefaultZoom:function(){this.zoomFactor=this.shouldAutofit()?window.innerWidth/this.pageWidth:1,this.updateZoom(this.zoomFactor)},offScreen:function(){this.frameView&&(this.frameView.offScreen(),Modernizr.touch&&this.restoreToDefaultZoom())},pageDelta:function(a){this.trigger(AS.PageView.PAGE_DELTA,a)},mouseDown:function(a){AS.message.trigger(AS.message.PAGE_FOCUSED,this.model)},click:function(a){AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:this.model.index()})},scroll:function(a){this.trigger(AS.PageView.SCROLL,a)},keyUp:function(b){if(b=b.originalEvent||b,this.isCurrent()&&this.iScroll){var c=this.$el.height();a(b,"up")?this.scrollTo(Math.min(this.iScroll.y+c,0)):a(b,"down")&&this.scrollTo(Math.max(this.iScroll.y-c,this.iScroll.maxScrollY))}},scrollTo:function(a){this.iScroll.scrollTo(0,a,400),this.onScrollStart()}},{PAGE_DELTA:"pageview:delta",SCROLL:"pageview:scroll"})}(),function(){"use strict";function a(a,b){var c,d={left:37,up:38,right:39,down:40};return b=b.toLowerCase(),c=d[b],a.keyCode===c||a.keyIdentifier&&a.keyIdentifier.toLowerCase()===b}var b=AS.util.vendorPrefixedStyle("transform"),c=(AS.util.vendorPrefixedStyle("transition"),AS.util.vendorPrefixedEvent("transitionEnd"),AS.util.GPU_ENABLED),d=Modernizr.touch,e=AS.util.isIE10(),f=(9===AS.util.getInternetExplorerVersion(),AS.util.iframeCount()),g=7,h=!0,i=AS.config.get("app.auth.loginDelay");(d||e)&&(h=!1),AS.PageListView=AS.View.extend({template:"pagelistview-tmpl",
pageWidth:1024,$pagelist:void 0,pageViewClass:AS.PageView,collection:void 0,rendered:!1,animationTime:1e3,animationTouchTime:1e3,animationEase:null,isAnimating:!1,arrowFadeTime:300,events:{},touchMove:function(a){(a.originalEvent||a).preventDefault()},currentTranslationOffset:0,initialize:function(){_.bindAll(this),this.controller=new AS.PageListViewController(this);var a=AS.config.get("animation.issue");this.animationTime=a.pageMoveDuration,this.animationTouchTime=a.touch.pageMoveDuration,this.animationEase=a.pageMoveEasing,this.arrowFadeTime=a.arrowFadeDuration,this.enableEvents(),this._pageToDebounced=_.debounce(_.bind(this.pageToHandler,this),500,!0),AS.orientation.desktop()&&(this._resizeDebouncedTrailing=_.debounce(_.bind(this.onWindowResize,this),500,!1),AS.message.on(AS.message.RESIZE,this._resizeDebouncedTrailing))},onWindowResize:function(){var a=this;this.$(".current").removeClass("current").addClass("noncurrent"),this.$(".facingpage").removeClass("facingpage");var b=this.model.get("currentVariant").get("currentPageIndex"),c=this.controller.pages[b];c.model.get("article"),c.$el.removeClass("noncurrent").addClass("current");var d=this.makeFacingPageCurrent(b);d?(this.fadeOverlay(d,1),b=Math.min(c.pageIndex,d.pageIndex)):(d=this.getFacingPage(b))&&this.fadeOverlay(d,this._getFadeOverlayOpacity()),AS.message.trigger(AS.message.FACING_PAGE_DISPLAY,this.hasSpineInformation(b)&&this.pageWidth<=window.innerWidth/2),this.animateToThePage(b),_.defer(function(){a.updateArrowsPosition(b),a.toggleArrows(b,a.model.get("currentVariant").get("pages").length),a.fadeArrows(1)},this.animationTime+this.arrowFadeTime)},forceLogin:function(a){this.disableEvents(),this.animateToThePage(a),this.makePageCurrent(a),AS.message.once(AS.message.AUTHENTICATED,_.bind(function(){this.onAuth({page:a})},this)),_.delay(function(){AS.message.trigger(AS.message.ISSUE_LOGIN_OPEN)},i),AS.message.once(AS.message.STORE,this.enableEvents)},onAuth:function(a){this.model.get("summary").set("viewable",!0),this.enableEvents(),this.render(),this.pageTo(a)},enableEvents:function(){AS.message.off(AS.message.STORE,this.enableEvents),AS.message.on(AS.message.PAGE_NAVIGATE,this.pageTo),AS.message.on(AS.message.PAGE_NAVIGATE_NEXT,this.pageRight),AS.message.on(AS.message.PAGE_NAVIGATE_PREVIOUS,this.pageLeft),AS.config.get("features.pageNavigation")&&($(window).on("keyup",this.keyUp),_.extend(this.events,{"click .left-arrow":"pageLeft","click .right-arrow":"pageRight",tap:"tap",swipeleft:"pageSwipeRight",swiperight:"pageSwipeLeft",touchmove:"touchMove","click .page":"pageClick","mousedown .page":"pageMouseDown","touchstart .page":"pageMouseDown","scroll .page":"pageScroll","keyup .page":"pageKeyUp"})),this.delegateEvents()},disableEvents:function(){AS.config.get("features.pageNavigation")&&$(window).off("keyup",this.keyUp),AS.message.off(AS.message.PAGE_NAVIGATE,this.pageTo),AS.message.off(AS.message.PAGE_NAVIGATE_NEXT,this.pageRight),AS.message.off(AS.message.PAGE_NAVIGATE_PREVIOUS,this.pageLeft),this.undelegateEvents()},render:function(){var a,b=this.model.get("currentVariant"),d=0,g=0,h=f,i=this;this.rendered||(AS.View.prototype.render.call(this),this.$pagelist=this.$("#pagelist").toggleClass("gpu",c).toggleClass("ie10",e),this.rendered=!0),this.offline=AS.router.offline,this.$pagelist.empty(),this.collection=b.get("pages"),this.pageWidth=0;try{_.each(b.get("pages").models,function(a){var b=parseInt(a.get("properties").width,10);isNaN(b)||(i.pageWidth=Math.max(i.pageWidth,b))})}catch(j){}(isNaN(this.pageWidth)||0===this.pageWidth)&&(this.pageWidth=b.get("dimensions").page.width);var k=this._getFadeOverlayOpacity();for(g=0;g<this.collection.length;g++)a=this.getOrCreatePageViewAt(g),a.$el.css("left",d+"px").attr("data-x",d).attr("data-index",g),a.$el.addClass("noncurrent"),a.$el.addClass("faded"),a.$el.css("opacity",k),d+=this.pageWidth;return this.controller.disposeUnusedPages(),this.controller.setFrameCount(h),this.controller.setCurrentPageIndex(null),this.$pagelist.width(d),this},pageListTransitionEnd:function(a){if(!a||(a=a.originalEvent||a,-1!==a.propertyName.indexOf("transform")||"left"===a.propertyName)){var b=this.model.get("currentVariant"),c=b.get("currentPageIndex"),d=this.controller.getCurrentPage();d&&this.controller.getCurrentPageIndex()===c||(this.controller.setCurrentPageIndex(c),_.each(this.controller.pages,function(a){a.isCurrent()?(a.onScreen(),(AS.util.isIE10()||AS.util.isIE9())&&a.fixHeight()):a.offScreen()}),AS.message.trigger(AS.message.PAGE_INITIALISED,c))}},pageTo:function(a){this._pageToDebounced(a)},pageToHandler:function(a){var b=a.page;if(this.isValidPage(b)){if(!this.model.get("summary").get("viewable"))return this.forceLogin(b);var c=this.model.get("currentVariant"),d=(this.collection.length,this.controller.getCurrentPage());this.setupNewPage(a,d),this.toggleArrows(b,c.get("pages").length),this.animateToThePage(b,d)}},isValidPage:function(a){var b=(this.model.get("currentVariant"),this.collection.length),c=this.controller.getCurrentPage();return c&&(0>a||a>b-1)?!1:!0},setupNewPage:function(a,b){var c,d=this.model.get("currentVariant"),e=a.page;this.$(".current").removeClass("current").addClass("noncurrent"),this.$(".facingpage").removeClass("facingpage"),d.set({currentPageIndex:e,currentArticleID:this.getArticleByPage(e)}),d.get("pages").models[e].set("anchorPoint",a.anchor),c=this.makePageCurrent(e,b),c&&!b?this.pageListTransitionEnd():c.onScreen()},isPageLeftOfSpine:function(a){var b=this.controller.pages[a];return"leftofspine"===b.model.get("pagePosition").toLowerCase()},isPageRightOfSpine:function(a){var b=this.controller.pages[a];return"rightofspine"===b.model.get("pagePosition").toLowerCase()},getSpreadID:function(a){var b=this.controller.pages[a];return b.model.get("spreadId")},hasSpineInformation:function(a){var b=this.controller.pages[a];return b.model.has("spreadId")&&b.model.has("pagePosition")},getFacingPage:function(a){if(this.hasSpineInformation(a)){var b=(this.controller.pages[a],null),c=this.controller.pages.length;if(this.isPageRightOfSpine(a)&&a-1>=0){var d=this.controller.pages[a-1];d.model,this.hasSpineInformation(a-1)&&this.getSpreadID(a-1)===this.getSpreadID(a)&&this.isPageLeftOfSpine(a-1)&&(b=d)}else if(this.isPageLeftOfSpine(a)&&c>a+1){var e=this.controller.pages[a+1];e.model,this.hasSpineInformation(a+1)&&this.getSpreadID(a+1)===this.getSpreadID(a)&&this.isPageRightOfSpine(a+1)&&(b=e)}return b}return null},makeFacingPageCurrent:function(a){if(AS.util.canShowDoublePage(this.pageWidth)){if(this.hasSpineInformation(a)){var b=this.controller.pages[a];b.$el.addClass("facingpage")}var c=this.getFacingPage(a);return c&&c.$el.removeClass("noncurrent").addClass("current facingpage"),c}return null},makePageCurrent:function(a){var b=this.controller.pages[a];return b.model.get("article"),b.$el.removeClass("noncurrent").addClass("current"),this.updatePageVisibilityLoop(),this._updatePageOpacity(b),AS.message.trigger(AS.message.FACING_PAGE_DISPLAY,this.hasSpineInformation(a)&&this.pageWidth<=window.innerWidth/2),b},_updatePageOpacity:function(a){for(var b=a.pageIndex,c=this.makeFacingPageCurrent(b),d=b-g>0?b-g:0,e=b+g<this.controller.pages.length?b+g:this.controller.pages.length;e>d;++d){var f=!0,h=this.controller.pages[d];a&&a===h&&(f=!1),f&&c&&c===h&&(f=!1),f?this.removeOldPage(h):this.fadeOverlay(h,1)}},removeOldPage:function(a){this.fadeOverlay(a,this._getFadeOverlayOpacity()),a.prepareOffScreen()},toggleArrows:function(a,b){for(var c=a,d=a-1;d>=0&&this.controller.pages[d].isCurrent();--d)c--;this.$(".left-arrow").toggle(c>0);var e=a;for(d=a;b>d&&this.controller.pages[d].isCurrent();++d)e++;this.$(".right-arrow").toggle(b>e)},fadeArrows:function(a){this.$(".left-arrow, .right-arrow").animate({opacity:a},this.arrowFadeTime)},fadeOverlay:function(a,b){var c=this;$(a.el).stop(!1).removeClass("faded").animate({opacity:b},{duration:this.animationTime,complete:function(){b===c._getFadeOverlayOpacity()&&$(a.el).addClass("faded")}})},controlPageVisibilityScan:function(a){this.isAnimating=a,this.updatePageVisibilityLoop()},updatePageVisibilityLoop:function(){var a=Math.abs(h?this.getComputedOffset():this.currentTranslationOffset);this.controller.updatePageVisibility(a),this.isAnimating===!0&&AS.util.requestAnimationFrame(this.updatePageVisibilityLoop)},getDeltaForPage:function(a){var b=this.hasSpineInformation(a);return b&&this.isPageRightOfSpine(a)?this.pageWidth:b&&this.isPageLeftOfSpine(a)?0:Math.round(this.pageWidth/2)},updateArrowsPosition:function(a){var b=this.$el.find(".facingpage").length>0,c=0;!b&&AS.util.canShowDoublePage(this.pageWidth)&&(c=this.getDeltaForPage(a));var d=b?2*this.pageWidth:this.pageWidth;$(".left-arrow").css("left",c-1+"px"),$(".right-arrow").css("left",c+d+"px")},animateToThePage:function(a,b){var c=-this.pageWidth*a,e=this;AS.util.canShowDoublePage(this.pageWidth)&&(c+=this.getDeltaForPage(a)),this.fadeArrows(0),this.currentTranslationOffset=c,h&&this.controlPageVisibilityScan(!0);var f=function(){"undefined"!=typeof b&&e.pageListTransitionEnd(),e.controlPageVisibilityScan(!1),e.updateArrowsPosition(a),e.fadeArrows(1)};this.getComputedOffset()!==c?this.$pagelist.animate({leaveTransforms:!0,left:c},{duration:d?this.animationTouchTime:this.animationTime,easing:this.animationEase,complete:function(){f()}}):_.defer(f,this.arrowFadeTime)},pageDelta:function(a){for(var b=this.model.get("currentVariant"),c=this.controller.pages.length,d=a,e=b.get("currentPageIndex")+d;e>=0&&c>e&&this.controller.pages[b.get("currentPageIndex")+d].isCurrent();++e)d+=a;AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:b.get("currentPageIndex")+d})},pageLeft:function(){this.pageDelta(-1)},pageRight:function(){this.pageDelta(1)},pageSwipeLeft:function(){AS.StateModel.isZoomMode()||this.pageDelta(-1)},pageSwipeRight:function(){AS.StateModel.isZoomMode()||this.pageDelta(1)},offScreen:function(){var a=this.controller.getCurrentPage();a&&a.offScreen(),this.controller.releaseAllFrames()},keyUp:function(b){b=b.originalEvent||b,a(b,"left")?(b.preventDefault(),this.pageLeft()):a(b,"right")&&(b.preventDefault(),this.pageRight())},tap:function(a){AS.Session.canTap&&AS.message.trigger(AS.message.TOGGLE_NAV_BARS)},delegatePageEvent:function(a,b){var c=$(a.currentTarget).attr("data-index"),d=this.controller.pages[c];"undefined"!=typeof d&&d[b].apply(d,arguments)},pageClick:function(a){var b=this.controller.currentPage.pageIndex===parseInt($(a.currentTarget).attr("data-index"),10);AS.config.get("app.mobileOnly")&&AS.Session.canTap&&b?AS.message.trigger(AS.message.TOGGLE_NAV_BARS):b||this.delegatePageEvent(a,"click")},pageMouseDown:function(a){this.delegatePageEvent(a,"mouseDown")},pageScroll:function(a){this.delegatePageEvent(a,"scroll")},pageKeyUp:function(a){this.delegatePageEvent(a,"keyUp")},getComputedOffset:function(){var a,d=window.getComputedStyle(this.$pagelist.get(0),null);if(c){var e=d.getPropertyValue(b);e=e&&"none"!==e?e.split("(")[1].split(")")[0].split(", ")[4]:0,a=parseInt(e,10)}else a=parseInt(d.getPropertyValue("left"),10);return a},getOrCreatePageViewAt:function(a){var b,c;b=this.collection.at(a),b.set("offline",this.model.offline),this.controller.pages.length-1<a?(c=new this.pageViewClass({model:b}),c.on(AS.PageView.PAGE_DELTA,this.pageDelta),c.on(AS.PageView.SCROLL,this.scrollPage),this.controller.addPage(c)):(c=this.controller.getPageAt(a),c.setModel(b)),c.pageIndex=a;var d=parseInt(c.model.get("properties").width,10);return c.pageWidth=Math.max(isNaN(d)?0:d,this.pageWidth),this.$pagelist.append(c.render().$el),c},getArticleByPage:function(a){var b,c=this.model.get("currentVariant").get("pages");return c.forEach(function(c,d){d===a&&(b=c.get("article").id)}),b},_getFadeOverlayOpacity:function(){return AS.config.get("features.opaqueOverlay")?0:.18}})}(),function(){"use strict";AS.BaseScrubberView=AS.View.extend({presentationModel:void 0,getPages:function(){return this.model.get("currentVariant").get("pages")},getSections:function(){return this.model.get("currentVariant").get("sections")}})}(),function(){"use strict";AS.ScrubberThumbnail=AS.View.extend({template:"scrubberthumbnail-tmpl",config:{thumbWidth:48,thumHeight:48},initialize:function(a){_.bindAll(this,"loaded","updateOfflineImage"),a&&a.model&&this.setModel(a.model),a&&a.config&&_.extend(this.config,a.config)},toJSON:function(){var a=this.model.get("issue").urlRoot()+"/"+this.model.get("thumbnail");return AS.resourceManager.isOnline||AS.resourceManager.loadResource(a,{success:this.updateOfflineImage,error:function(b){sef.updateOfflineImage(a)}}),_.extend(this.model.toJSON(),{index:this.model.index(),thumbnail:a})},updateOfflineImage:function(a,b){this.$("img").attr("src",a)},render:function(){var a=this;return AS.View.prototype.render.call(this),this.$("img").width(this.config.thumbWidth).height(this.config.thumbHeight).one("load",function(){var b=a.$("img")[0].naturalWidth,c=a.$("img")[0].naturalHeight,d=a.config.thumbWidth*c/b;isNaN(d)||a.$("img").css("height",d),a.$el.addClass("thumb-loaded")}),this.model.get("isLoaded")&&this.loaded(),this},setModel:function(a){this.model&&this.model.off(AS.PageModel.LOAD_COMPLETE,this.loaded),this.model=a,this.model.get("isLoaded")||this.model.on(AS.PageModel.LOAD_COMPLETE,this.loaded)},loaded:function(){this.model.off(AS.PageModel.LOAD_COMPLETE,this.loaded),this.$el.addClass("loaded")},dispose:function(){this.model&&this.model.off(AS.PageModel.LOAD_COMPLETE,this.loaded),this.model=void 0,this.off(),this.$el.off().remove()}})}(),function(){"use strict";AS.util.vendorPrefixedStyle("transform"),AS.ScrubberTimeline=AS.View.extend({thumbnailClass:AS.ScrubberThumbnail,thumbnailGroupTemplate:AS.View.resolveTemplate("scrubberthumbnailgroup-tmpl"),currentPageIndex:0,state:void 0,template:"scrubbertimeline-tmpl",presentationModel:void 0,lockTimeline:!1,eventsDesktop:{mousemove:"mouseMove",mouseout:"mouseLeave",mousedown:"click"},eventsTouch:{tap:"click",touchstart:"touchStart",touchmove:"stopPropagation",touchend:"touchEnd"},eventsFakeTouch:{click:"click",mousedown:"touchStart",mousemove:"stopPropagation",mouseup:"touchEnd"},events:null,config:{THUMBNAIL_SECTION_MARGIN:40,THUMBNAIL_MARGIN:10,TIMELINE_MIN_SPEED:4,TIMELINE_MAX_SPEED:1200,TIMELINE_END_TOLERANCE:150,CSS_TRANSFORM_PROPERTY:AS.util.vendorPrefixedStyle("transform"),thumbWidth:"",thumbHeight:"",totalMargin:"",xMargin:0},initialize:function(a){_.bindAll(this),this.events=function(){return Modernizr.touch?this.eventsTouch:AS.config.get("app.mobileOnly")?this.eventsFakeTouch:this.eventsDesktop},this.setState(AS.ScrubberTimeline.HIDDEN),this.thumbnails=[],AS.message.on(AS.message.SHOW_TIMELINE,this.show),AS.message.on(AS.message.HIDE_TIMELINE,this.hide),AS.message.on(AS.message.FORCE_SHOW_TIMELINE,this.forceShow),AS.message.on(AS.message.FORCE_HIDE_TIMELINE,this.forceHide),AS.message.on(AS.message.NAVIGATION_SCRUB,this.scrollTo),this.model.get("presentationModel")&&(this.presentationModel=this.model.get("presentationModel"),this.presentationModel.on("change:timelineVisible",this.toggle),Modernizr.touch||AS.config.get("app.mobileOnly")?this.presentationModel.on("change:scrubberVisible",this.toggleIfOpen):(this.presentationModel.on("change:currentScrubPosition",this.scrollToPresentationModel),this.presentationModel.on("change:setPosition",this.scrollToPresentationModel))),a&&a.config&&_.extend(this.config,a.config)},getSingleSections:function(){return this.model.get("currentVariant").get("singleSections")},render:function(){this.rendered||AS.View.prototype.render.call(this);var a,b,c=this,d=0;for(this.collection=this.model.get("currentVariant").get("pages");this.thumbnails.length;)this.thumbnails.pop().dispose();this.$ul=this.$("#scrubber-timeline-list"),this.$ul.empty(),this.$("#scrubber-timeline-list").css("padding-left",c.config.THUMBNAIL_SECTION_MARGIN/2),d+=c.config.THUMBNAIL_SECTION_MARGIN/2;var e=this.getSingleSections();return"undefined"!=typeof e.contents?!0:!1,this.collection.forEach(function(e,f){a&&a.name===e.get("section").name?d+=c.config.THUMBNAIL_MARGIN:(a=e.get("section"),b="contents"!==e.get("section").name?$(c.thumbnailGroupTemplate(a)):$(c.thumbnailGroupTemplate({colour:"",name:""})),c.$ul.append(b),f>0&&(d+=c.config.THUMBNAIL_SECTION_MARGIN)),c.renderThumbnail(e,f).render().$el.attr("data-x",d).appendTo(b.find("ul.thumbnail-list")),d+=c.config.thumbWidth}),d+=c.config.THUMBNAIL_SECTION_MARGIN/2,this.$ul.width(d),void 0!==this.requestAnimationFrameId||Modernizr.touch||this.animationUpdate(),this.rendered=!0,this},renderThumbnail:function(a,b){var c=new this.thumbnailClass({model:a,index:b,config:{thumbWidth:this.config.thumbWidth,thumbHeight:this.config.thumbHeight}});return this.thumbnails.push(c),c},scrollToPresentationModel:function(a,b){this.scrollTo(b)},scrollTo:function(a,b){if(a="undefined"==typeof a?this.currentPageIndex:a,!this.isHovered){var c=this.$ul.outerWidth(),d=this.$el.width(),e=this.$(".thumbnail").get(a),f=$(e).attr("data-x"),g=Math.max(0,Math.min(f-(d-this.config.thumbWidth)/2,c-d));this.speed=this.config.TIMELINE_MIN_SPEED,this.targetX=g}b||(this.currentPageIndex=a),this.$(".thumbnail").each(function(c){$(this).toggleClass(b?"hovered":"selected",c===a)})},translate:function(a){this.$ul.css(this.config.CSS_TRANSFORM_PROPERTY,"translate3d( -"+a+"px, 0, 0 )")},isVisible:function(){return this.$el.hasClass("active")},toggle:function(){this.state===AS.ScrubberTimeline.HIDDEN?this.show(AS.ScrubberTimeline.PERMANENT):this.state===AS.ScrubberTimeline.PERMANENT&&this.hide();var a=this.state!==AS.ScrubberTimeline.HIDDEN;return this.$el.toggleClass("toggle-open",a),a},toggleIfOpen:function(){this.presentationModel.get("timelineVisible")&&this.toggle()},show:function(a){this.setState(a||AS.ScrubberTimeline.PERMANENT),this.presentationModel.set("timelineVisible",!0,{silent:!0})},hide:function(){_.delay(this.doHide,200)},doHide:function(){this.setState(AS.ScrubberTimeline.HIDDEN),this.presentationModel.set("timelineVisible",!1,{silent:!0})},setState:function(a){this.lockTimeline&&(a=AS.ScrubberTimeline.PERMANENT),this.state=a;var b=a>AS.ScrubberTimeline.HIDDEN;this.$el.toggleClass("active",b),AS.browser.ie&&this.$el.height(b?this.$ul.height():0)},thumbnailIndex:function(a){return parseInt(a.attr("data-index"),10)},click:function(a){var b=parseInt($(a.target).parent().attr("data-index"),10);a.stopPropagation(),isNaN(b)||(this.presentationModel.set({timelineVisible:!1,currentScrubPosition:b,setPosition:b}),AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:b}))},mouseMove:function(a){if(AS.config.get("timelineScrubber.mouseHoverNavigation")){var b=this.$ul.width(),c=this.$el.width(),d=a.pageX-this.config.TIMELINE_END_TOLERANCE-this.config.totalMargin,e=Math.min(1,Math.max(d/(c-2*this.config.TIMELINE_END_TOLERANCE),0)),f=e*(b-c),g=window.innerWidth;isNaN(this.currX)&&(this.currX=0),this.isHovered=!0,this.targetX=f,this.lastMouseX=a.pageX,this.speed=this.config.TIMELINE_MAX_SPEED-Math.min(this.config.TIMELINE_MAX_SPEED,2*Math.max(this.config.TIMELINE_MIN_SPEED,Math.abs(a.pageX/g-.5)*this.config.TIMELINE_MAX_SPEED))}},stopPropagation:function(a){a.stopPropagation()},touchStart:function(a){"undefined"!=typeof a.originalEvent.changedTouches&&(this.startX=a.originalEvent.changedTouches[0].pageX)},touchEnd:function(a){"undefined"!=typeof a.originalEvent.changedTouches&&Math.abs(this.startX-a.originalEvent.changedTouches[0].pageX)>20&&a.stopPropagation()},animationUpdate:function(){isNaN(this.currX)&&(this.currX=0),this.currX+=(this.targetX-this.currX)/this.speed,this.translate(this.currX);for(var a,b,c=this.$(".thumbnail"),d=this,e=0;e<c.length&&(a=$(c.get(e)),b=a.offset().left,!(b>this.lastMouseX-this.config.thumbWidth-this.config.THUMBNAIL_MARGIN/2));e++);this.isHovered&&(this.hoveredIndex=parseInt(a.attr("data-index"),10),c.removeClass("hovered"),a.addClass("hovered")),this.$(".thumbnail-group").each(function(){var a=$(this),b=a.find(".thumbnail-group-title"),c=b.find(".title"),e=a.offset(),f=e.left,g=0;f<d.config.xMargin&&(g=Math.min(d.config.xMargin-f,a.width()-c.width())),b.css(d.config.CSS_TRANSFORM_PROPERTY,0!==g?"translate3d( "+g+"px, 0, 0 )":"none")}),this.requestAnimationFrameId=AS.util.requestAnimationFrame(this.animationUpdate)},mouseLeave:function(a){this.isHovered=!1,this.speed=this.config.TIMELINE_MIN_SPEED,this.targetX=this.currX,this.$(".thumbnail").removeClass("hovered")},forceShow:function(a){this.lockTimeline=!0,this.show(a),this.setState(AS.ScrubberTimeline.PERMANENT)},forceHide:function(){this.lockTimeline=!1,this.hide()}},{HIDDEN:0,TEMPORARY:1,PERMANENT:2})}(),function(){"use strict";var a,b,c,d,e,f,g=48,h=1400,i=500,j=0;AS.ScrubberView=AS.BaseScrubberView.extend({template:"scrubberview-tmpl",tickTemplate:AS.View.resolveTemplate("scrubbertick-tmpl"),thumbnailPageNos:AS.View.resolveTemplate("scrubberpagenos-tmpl"),pageIndex:0,presentationModel:void 0,pageInit:!1,isTouch:Modernizr.touch,currentTick:null,eventsDesktop:{"mousedown #scrubber-thumb":"thumbDown","click .tick":"tickClick","mouseover .tick":"tickRollOver","mouseout .tick":"tickRollOut","click .home-button":"homeButtonClick","click .end-button":"endButtonClick"},eventsTouch:{"touchstart #scrubber":"filmStripToggle","tap .home-button":"homeButtonClick","tap .end-button":"endButtonClick"},eventsFakeTouch:{"mousedown #scrubber":"filmStripToggle","click .tick":"tickClickFakeTouch","click .home-button":"homeButtonClick","click .end-button":"endButtonClick"},events:null,initialize:function(a){AS.BaseScrubberView.prototype.initialize.call(this),_.bindAll(this),this.isTouch=Modernizr.touch||AS.config.get("app.mobileOnly"),this.events=function(){return Modernizr.touch?this.eventsTouch:AS.config.get("app.mobileOnly")?this.eventsFakeTouch:this.eventsDesktop};var b=AS.config.get("animation.issue");this.animationTime=b.pageMoveDuration,this.animationTouchTime=b.touch.pageMoveDuration,this.animationEase=b.pageMoveEasing,AS.message.on(AS.message.RESIZE,this.layout),AS.message.on(AS.message.PAGE_LOADED,this.pageLoaded),this.model.get("presentationModel")&&(this.presentationModel=this.model.get("presentationModel"),this.presentationModel.on("change:setPosition",this.pageToFromModel),Modernizr.touch||AS.config.get("app.mobileOnly")?(AS.message.on(AS.message.PAGE_NAVIGATE,this.touchNavigate),this.presentationModel.on("change:scrubberVisible",this.touchToggle)):this.presentationModel.on("change:timelineVisible",this.toggleThumbActive))},filmStripToggle:function(){this.currentTick||this.presentationModel.set({timelineVisible:!this.presentationModel.get("timelineVisible")})},touchNavigate:function(){this.pageInit?this.presentationModel.set({scrubberVisible:!1,timelineVisible:!1}):this.pageInit=!0},touchToggle:function(){this.$el.hasClass("display")?(this.$el.removeClass("display"),$("body").removeClass("show-options")):($("body").addClass("show-options"),this.$el.addClass("display")),this.currentTick=null,AS.message.trigger(AS.message.TOC_HIDE)},render:function(){this.rendered||(AS.BaseScrubberView.prototype.render.call(this),this.rendered=!0);var d=this.model.get("currentVariant"),e=d.get("dimensions");return c=e.page.width,a=e.thumbnail.width,b=e.thumbnail.height,this.layout(),this},layout:function(){var a,b,c=this.getPages(),i=this.getSections(),k=$(window).width(),l=Math.min(k,h),m=l-2*g,n=m/(c.length+i.length-1),o=0,p=0,q=0,r=20,s=this;this.$ticks=this.$(".ticks"),this.$ticks.empty(),this.$thumb=this.$("#scrubber-thumb"),this.$homeButton=this.$(".home-button"),this.$endButton=this.$(".end-button"),d=n,q=-Math.round((d+r)/2),this.$thumb.css("margin-left",q+"px"),c.forEach(function(c,e){b&&b.name===c.get("section").name||(b&&(o+=n),b=c.get("section"),a&&a.addClass("section-last")),a=$(s.tickTemplate(_.extend(c.toJSON(),{index:e}))),a.css({left:o+"px",width:d+"px"}),AS.config.get("app.mobileOnly")&&a.css({"pointer-events":"auto"}),a.attr("data-x",o),a.attr("data-ttip-content",e+1),s.$ticks.append(a),c.get("isLoaded")&&s.pageLoaded(e),o+=n}),m=o+2*j,e=Math.round((l-m)/2),f=Math.round((k-l)/2),p=e-g,this.$el.width(l).css("left",f+"px"),this.$("#scrubber").css("width",m+"px"),this.$homeButton.css("left",p),this.$endButton.css("right",p),this.$ticks.append(this.thumbnailPageNos({startPage:AS.util.numberZero(1),endPage:AS.util.numberZero(c.length)})),this.tickInc=n},scrubMin:function(){return j+d},scrubMax:function(){return this.scrubMin()+this.scrubWidth()},scrubWidth:function(){return this.$ticks.width()-d},tickX:function(a){return parseInt($(this.$(".tick")[a]).attr("data-x"),10)},pageLoaded:function(a){var b=$(this.$ticks.children().get(a));b.addClass("loaded")},pageToFromModel:function(a,b){this.lockThumb||this.dragging||(this.pageTo(b),this.scrubTo(b))},pageTo:function(a,b){var c=this.scrubMin();"undefined"==typeof a&&(a=this.presentationModel.get("setPosition")),this.pageIndex=a,this.$thumb.animate({left:c+this.tickX(a)},{easing:this.animationEase,duration:this.isTouch?this.animationTime:this.animationTouchTime}),b||AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:this.pageIndex}),this.scrubTo(a)},scrubTo:function(a){this.$thumb.toggleClass("loaded",this.getPages().at(a).get("isLoaded")),this.$(".tick").each(function(b,c){$(c).toggleClass("progressed",a>=b)})},tap:function(a){a.stopPropagation(),this.presentationModel.set("timelineVisible",!this.presentationModel.get("timelineVisible"))},thumbDown:function(a){clearTimeout(this.dragTimeoutId),this.thumbDownTimelineVisible=this.presentationModel.get("timelineVisible"),this.presentationModel.set({timelineVisible:!0,currentScrubPosition:this.pageIndex});var b=parseInt(this.$thumb.css("left"),10);this.dragStartX=a.pageX-b,this.dragTimeoutId=setTimeout(this.dragStart,i,a),$(document).on("mousemove",this.thumbMove),$(document).on("mouseup",this.thumbUp)},dragStart:function(a){clearTimeout(this.dragTimeoutId),this.dragging||(this.dragging=!0,this.$thumb.addClass("dragging"),$(document).off("mouseup",this.thumbUp),$(document).on("mouseup",this.dragEnd))},thumbMove:function(a){this.dragging||this.dragStart(a);var b=a.pageX-this.dragStartX,c=this.scrubMin(),d=this.scrubMax(),e=0,f=this.$el.find(".tick");b=Math.max(b,c),b=Math.min(b,d);for(var g=0;g<f.length;g++){var h=c+this.tickX(g);if(h+this.tickInc/2>=b){e=g;break}}this.$thumb.css("left",b),this.presentationModel.set({currentScrubPosition:e}),this.scrubTo(e)},thumbUp:function(a){this.presentationModel.set({timelineVisible:!this.thumbDownTimelineVisible}),$(document).off("mouseup",this.thumbUp),this.thumbInteractionComplete(a)},dragEnd:function(a){this.thumbInteractionComplete(a),this.presentationModel.set({setPosition:this.presentationModel.get("currentScrubPosition"),timelineVisible:!1}),$(document).off("mouseup",this.dragEnd)},thumbInteractionComplete:function(a){clearTimeout(this.dragTimeoutId),this.$thumb.removeClass("dragging"),this.dragging=!1,$(document).off("mousemove",this.thumbMove)},toggleThumbActive:function(){this.$thumb.toggleClass("active",this.presentationModel.get("timelineVisible"))},tickClick:function(a){this.lockThumb=!1;var b=$(a.currentTarget);this.presentationModel.set({setPosition:b.index(),timelineVisible:!1}),this.tickRollOut()},tickClickFakeTouch:function(a){var b=$(a.currentTarget);b.index()!==this.currentTick?(this.currentTick=b.index(),AS.message.trigger(AS.message.NAVIGATION_SCRUB,b.index())):(this.presentationModel.set({timelineVisible:!1}),this.currentTick=null)},tickRollOver:function(a){if(!this.dragging){this.lockThumb=!0;var b=$(a.currentTarget),c=b.index();this.presentationModel.set({timelineVisible:!0,timelineVisibleViaHover:!0,currentScrubPosition:c})}},tickRollOut:function(a){this.dragging||(this.lockThumb=!1)},homeButtonClick:function(a){this.presentationModel.set({timelineVisible:!1,setPosition:0})},endButtonClick:function(a){this.presentationModel.set({timelineVisible:!1,setPosition:this.getPages().length-1})}})}(),function(){"use strict";AS.NavigationPresentationModel=Backbone.Model.extend({isTouch:Modernizr.touch,defaults:{currentScrubPosition:1,setPosition:-1,timelineVisible:!1,timelineVisibleViaHover:!1,scrubberVisible:!0},initialize:function(){_.bindAll(this),this.isTouch=Modernizr.touch||AS.config.get("app.mobileOnly"),this.isTouch&&this.set({timelineVisible:!1,scrubberVisible:!1}),this.on("change:timelineVisible",this.timelineVisibleChange),this.isTouch&&AS.message.on(AS.message.TOGGLE_NAV_BARS,this.toggleVisibility),AS.message.on(AS.message.PAGE_NAVIGATE,this.pageNavigate)},toggleVisibility:function(){this.set("scrubberVisible",!this.get("scrubberVisible"))},pageNavigate:function(a){this.set("setPosition",a.page),this.set("currentScrubPosition",a.page)},timelineVisibleChange:function(){this.get("timelineVisible")||this.set("timelineVisibleViaHover",!1)}});var a,b,c,d=0,e=0;AS.NavigatorView=AS.View.extend({template:"navigationwrapper-tmpl",subviews:[],isTouch:Modernizr.touch||AS.config.get("app.mobileOnly"),touchViews:["TouchScrubberView","ScrubberTimeline"],desktopViews:["ScrubberView","ScrubberTimeline"],events:{mouseleave:"mouseleave"},initialize:function(){_.bindAll(this),this.isTouch=Modernizr.touch||AS.config.get("app.mobileOnly"),this.presentationModel=new AS.NavigationPresentationModel},render:function(){this.rendered||AS.View.prototype.render.call(this);var f,g=this,h=this.model.get("currentVariant"),i=h.get("dimensions");return this.model.set("presentationModel",this.presentationModel),this.presentationModel.set("setPosition",-1,{silent:!0}),AS.config.get("features.timelineScrubber")||(this.desktopViews=_.without(this.desktopViews,"ScrubberTimeline"),this.touchViews=_.without(this.touchViews,"ScrubberTimeline")),c=i.page.width,a=i.thumbnail.width,b=i.thumbnail.height,f={thumbWidth:a,thumbHeight:b,totalMargin:e,xMargin:d},this.rendered?_.each(this.subviews,function(a){_.extend(a.config,f),a.model=g.model,a.render()}):_.each(this.isTouch?this.touchViews:this.desktopViews,function(a){var b=new AS[a]({model:g.model,config:f});g.subviews.push(b),g.$el.append(b.render().el)}),this.rendered=!0,this},mouseleave:function(a){var b=this.presentationModel;a.currentTarget===this.el&&b.set("timelineVisible",!1)}})}(),function(){"use strict";AS.TouchScrubberView=AS.ScrubberView.extend({template:"touchscrubberview-tmpl",attachHandleTooltip:function(a){},attachTickTooltip:function(a,b){},pageInitialised:function(a){this.pageTo(a,!0)}})}(),function(){"use strict";AS.HelpModel=Backbone.Model.extend({defaults:function(){return{helpTitle:"help-menu-title".toLocaleString(),menuMoving:"help-menu-moving".toLocaleString(),toolbarTitle:"help-toolbar-title".toLocaleString(),toolbarDescription:"help-toolbar-content".toLocaleString(),scrubTitle:"help-scrubber-title".toLocaleString(),scrubDescription:"help-scrubber-content".toLocaleString(),bookmarkTitle:"help-bookmark-title".toLocaleString(),bookmarkDescription:"help-bookmark-content".toLocaleString(),zoomTitle:"help-zoom-title".toLocaleString(),zoomDescription:"help-zoom-content".toLocaleString(),stripTitle:"help-strip-title".toLocaleString(),stripDescription:"help-strip-content".toLocaleString(),keyUp:"help-moving-keyup".toLocaleString(),keyDown:"help-moving-keydown".toLocaleString(),keyLeft:"help-moving-keyleft".toLocaleString(),keyRight:"help-moving-keyright".toLocaleString(),moveContent:"help-moving-content".toLocaleString(),currentAction:null,previousAction:null}}});var a="on",b="off",c=new AS.HelpModel,d={"help-toolbar":{on:{trigger:[AS.message.TOOLBAR_OPEN],highlight:["#toolbarWrapper"]},off:{trigger:[AS.message.TOOLBAR_CLOSE]}},"help-scrubber":{on:{highlight:["#scrubber-wrapper"]}},"help-strip":{on:{highlight:["#scrubber-timeline"],classes:{add:{"#scrubber-timeline":"active"},remove:{"#scrubber-timeline":"hidden"}}},off:{classes:{add:{"#scrubber-timeline":"hidden"},remove:{"#scrubber-timeline":"active"}}}}};AS.HelpView=AS.View.extend({ON:"on",OFF:"off",template:"help-tmpl",isOpen:!1,menuActiveClass:"selected",screenActiveClass:"selected",events:{"click .help-close ":"closeHelp","click #helpBackground ":"closeHelp","click .help-button ":"click"},initialize:function(){_.bindAll(this),
this.model=c},reinit:function(){this.model.set(c.defaults()),this.addEventListeners()},addEventListeners:function(){this.model.on("change:currentAction",this.processCurrentAction,this),AS.message.on(AS.message.HELP,function(){this.setAction("help-toolbar"),this.openHelp()},this),AS.message.on(AS.message.BOOKMARK,function(){this.setAction("help-bookmark"),this.openHelp()},this),AS.message.on(AS.message.ZOOM,function(){this.setAction("help-zoom"),this.openHelp()},this),AS.orientation.desktop()&&(AS.message.on(AS.message.RESIZE,this.resizeFixer),AS.message.on(AS.message.PAGE_LOADED,this.startHelp))},setAction:function(a){0===a.indexOf("help-")&&(this.model.get("currentAction")!==a&&this.model.set({previousAction:this.model.get("currentAction")}),this.model.set({currentAction:a}))},resizeFixer:function(){this.isOpen===!0&&this.setHighlight()},render:function(){return this.rendered||(AS.View.prototype.render.call(this),this.rendered=!0),this.reinit(),AS.orientation.desktop()&&(this.isOpen||this.$el.hide()),this},keydownHandler:function(a){27===a.which&&this.closeHelp()},startHelp:function(){AS.message.off(AS.message.PAGE_LOADED,this.startHelp),!AS.cookies.get("help")&&AS.config.get("app.enableCookies")&&(this.setAction("help-bookmark"),this.openHelp(),AS.cookies.set("help",!0,2592e3,"/"))},openHelp:function(){this.isOpen!==!0&&(this.displayHelp(!0),$(document).on("keyup",this.keydownHandler))},closeHelp:function(){this.displayHelp(!1),this.model.set("currentAction",null,{silent:!0}),$(document).off("keyup",this.keydownHandler)},displayHelp:function(a){this.isOpen=a,this.$el[a?"fadeIn":"fadeOut"]("fast"),$("body").toggleClass("help-open",a),a?this.triggerTrackingEvent():this.doAction(this.model.get("currentAction"),b)},triggerTrackingEvent:function(){AS.message.trigger(AS.message.TRACK_PAGE,{page:"Common/Common/Common/Help",title:"Application Page - Help"})},click:function(a){this.setAction($(a.currentTarget).data("action"))},processCurrentAction:function(){this.setCurrentPanel(),this.setMenuSelection(),this.setHighlight()},setMenuSelection:function(){this.$el.find("button").removeClass(this.menuActiveClass),this.$('[data-action="'+this.model.get("currentAction")+'"]').addClass(this.menuActiveClass)},setHighlight:function(){this.doAction(this.model.get("previousAction"),b),this.doAction(this.model.get("currentAction"),a)},doAction:function(a,c){var e=d[a];c===b&&this.highlightElementsRemove(),"undefined"!=typeof e&&e[c]&&this.processRule(e[c])},processRule:function(a){if(a.trigger&&_.each(a.trigger,function(a){AS.message.trigger(a)},this),a.highlight&&_.each(a.highlight,function(a){this.highlightElements(a)},this),a.classes){if(a.classes.add)for(var b in a.classes.add)$(b).addClass(a.classes.add[b]);if(a.classes.remove)for(b in a.classes.remove)$(b).removeClass(a.classes.remove[b])}},setCurrentPanel:function(){this.$el.find(".help-panel."+this.screenActiveClass).removeClass(this.screenActiveClass),this.$el.find("#"+this.model.get("currentAction")).addClass(this.screenActiveClass)},highlightElementsRemove:function(){$(".bringTop").removeClass("bringTop"),$(".highlighter").remove()},highlightElements:function(a){var b,c,d,e=$('<div class="highlighter"></div>'),f=2;$("body").find(a).each(function(){$(this).addClass("bringTop"),b=$(this).outerHeight(),c=$(this).outerWidth(),d=$(this).offset(),("#scrubber-wrapper"===a||"#scrubber-timeline"===a)&&(d.left=-1),e.width(c+f).height(b+f).offset({top:d.top-f/2,left:d.left-f/2}),$("body").append(e)})}})}(),function(){"use strict";AS.ToolbarItemView=AS.View.extend({template:"toolbaritem-tmpl",tooltip:null,initialize:function(){_.bindAll(this)},render:function(){return AS.View.prototype.render.call(this),this.model.get("view")&&(this.tooltip=new(AS[this.model.get("view").split(".")[1]])(this.$("button"),this.model)),this.$el.attr("data-ttip-content",this.model.get("tooltip").toLocaleString()),this.handleSpecifics(),this},dispose:function(){if(this.tooltip)try{this.tooltip.dispose()}catch(a){}this.remove()},handleSpecifics:function(){var a=this.model.get("title");switch(a){case"Window":AS.util.FULL_SCREEN_SUPPORTED&&!AS.config.get("app.mobileOnly")&&(this.$el.addClass("full-screen-supported"),AS.message.on(AS.message.FULL_SCREEN_ENTER,this.fullScreenEnter),AS.message.on(AS.message.FULL_SCREEN_EXIT,this.fullScreenExit));break;case"More":}},fullScreenEnter:function(){this.$el.addClass("is-full-screen").data("ttipContent","tooltip-fullscreen-exit".toLocaleString()),this.$("button").html('<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><g ><path d="M18.61 8.277l3.079-3.077-2.193-2.194-3.078 3.079-2.314-2.314-.488 7.311 7.309-.49zM8.962 17.929l-3.079 3.078-2.194-2.193 3.08-3.078-2.316-2.317 7.312-.486-.489 7.311z"/></g></svg>')},fullScreenExit:function(){this.$el.removeClass("is-full-screen").data("ttipContent","tooltip-fullscreen-enter".toLocaleString()),this.$("button").html('<svg xmlns="http://www.w3.org/2000/svg" width="26.083" height="24.167" viewBox="0 0 26.083 24.167"><g ><path d="M16.402 6.052l-3.26 3.259 2.322 2.322 3.26-3.259 2.449 2.45.516-7.741-7.738.518zM6.656 15.795l3.261-3.259 2.322 2.322-3.26 3.26 2.451 2.451-7.741.515.516-7.74z"/></g></svg>')}})}(),function(){"use strict";AS.ToolbarView=AS.View.extend({elementOffset:void 0,template:"toolbar-tmpl",proximityX:180,proximityY:50,toolbarItems:[],moreMenu:!1,eventsDesktop:{"click .toolbarItem ":"onItemClick"},eventsTouch:{"tap .toolbarItem":"onItemClick"},eventsFakeTouch:{"click .toolbarItem":"onItemClick"},events:null,defaults:{proximityX:180,proximityY:50},animationTime:2e3,animationEasing:"",isShowing:!0,initialize:function(){var a=AS.config.get("animation.toolbar");"object"==typeof a&&(this.animationTime=this.isTouch?a.touch.fadeDuration:a.fadeDuration,this.animationEase=a.fadeEasing),this.collection=new AS.ToolbarItemCollection(AS.config.get("toolbar.items")),_.bindAll(this),this.isTouch=Modernizr.touch||AS.config.get("app.mobileOnly"),this.addEvents();for(var b in this.defaults)this[b]=this.defaults[b]},addEvents:function(){this.events=function(){return Modernizr.touch?this.eventsTouch:AS.config.get("app.mobileOnly")?this.eventsFakeTouch:this.eventsDesktop},this.isTouch?(AS.message.on(AS.message.TOGGLE_NAV_BARS,this.touchToggle),AS.message.on(AS.message.PAGE_NAVIGATE,this.touchHide)):($(document).mousemove(this.onMouseMove),$(document).mouseleave(this.onMouseLeave),$(document).mouseout(this.onMouseOut),AS.message.on(AS.message.TOOLBAR_PROXIMITY,this.changeProximity),AS.message.on(AS.message.TOOLBAR_CLOSE,this.hide),AS.message.on(AS.message.TOOLBAR_OPEN,this.show),AS.message.on(AS.message.TOOLBAR_MORE,this.toggleMoreView)),AS.message.on(AS.message.TOC_TOGGLE,this.tocHandle)},render:function(){if(this.rendered)return this;var a=this;if(a.toolbarItems&&a.toolbarItems.forEach(function(a){a.dispose()}),AS.View.prototype.render.call(this),this.$toolbarContainer=this.$("#toolbarContainer"),this.$toolbarContainerMore=this.$("#toolbarContainerMore"),this.collection.forEach(function(b){var c=!1,d=b.get("title");if(_.contains(b.get("allowedFrameworks"),AS.util.CURRENT_FRAMEWORK)||(c=!0),("Store"===d&&AS.config.get("features.storeAccessibility")===!1||"Share"===d&&AS.config.get("toolbarItems.socialSharing")===!1||"Audio"===d&&AS.config.get("toolbarItems.globalAudioPlayer")===!1||"Contents"===d&&AS.config.get("features.tableOfContents")===!1)&&(c=!0),!c){var e=new AS.ToolbarItemView({model:b});a.toolbarItems.push(e),b.get("isMore")?this.$toolbarContainerMore.append(e.render().el):this.$toolbarContainer.append(e.render().el)}},this),this.isTouch||this.show(),this.isTouch&&AS.config.get("features.navigatorView")){var b=AS.config.get("scrubber").height+"px";this.$el.css("bottom",b)}return this.rendered=!0,this},touchHide:function(){this.$el.removeClass("displayed")},touchToggle:function(){this.$el.toggleClass("displayed")},show:function(){if(this.isShowing===!1&&!AS.util.isModelViewMode()){var a=this;this.isShowing=!0,AS.message.trigger(AS.message.TOOLBAR_WILL_SHOW),this.$el.stop(!1).animate({opacity:1},{duration:this.animationTime,easing:this.animationEase,complete:function(){a.$el.addClass("displayed")}})}},hide:function(){if(this.isShowing===!0){var a=this;this.isShowing=!1,this.$el.stop(!1).animate({opacity:0},{duration:this.animationTime,easing:this.animationEase,complete:function(){a.$el.removeClass("displayed"),a.$toolbarContainerMore.removeClass("displayed"),a.$(".more").removeClass("expanded"),a.moreMenu=!1}}),AS.message.trigger(AS.message.HIDE_GLOBAL_AUDIO)}},checkHelp:function(){return $("body").hasClass("help-open")?!0:!1},testProximity:function(a){var b=this.$el.offset();return b.height=this.$el.height(),a.pageY>b.top&&a.pageY<b.height+b.top+this.proximityY&&a.pageX>b.left-this.proximityX},changeProximity:function(a,b){return"undefined"==typeof a&&"undefined"==typeof b?(this.proximityX=this.defaults.proximityX,void(this.proximityY=this.defaults.proximityY)):(("undefined"!=typeof a||a)&&(this.proximityX=a),void(("undefined"!=typeof b||b)&&(this.proximityY=b)))},toggleMoreView:function(){this.$toolbarContainerMore.toggleClass("displayed"),this.$(".more").toggleClass("expanded"),this.$(".more").hasClass("expanded")?this.moreMenu=!0:this.moreMenu=!1,AS.message.trigger(AS.message.HIDE_GLOBAL_AUDIO)},tocHandle:function(){this.$el.toggleClass("drop-shadow")},onItemClick:function(a){var b=$(a.currentTarget).data("action");if("MORE"===b)this.toggleMoreView();else if(b===AS.message.TOGGLE_FULL_SCREEN)if(AS.util.isIE10()){var c=AS.util.isFullScreen()?"fullscreen-alert-exit":"fullscreen-alert-enter",d=c.toLocaleString();AS.message.trigger(AS.message.ALERT,d)}else AS.message.trigger(AS.message.TOGGLE_FULL_SCREEN);else AS.message.trigger(b,a)},onMouseLeave:function(a){this.checkHelp()||this.hide()},onMouseOut:function(a){var b=a.toElement;b&&("IFRAME"===b.nodeName||"DIV"===b.nodeName&&$(b).hasClass("iScrollVerticalScrollBar")||$(b).hasClass("iScrollIndicator"))&&this.onMouseLeave(a)},onMouseMove:function(a){this.checkHelp()?this.moreMenu||(this.toggleMoreView(),this.moreMenu=!0):this.testProximity(a)?this.show():this.hide()}})}(),function(){"use strict";AS.ZoomView=AS.ToolbarView.extend({template:"zoomview-tmpl",toolbarItems:[],isShowing:!1,initialize:function(){this.collection=new AS.ToolbarItemCollection(AS.config.get("zoomtoolbar.items")),_.bindAll(this),AS.message.on(AS.message.ZOOM_MODE_UPDATE,this.toggleZoomMode),this.addEvents()},addEvents:function(){this.events=function(){return Modernizr.touch?this.eventsTouch:AS.config.get("app.mobileOnly")?this.eventsFakeTouch:this.eventsDesktop}},render:function(){if(this.rendered)return AS.StateModel.isZoomMode()&&AS.message.trigger(AS.message.ZOOM_MODE_TOGGLE),this;var a=this;return a.toolbarItems&&a.toolbarItems.forEach(function(a){a.dispose()}),AS.View.prototype.render.call(this),this.$toolbarContainer=this.$("#zoomviewContainer"),this.collection.forEach(function(b){var c=(b.get("title"),new AS.ToolbarItemView({model:b}));a.toolbarItems.push(c),a.$toolbarContainer.append(c.render().el)},this),a.$el.hide(),this.rendered=!0,this},toggleZoomMode:function(){AS.StateModel.isZoomMode()?(AS.message.trigger(AS.message.TOGGLE_NAV_BARS),this._setPosition(),this.$el.show()):(this.$el.hide(),event&&event.preventDefault())},_setPosition:function(){var a=($(window).height()-AS.config.get("scrubber").height-this.$el.height())/2;a=a>0?a:0,this.$el.css("margin-top",a+"px")}})}(),function(){"use strict";AS.TocBarView=AS.View.extend({template:"toc-tmpl",proximityX:180,proximityY:50,isClosed:!0,isTouch:Modernizr.touch,iScroller:null,elementOffset:void 0,$elHandle:void 0,issueID:void 0,currentTranslateX:0,maxTranslateX:0,sectionViews:[],oldX_:0,vx_:0,dx_:0,startX:0,direction:1,defaultTransitionDuration:500,tolerance:10,eventsDesktop:{"click #tocSwipeHandle":"clickHandle"},eventsTouch:{"touchstart #tocSwipeHandle":"clickHandleTouch","tap #tocSwipeHandle":"clickHandleTouch"},eventsFakeTouch:{"mousedown #tocSwipeHandle":"clickHandleTouch"},events:null,initialize:function(){_.bindAll(this),this.isTouch=Modernizr.touch||AS.config.get("app.mobileOnly"),this.events=function(){return Modernizr.touch?this.eventsTouch:AS.config.get("app.mobileOnly")?this.eventsFakeTouch:this.eventsDesktop},this.issueID=this.getIssueID(),AS.message.on(AS.message.TOC_TOGGLE,this.clickHandle),AS.message.on(AS.message.TOC_ITEM_TOGGLE,this.refreshiScroll),AS.message.on(AS.message.PAGE_NAVIGATE,this.onPageNavigate),this.isTouch&&AS.message.on(AS.message.TOC_HIDE,this.hideTOC)},render:function(){return AS.config.get("features.tableOfContents")===!1?this:(this.rendered||(AS.View.prototype.render.call(this),this.$elHandle=this.$el.find("#tocSwipeHandle"),this.isTouch?(this.iScroller=new IScroll(this.el,{scrollbars:!0,interactiveScrollbars:!0,bounce:!1,momentum:!0}),this.iScroller.on("scrollStart",this.onScrollStart),this.iScroller.on("scrollMove",this.onScrollMove),this.iScroller.on("scrollEnd",this.onScrollEnd)):this.setupProximity()),this.$(".tocContainer").empty(),this.createSections(),this.rendered=!0,this)},createSections:function(){var a=this.getSingleSections(),b="undefined"!=typeof a.contents?!0:!1,c=this;_.size(a)>1&&b&&delete a.contents,_.each(a,function(a,b){var d=new AS.TocSectionView({section:a,index:b,model:c.model});this.addSection(d)},this)},addSection:function(a){this.sectionViews.push(a),this.$el.find(".tocContainer").append(a.render().el)},setupProximity:function(){$(document).mousemove(this.checkProximity),$(document).mouseout(this.onMouseOut)},checkProximity:function(a){this.elementOffset=this.$elHandle.offset(),this.elementOffset.height=this.$elHandle.height(),this.isClosed&&(a.pageX<this.elementOffset.left+this.proximityX?this.showHandle():this.hideHandle())},onMouseOut:function(a){this.isClosed&&this.hideHandle()},onScrollStart:function(){this.$el.addClass("scrolling"),this.iScroller.moved=!0,this.model.set("scrolling",!0),this.scrolling=!0},onScrollMove:function(a){a.preventDefault()},onScrollEnd:function(){this.$el.removeClass("scrolling"),this.model.set("scrolling",!1),this.scrolling=!1},clickHandleTouch:function(a){a.preventDefault(),a.stopImmediatePropagation(),AS.message.trigger(AS.message.TOC_TOGGLE)},clickHandle:function(){AS.message.trigger(AS.message.TRACK_PAGE,{page:this.issueID+"/Common/Common/Contents",title:"Application Page - Contents"}),this.showTOC(this.isClosed)},showHandle:function(){this.$el.find("#tocSwipeHandle").addClass("displayed")},hideHandle:function(){this.$el.find("#tocSwipeHandle").removeClass("displayed")},getTitle:function(){return this.model.get("title")},getSections:function(){return this.model.get("currentVariant").get("sections")},getSingleSections:function(){return this.model.get("currentVariant").get("singleSections")},getIssueID:function(){return this.model.get("currentVariant").get("issue").get("actualId")},showTOC:function(a){var b=a;if(!(!this.isClosed&&b||this.isClosed&&!b)){if(this.hasRefreshed||(this.hasRefreshed=!0,this.refreshiScroll()),b)return this.scrollSelectedIntoView(),this.isClosed=!1,void this.$el.addClass("open");this.isClosed=!0,this.$el.removeClass("open")}},hideTOC:function(){this.showTOC(!1)},scrollSelectedIntoView:function(){var a=$("#toc .tocContainer"),b=$("#toc .tocArticle.selected");if(0!==b.length){var c=a.scrollTop(),d=c+a.height(),e=b.offset().top?b.offset().top:0,f=e+b.height();c>e?a.scrollTop(e):f>d&&a.scrollTop(f-a.height())}},refreshiScroll:function(){this.iScroller&&this.iScroller.refresh()},onPageNavigate:function(a){this.hideTOC()},onScreen:function(a){AS.message.trigger(AS.message.TOC_ON_SCREEN)}})}(),function(){"use strict";AS.TocSectionView=AS.View.extend({className:"sectionView tocSection",tagName:"li",initialize:function(){_.bindAll(this),this.section=this.options.section,this.index=this.options.index,AS.message.on(AS.message.TOC_ON_SCREEN,this.onScreen)},processSection:function(){var a,b,c={},d=AS.View.resolveTemplate("tocitem-tmpl");return c={name:this.section.name,index:this.index,colour:this.section.colour},a=d(c),b=$("<div />").html(a),b=this.createArticleViews(b),b.first()},createArticleViews:function(a){var b,c=this;return _.each(this.section.pages,function(d,e){"advert"!==d.article.type&&(b=new AS.TocArticleView({article:d,index:e,model:c.model}),a.find(".sectionItems").append(b.render().el))}),a},render:function(){return this.$el.append(this.processSection()),this}})}(),function(){"use strict";AS.TocArticleView=AS.View.extend({className:"articleView tocArticle",tagName:"li",events:{"click .goToArticle":"gotoArticle","tap .goToArticle":"gotoArticle"},initialize:function(){_.bindAll(this),this.article=this.options.article,this.index=this.options.index,AS.message.on(AS.message.TOC_ON_SCREEN,this.onScreen),AS.message.on(AS.message.PAGE_NAVIGATE,this.onPageNavigate)},gotoArticle:function(a){if(!this.scrolling&&!this.model.get("scrolling")){var b=$(a.currentTarget).data("target");AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:parseInt(b,0)})}},processArticles:function(){var a,b,c=AS.View.resolveTemplate("tocsubitem-tmpl");return b=this.getArticleData(this.article,this.index),a=c(b)},onScreen:function(){this.shortenTOCText()},shortenTOCText:function(){var a=this.$(".articleTitle"),b=this.$(".articleDescription"),c=AS.config.get("toc.titleLines")||4,d=AS.config.get("toc.descriptionLines")||2;this._restrictTextByLines(a,c),this._restrictTextByLines(b,d)},_restrictTextByLines:function(a,b){var c,d;a.each(function(){c||(d=$(this).html(),c=$(this).html("&nbsp").height(),$(this).html(d)),"function"==typeof $.fn.dotdotdot&&$(this).dotdotdot({height:c*b})})},getArticleData:function(a,b){var c,d,e,f,g=this;return this.articlePageLookup=this.getArticles(),f=new AS.PageModel(a),""===a.article["abstract"]&&this.$el.addClass("no-description"),c=AS.config.get("toc.showHTMLTitle")?a.article.titleHtml:a.article.title,d=a.thumbnail?AS.config.get("toc.showImage"):!1,{name:c,description:a.article["abstract"],id:parseFloat(g.articlePageLookup[a.article.id]),imageShow:d,descriptionShow:AS.config.get("toc.showDescription"),page:e,image:f.thumbnailUrl()}},getArticles:function(){return this.model.get("currentVariant").get("articles")},onPageNavigate:function(a){a.page===this.article.index?this.$el.addClass("selected"):this.$el.removeClass("selected")},render:function(){return this.$el.empty(),this.$el.append(this.processArticles()),this}})}(),function(){"use strict";AS.SharingView=AS.View.extend({addthis_share_defaults:{url:window.location.href,templates:{twitter:"Check out {{url}} (from @publishhtml5)"}},facebook_share_defaults:{method:"feed",link:window.location.href,caption:"",description:""},events:{mouseleave:"hideView","click .icon.facebook":"facebookshare","click .icon.email":"emailshare","click .icon.twitter":"twittershare","click .icon.linkedin":"linkedinshare"},template:"sharing-tmpl",$parent:void 0,isAddThisInitialized:!1,initialize:function(a,b,c){_.bindAll(this),this.addthis_share=_.extend(this.addthis_share_defaults,AS.config.get("sharing")),this.$parent=a,this.$parent.on("mouseleave",this.hideView),AS.message.on(AS.message.RESIZE,this.showView),AS.message.on(AS.message.SHARE,this.showView),AS.message.on(AS.message.PAGE_INITIALISED,this.pageNavigate),AS.config.get("toolbarItems.socialSharing")&&AS.message.on(AS.message.TOOLBAR_WILL_SHOW,this.updateVisibility),this.render()},updateVisibility:function(){return this.isAddThisInitialized&&AS.message.off(AS.message.TOOLBAR_WILL_SHOW,this.updateVisibility),"undefined"!=typeof addthis?this.$parent.show():this.$parent.hide()},showView:function(a){this.isAddThisInitialized||this.initAddThis();var b=this.$parent.offset();this.$el.css({position:"absolute",top:b.top,left:b.left-this.$el.width()-10,"z-index":"5"}),a&&this.$el.css({display:"block"})},hideView:function(a){a.relatedTarget===this.el||$(a.relatedTarget).parents().is(this.el)||this.$el.css("display","none")},pageNavigate:function(){this.addthis_share.url=window.location.href,this.addthis_share.title=$("title").text(),this.facebook_share_defaults.link=window.location.href,"undefined"!=typeof addthis&&addthis.toolbox(this.el,{},this.addthis_share)},initAddThis:function(){"undefined"!=typeof addthis&&(addthis.toolbox(this.el,{},this.addthis_share),this.isAddThisInitialized=!0)},render:function(){return AS.View.prototype.render.call(this),$("body").append(this.el),this},twittershare:function(){this.logShare("Twitter")},linkedinshare:function(){this.logShare("LinkedIn")},emailshare:function(){this.logShare("Email")},logShare:function(a){var b=AS.router.publicationModel.get("currentIssue").get("currentVariant").get("issue").get("actualId"),c=AS.router.publicationModel.get("currentIssue").get("currentVariant").get("currentArticleID"),d=b+"/"+c+"/";AS.message.trigger(AS.message.TRACK_EVENT,{eventCategory:AS.Analytics.categories.SHARE,eventAction:a,eventLabel:d})},facebookshare:function(){this.logShare("Facebook");var a=_.extend(this.facebook_share_defaults,AS.config.get("sharing.facebook"));try{this.FBInitialised||(FB.init({appId:AS.config.get("sharing.facebook.AppID"),status:!0,cookie:!0}),this.FBInitialised=!0),FB.ui(a)}catch(b){}},dispose:function(){AS.message.off(AS.message.RESIZE,this.showView),AS.message.off(AS.message.PAGE_NAVIGATE,this.pageNavigate),this.$el.remove()}})}(),function(){"use strict";AS.SpreadView=AS.View.extend({$parent:void 0,initialize:function(a,b,c){_.bindAll(this),this.$parent=a,AS.message.on(AS.message.SPREAD_VIEW_TOGGLE,this.spreadViewToggle),AS.message.on(AS.message.FACING_PAGE_DISPLAY,this.onPageDisplay),this.render()},render:function(){return AS.View.prototype.render.call(this),this.updateIcon(),this},updateIcon:function(){var a=this.$parent.find("svg")[0];$(a).attr("class",AS.config.get("app").facingPages?"singlepagebutton":"facingpagesbutton")},spreadViewToggle:function(){AS.config.get("app").facingPages=!AS.config.get("app").facingPages,this.updateIcon(),AS.message.trigger(AS.message.RESIZE)},onPageDisplay:function(a){a?this.$parent.show():this.$parent.hide()},dispose:function(){AS.message.off(AS.message.FACING_PAGE_DISPLAY,this.onPageDisplay),AS.message.off(AS.message.SPREAD_VIEW_TOGGLE,this.spreadViewToggle),this.$el.remove()}})}(),function(){"use strict";AS.AudioView=AS.View.extend({percX:0,template:AS.View.resolveTemplate("audio-tmpl"),model:null,options:{margin:"5"},id:"audioplayer",className:"invisible",events:{"click .next.move-button":"clickNext","click .prev.move-button":"clickPrev","click .play-button":"clickPlay","mousedown .scrubber-handle":"scrubberStartMove","click .scrubber":"clickScrubber"},initialize:function(){_.bindAll(this),AS.message.on(AS.message.TOGGLE_GLOBAL_AUDIO,this.toggleView),AS.message.on(AS.message.SHOW_GLOBAL_AUDIO,this.showView),AS.message.on(AS.message.HIDE_GLOBAL_AUDIO,this.hideView),this.$el.on("mouseleave",this.hideView)},setModel:function(a){this.model&&this.model.off(),this.model=a,this.model.on("change",this.render,this),this.render()},render:function(){$(this.el).html(this.template(this.model.toJSON()));var a=Math.floor(100*Number(this.model.get("currentDuration")/Number(this.model.get("totalDuration"))));return this.$el.find(".scrubber-ticks.left").css("width",a+"%"),this.$el.find(".scrubber-ticks.right").css("width",100-a+"%"),this.model.get("updateScrubber")?this.$el.find(".scrubber-handle").css("left",a+"%"):this.$el.find(".scrubber-handle").css("left",100*this.percX+"%"),this},showView:function(a){var b=$(a.target).closest("button").offset();this.$el.removeClass("invisible").addClass("show"),_.defer(_.bind(function(){this.$el.css({top:b.top,left:b.left-this.$el.outerWidth()-this.options.margin,"z-index":1e3}),AS.message.trigger(AS.message.TOOLBAR_PROXIMITY,this.$el.width()+100+20)},this))},hideView:function(a){this.$el.removeClass("show").addClass("invisible"),AS.message.trigger(AS.message.TOOLBAR_PROXIMITY)},toggleView:function(a){this.$el.hasClass("invisible")?this.showView(a):this.hideView(a)},setOptions:function(a){for(var b in a)this.options[b]=a[b]},clickNext:function(){AS.message.trigger(AS.message.NEXT_GLOBAL_AUDIO)},clickPrev:function(){AS.message.trigger(AS.message.PREV_GLOBAL_AUDIO)},clickPlay:function(){this.model.togglePlay()},clickScrubber:function(a){var b=!1;if(""!==this.model.get("audioUrl")){this.model.get("playing")&&(b=!0,this.model.togglePlay());var c=$(".scrubber"),d=a.pageX-c.offset().left;this.percX=d/c.width(),this.model.set("updateScrubber",!0),this.model.set("currentDuration",this.model.get("totalDuration")*this.percX),AS.message.trigger(AS.message.UPDATE_GLOBAL_AUDIO),b&&this.model.togglePlay()}},scrubberStartMove:function(a){""!==this.model.get("audioUrl")&&($(window).on("mouseup",this.scrubberEndMove),$(window).on("mousemove",this.scrubberMove),this.$el.on("mouseleave",this.scrubberEndMove),this.model.set("updateScrubber",!1))},scrubberMove:function(a){var b=this.$(".scrubber-handle"),c=this.$(".scrubber").width(),d=a.pageX-b.parent().offset().left;0>d&&(d=0),d>c&&(d=c),this.percX=d/c,b.css("left",d)},scrubberEndMove:function(a){$(window).off("mouseup",this.scrubberEndMove),$(window).off("mousemove",this.scrubberMove),this.$el.off("mouseleave",this.scrubberEndMove),this.model.set("updateScrubber",!0),this.model.set("currentDuration",this.model.get("totalDuration")*this.percX),AS.message.trigger(AS.message.UPDATE_GLOBAL_AUDIO)}})}(),function(){"use strict";AS.NoCookieModel=Backbone.Model.extend({defaults:{cookieTitle:"cookies-title".toLocaleString(),cookieText:"cookies-text".toLocaleString(),loader:AS.config.get("app.loading")}}),AS.NoCookieView=AS.View.extend({template:"nocookies-tmpl",model:new AS.NoCookieModel,initialize:function(){return _.bindAll(this),this.model.set("loader",AS.config.get("app.loading")),this},render:function(){return AS.View.prototype.render.call(this),this.$("#loading-image").on("load",function(){$(this).parent().css({"margin-top":-this.height/2,"margin-left":-this.width/2})}).attr("src",this.model.get("loader").image),this}})}(),function(){"use strict";AS.OfflineModel=Backbone.Model.extend({defaults:{offlineTitle:"offline-title".toLocaleString(),offlineText:"offline-text".toLocaleString(),loader:AS.config.get("app.loading")}}),AS.OfflineView=AS.SingletonView.extend({template:"offline-tmpl",model:new AS.OfflineModel,initialize:function(){return _.bindAll(this),this.model.set("loader",AS.config.get("app.loading")),this.render(),this},render:function(){return AS.View.prototype.render.call(this),this.$("#loading-image").on("load",function(){$(this).parent().css({"margin-top":-this.height/2,"margin-left":-this.width/2})}).attr("src",this.model.get("loader").image),this},hide:function(){this.$el.removeClass("display"),this.$el.on("transitionend",this.removeFromDom)},removeFromDom:function(){$("#offline-screen").remove(),this.$el.off("transitionend")},show:function(){var a=this;this.$el.off("transitionend"),this.addToDom(),_.defer(function(){a.$el.addClass("display")})},addToDom:function(){0===$("#offline-screen").length&&$("body").append(this.el)}})}(),function(){"use strict";function a(a){window.alert(a)}AS.message.on(AS.message.ALERT,a)}(),function(){"use strict";function a(a){var b=a.id,c=a.get("issue").id;return[c,b].join("/")}function b(a){"object"==typeof a&&(g=a)}function c(a){"object"==typeof a&&(h=a)}function d(a,b){AS.Session.authenticated=!0,b&&(AS.Session.authCredentials={username:b.username,password:b.password},AS.Session.userid="",b.userid&&(AS.Session.userid=b.userid)),g&&g.setUserAccess(!0,a)}function e(){AS.Session.authenticated=!1,AS.Session.userid="",f(),g&&g.setUserAccess(!1)}function f(){h=null}var g,h,i=function(){return{read:function(a){return localStorage.getItem(a)},write:function(a,b){localStorage.setItem(a,b)},clear:function(a){localStorage.removeItem(a)}}};AS.Session={storage:i(),authenticated:!1,authCredentials:{username:"",password:""},userid:"",canTap:!0,getPublication:function(){return g},getPublicationId:function(){return this.getPublication().id},getCurrentIssue:function(){return h},getCurrentIssueId:function(){return h?h.get("actualId"):null},getCurrentArticleId:function(){var a=h?h.getCurrentArticle():null;return a?a.id:void 0},getCurrentVariant:function(){return h?h.get("currentVariant"):void 0},getCurrentPageIndex:function(){var a=this.getCurrentVariant();return a?a.get("currentPageIndex"):void 0},getCurrentPage:function(){var a=this.getCurrentVariant(),b=this.getCurrentPageIndex();return a?a.get("pages").at(b):void 0},getCurrentPageId:function(){var a=this.getCurrentPage();return a?a.id:void 0},getCurrentUserId:function(){return AS.Session.userid},loadStateForCurrentPage:function(){var b=a(this.getCurrentPage());return this.storage.read(b)},saveStateForCurrentPage:function(b){var c=a(this.getCurrentPage());this.storage.write(c,b)},resetStateForCurrentPage:function(){var b=this.getCurrentPage(),c=a(b);this.storage.clear(c),AS.message.trigger(AS.message.REFRESH_PAGE,this.getCurrentPageIndex())}},AS.message.on(AS.message.PUBLICATION_LOADED,b),AS.message.on(AS.message.ISSUE_LOADED,c),AS.message.on(AS.message.AUTHENTICATED,d),AS.message.on(AS.message.UNAUTHENTICATED,e),AS.message.on(AS.message.STORE,f)}(),function(){"use strict";function a(a){return a}function b(a){return"string"==typeof a&&0===a.indexOf("data:")}function c(a){return function(b){a[b.data.command].apply(a,b.data.args)}}var d={png:"image/png",jpg:"image/jpg",gif:"image/gif",jpeg:"image/jpeg",css:"text/css",json:"application/json",ttf:"application/octet-stream",otf:"application/octet-stream",js:"application/javascript",swf:"application/octet-stream",mp4:"video/mp4"},e=function(){function a(a){for(var b in h)if(new RegExp(b).test(a))return h[b]}function b(b,c,d){var e=a(c);try{var f=new XMLHttpRequest;f.open("GET",b,!0),f.responseType=e.responseType,f.onload=function(){if(200===this.status){var a=this.response,f=function(b,c){d(b,c,a)};"function"==typeof e.process?e.process(a,c,f,b):f(null,a)}else d("error")},f.send()}catch(g){d("error")}}function c(a,b,c,d){var e,f=new FileReader;if("undefined"!=typeof Blob)try{e=new Blob([a],{type:b})}catch(h){}if(!e&&"undefined"!=typeof g)try{var i=new g;i.append(a),e=i.getBlob(b)}catch(h){return c(h)}f.onloadend=function(a){c(null,f.result)},f.onerror=c,f.readAsDataURL(e)}function d(a,b,c,d){var e,f;try{e=JSON.parse(a)}catch(g){f=String(g)}setTimeout(c,0,f,e)}function e(a,b,c,d){var e;setTimeout(c,0,e,a)}function f(a,b,c,d){function e(a,b,c,d,e,f){var h=g.split("/"),i=c?c.split("/"):p5.split("/"),j=c?c.split("/"):p5.split("/");_.each(j,function(a){".."===a&&(h.pop(),i.shift())});var k=b+h.join("/")+"/"+i.join("/")+d.replace("'","");return k}function f(a){return a.substring(0,a.lastIndexOf("/"))}var g=f(d);a=a.replace(/(url\()['"]?([^#][\s\S]+?)['"]?(\))/gi,e),c(null,a)}var g="undefined"!=typeof g&&g||"undefined"!=typeof WebKitBlobBuilder&&WebKitBlobBuilder||"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,h={"image|video|octet-stream":{process:c,responseType:"arraybuffer"},javascript:{process:e,responseType:"text"},css:{process:f,responseType:"text"},json:{process:d,responseType:"text"}};return{loadFile:b}}(),f=function(){var f,g=[],h={},i={persistenceEnabled:!1,registerImpl:function(a,b,c){g.push({id:a,priority:c,impl:b}),g.sort(function(a,b){return a.priority<b.priority}),h[a]=b},retrieveImpl:function(a){if(!a)return f;var b=h[a];return"function"==typeof b?b():b},reset:function(){g=[],h={},f=void 0},disableOffline:function(a,b){i.persistenceEnabled=!1,"function"==typeof b&&b()},init:function(a){return f=g.length>0?g.shift().impl():void 0,AS.config.get("app.enableOffline")?f?void("function"==typeof f.init?(i.persistenceEnabled=!0,f.init(function(b){if(b)return i.init(a);try{}catch(c){}a()})):_.defer(a)):void this.disableOffline("No offline support available",a):void this.disableOffline("Offline support disabled",a)},read:function(c,d){var e=a(c);d=d||{},i.persistenceEnabled?f.read(e,function(a){a?(b(a)||(a=JSON.parse(a)),"function"==typeof d.success&&d.success(a,c)):"function"==typeof d.error&&d.error("Not found in local storage: "+c);
}):"function"==typeof d.error&&d.error("No persistence layer found")},remove:function(b,c){var d=a(b);f.remove(d,function(){c()})},write:function(c,d,e,g){var h=a(c);b(d)||(d=JSON.stringify(d)),i.persistenceEnabled&&f.write(h,d,e,g)},loadFile:function(a,b){if("function"!=typeof b.error)throw new Error("No Error Callback for load Resource");if("function"!=typeof b.success)throw new Error("No Success Callback for load resource");var c=a.split("?").shift().split(".").pop(),f=d[c],g=this;e.loadFile(a,f,function(c,d,e){return c?g.error(a,b):void(i.persistenceEnabled?g.writeFile(a,d,e,b):b.success(d,e,a))})},writeFile:function(a,b,c,d){if("function"!=typeof d.error)throw new Error("No Error Callback for load Resource");if("function"!=typeof d.success)throw new Error("No Success Callback for load resource");i.write(a,b,c,function(){d.success(b,c,a)})},error:function(a,b){if("function"!=typeof b.error)throw new Error("No Error Callback for load Resource");if("function"!=typeof b.success)throw new Error("No Success Callback for load resource");i.read(a,{success:function(a){b.success(a)},error:function(c){b.error("File: "+a+" not found")}})},createResponder:c};return i};AS.OfflineManager=f,AS.offlineWorker=e,AS.offlineManager=f()}(),function(){"use strict";function a(){_.bindAll(this),this.storeJSON={},this.initilised=!1,this.updateChecked=!1,this.publication=void 0,this.storeJSONKey=void 0,this.publishedDate=void 0,this.callback=void 0,this.init()}a.prototype={init:function(){this.initilised||(this.publication=AS.router.publicationModel.get("name"),this.publishedDate=AS.router.publicationModel.get("published"),this.storeJSONKey=this.publication+"sstore")},fetch:function(a){this.fetchSuccess=a.success,AS.offlineManager.read(this.storeJSONKey,{success:this.validJSON,error:function(a){}})},validJSON:function(a){a?AS.resourceHelper.isOnline?a.publishedDate===this.publishedDate?(this.storeJSON=a,this.initilised=!0,AS.message.trigger(AS.message.OFFLINE_STORE_JSON_READY),"function"==typeof this.fetchSuccess&&this.fetchSuccess(this.storeJSON)):this.freshBuild(this.validJSON):(this.storeJSON=a,this.initilised=!0,AS.message.trigger(AS.message.OFFLINE_STORE_JSON_READY),"function"==typeof this.fetchSuccess&&this.fetchSuccess(this.storeJSON)):this.freshBuild(this.validJSON)},writeJSON:function(a,b){AS.offlineManager.write(this.storeJSONKey,a,{},function(){b(a)})},freshBuild:function(a){function b(b){_.each(b.orientations,function(g,h){AS.offlineManager.loadFile(g,function(g,h,i){b.varients=b.varients+1,c.size=c.size+h.byteLength,b.varients===_.keys(b.orientations).length&&(c.issues.push(b),e+=1,e===d.length&&f.writeJSON(c,a))})})}var c,d,e=0,f=(this.storeJSONKey,this);c={version:AS.config.get("version"),commit:AS.config.get("gitcommit"),publishedDate:this.publishedDate,name:this.publication,created:new Date,issues:[],size:0},d=AS.router.publicationModel.get("issues").models,_.each(d,function(a){var c={title:a.get("title"),orientations:a.get("previews"),id:a.get("actualId"),varients:0,size:0};b(c)})}},AS.LibraryManager=a}(),function(){"use strict";function a(a){_.bindAll(this),this.issueJSON={id:void 0,pages:[],asset:[],size:0,noPages:0,published:0,downloaded:void 0},this.callback=void 0,this.issueID=void 0,this.processed=!1,this.issueModel=void 0,this.noPages=0,this.savedPages=0,this.savedAssets=0,this.postProcessCount=0,this.postProcessMe=[],this.completed=!1,this.totalSize=0,this.pageSize=0,this.pageDetails=[],this.pageQueue=[],this.assetQueue=[],this.fileTypes={HTML:"processHTML",CSS:"processCSS",JS:"processJS",JPG:"processBinary",GIF:"processBinary",PNG:"processBinary",JPEG:"processBinary",TTF:"processBinary",OTF:"processBinary",SWF:"processBinary",MP4:"processBinary"},this.issueID=a.id,this.offline=void 0,this.postProcessHTML=!0,this.postProcessCSS=!0,this.postProcessJS=!0,this.postProcessIMAGES=!0,this.mediaElementRequired=!0,this.init()}a.prototype={init:function(){this.freshStart(),this.offlineKey=AS.router.publicationModel.get("name")+"-"+this.issueID},freshStart:function(){this.savedPages=0,this.noPages=0,this.completed=!1,this.offline=void 0,this.issueJSON={id:this.issueID,pages:[],asset:[],size:0,noPages:0,published:0,downloaded:void 0}},offlineCheck:function(a){var b=this;void 0===this.offline?AS.offlineManager.read(this.offlineKey,{success:function(c){b.offline=!1,c&&(b.issueJSON=c,b.offline=!0),"function"==typeof a&&a(b.offline)},error:function(a){}}):"function"==typeof a&&a(b.offline)},download:function(){var a=AS.router.publicationModel.get("issues").get(this.issueID),b=this;this.issueModel=new AS.IssueModel({publication:AS.router.publicationModel.publicationModel,summary:a}),function c(a){b.issueModel.fetch({success:function(){b.getInfo()},error:function(){AS.util.RETINA?(AS.util.RETINA=!1,c(a)):errorHandler()}})}(this.issueModel)},getInfo:function(){var a,b=this.issueModel.get("variants").models,c=this;this.mediaElementRequired&&(a=AS.config.get("widgets"),a.reader=AS.router.readerURL,this.pageQueue.push(a.reader+a.video.mediaElementCSSFile),this.postProcessMe.push(a.reader+a.video.mediaElementCSSFile),c.noPages+=1),_.each(b,function(a,b){c.noPages+=a.get("pages").models.length,_.each(a.get("pages").models,function(a,b){c.pageQueue.push(a.url()),AS.message.trigger(AS.message.OFFLINE_PAGE_READ_COMPLETE,{id:c.issueID,total:c.pageQueue.length}),c.assetQueue.push(a.thumbnailUrl())})}),this.issueJSON.id=this.issueID,this.issueJSON.noPages=c.pageQueue.length,this.issueJSON.published=this.issueModel.get("publishedDate"),this.issueJSON.downloaded=Date(),this.process()},postProcess:function(a,b){function c(c){function e(a,b,c,d,e,f){return o.push([a,c]),a}function f(a,b,c,d,e,f,g,h){return c?o.push([a,c]):o.push([a,f]),a}function g(a){var b=(a[1],d.fileExt(a[1])),c=d.fileTypes[b];return q[c]?void AS.offlineManager.read(a[1],{success:function(a,b){q[c](a,b)},error:function(){h()}}):void h()}function h(){if(o.length)j=o.shift(),g(j);else{if(!p)return p=!0,d.processCSS&&(c=c.replace(/(url\()['"]([^#][\s\S]+?)['"](\))|(url\()([^#][\s\S]+?)(\))/gi,f)),d.postProcessJS&&(i=c.replace(/(<script[^>]+?src=['"])([^'"]+)(['"].+?>)/gi,e)),d.postProcessIMAGES&&(i=c.replace(/(<img[^>]+?src=['"])([^'^"][\S\s]+?)(['"](?:\s?)+(?:>|\/>))/gi,e),i=c.replace(/(data-indicator-image-(?:on|off)=["'])([^'^"]+)(['"])/gi,e),i=c.replace(/(data-(?:arrow|offline)-image=["'])([^'^"]+)(['"])/gi,e),i=c.replace(/(?=<.*?data-action=['"]ZOOMABLE_IMAGE['"].*?>)(<.*?data-src=['"])([^'^"].*?)(['"].*?>)/gi,e)),void h();AS.offlineManager.write(a,c,{},b)}}var i,j,k='<style type="text/css">',l="</style>",m="<script>",n="</script>",o=[],p=!1,q={processBinary:function(a,b){c=c.replace(b,a),h()},processJS:function(a,b){c=c.split(j[0]).join(m+a+n),h()},processCSS:function(a,b){c=c.replace(j[0],k+a+l),h()}};d.postProcessCSS&&(i=c.replace(/(<link[^>]+?href=['"])([^'"]+)(['"].+>)/gi,e)),h()}var d=this;a&&(this.postProcessCount+=1,this.postProcessHTML?AS.offlineManager.read(a,{success:function(a){c(a)},error:function(){b()}}):b())},pageComplete:function(){this.completed||(this.savedPages+=1,AS.message.trigger(AS.message.OFFLINE_PAGE_DOWNLOAD_COMPLETE,{id:this.issueID,complete:this.savedPages,total:this.noPages}),this.process())},issueComplete:function(a){var b=this,c=b.savedPages-this.postProcessMe.length;return this.postProcessMe.length?(AS.message.trigger(AS.message.OFFLINE_PAGE_PROCESS_COMPLETE,{id:b.issueID,complete:c,total:b.savedPages}),void this.postProcess(this.postProcessMe.shift(),this.issueComplete)):(this.completed=!0,this.offline=!0,this.issueJSON.pages=this.pageDetails,void AS.offlineManager.write(this.offlineKey,this.issueJSON,{},function(){void AS.message.trigger(AS.message.OFFLINE_ISSUE_COMPLETE,{id:b.issueID,total:b.noPages,complete:b.savedPages,json:b.issueJSON})}))},process:function(){var a;return this.assetQueue.length?(a=this.assetQueue.shift(),void("processBinary"===this.fileTypes[this.fileExt(a)]?this.processBinary(a):this.loadAsset(a))):this.processed?this.pageQueue.length?(this.processed=!1,a=this.pageQueue.shift(),void this.loadAsset(a)):void 0:(this.processed=!0,void(this.pageQueue.length?this.pageComplete():this.issueComplete()))},processBinary:function(a){var b=this;AS.offlineManager.loadFile(a,{success:this.process,error:function(){b.process()}})},processCSS:function(a,b){function c(a,b,c,f,g,h){var i=d.split("/"),j=c.split("/"),k=c.split("/");_.each(k,function(a){".."===a&&(i.pop(),j.shift())});var l=b+i.join("/")+"/"+j.join("/")+f.replace("'","");return-1===_.indexOf(e.issueJSON.asset,i.join("/")+"/"+j.join("/"))&&(e.assetQueue.push(i.join("/")+"/"+j.join("/")),e.issueJSON.asset.push(i.join("/")+"/"+j.join("/"))),l}var d=this.getRoot(b),e=this;a=a.replace(/(url\()['"]?([^#][\s\S]+?)['"]?(\))/gi,c),AS.offlineManager.write(b,a,{},this.process)},processJS:function(a,b){this.getRoot(b),AS.offlineManager.write(b,a,{},this.process)},processHTML:function(a,b){function c(a,b,c,e,f,g){return-1!==a.indexOf("://")?a:d(a,b,c,e,f,g)}function d(a,b,c,d,f,h){var i=e.split("/"),j=c.split("/"),k=c.split("/");_.each(k,function(a){".."===a&&(i.pop(),j.shift())});var l=b+i.join("/")+"/"+j.join("/")+d,m=i.join("/")+"/"+j.join("/");return-1===_.indexOf(g.issueJSON.asset,m)&&(g.assetQueue.push(m),g.issueJSON.asset.push(m)),l}var e=this.getRoot(b),f={url:b,assets:[],size:0},g=this;a=a.replace(/(<img[^>]+?src=['"])([^'^"][\S\s]+?)(['"](?:\s?)+(?:>|\/>))/gi,d),a=a.replace(/(<link[^>]+?href=['"])([^'"]+)(['"].+>)/gi,d),a=a.replace(/(<script[^>]+?src=['"])([^'"]+)(['"].+?>)/gi,d),a=a.replace(/(url\()([^#][\s\S]+?)(\))/gi,d),a=a.replace(/(data-indicator-image-(?:on|off)=["'])([^'^"]+)(['"])/gi,d),a=a.replace(/(data-(?:arrow|offline)-image=["'])([^'^"]+)(['"])/gi,d),a=a.replace(/(?=<.*?data-action=['"]ZOOMABLE_IMAGE['"].*?>)(<.*?data-src=['"])([^'^"].*?)(['"].*?>)/gi,d),a=a.replace(/(?=<.*?data-widget=['"](?:VIDEO)['"].*?>)(<.*?data-src=['"])([^'^"].*?)(['"].*?>)/gi,c),this.pageDetails.push(f),this.postProcessMe.push(b),AS.offlineManager.write(b,a,{},this.process)},remove:function(){function a(a){f+=1,AS.message.trigger(AS.message.OFFLINE_PAGE_DELETE_COMPLETE,{id:e.issueID,complete:f,total:d}),f===d&&AS.offlineManager.remove(e.offlineKey,b)}function b(a){e.freshStart(),e.offline=!1,_.defer(function(){AS.message.trigger(AS.message.OFFLINE_ISSUE_DELETE_COMPLETE,{id:e.issueID,total:e.noPages,complete:e.savedPages,json:e.issueJSON})})}var c=this.issueJSON.asset,d=c.length,e=this,f=0;_.each(this.issueJSON.pages,function(a,b){c.push(a.url)}),_.each(c,function(b,c){AS.offlineManager.remove(b,a)})},getRoot:function(a){return a.substring(0,a.lastIndexOf("/"))},fileExt:function(a){var b=a.split("?").shift();return b.split(".").pop().toUpperCase()},loadAsset:function(a){var b=this,c=new XMLHttpRequest;c.onload=function(){if(200===this.status){var c=this.response,d=b.fileExt(a);b[b.fileTypes[d]](c,a)}else b.process()},c.open("get",a,!0),c.send()}},AS.LibraryManager.Issue=a}(),function(){"use strict";var a=window.webkitRequestFileSystemSync||window.requestFileSystemSync,b=AS.offlineManager,c=function(){function a(a,b,c){e[a][b]=c}function c(a,b){var c=e[a][b];return delete e[a][b],c}var d,e={read:{},write:{}},f={readFileComplete:function(a,b){c("read",a)(b)},writeFileComplete:function(a){c("write",a)()}};return{name:"File System",init:function(a){d=new Worker(AS.config.get("app.workerBasePath")+"/offline.filesystem.worker.js"),d.addEventListener("message",b.createResponder(f)),d.addEventListener("error",function(a){throw"Error in FileSystem API: "+a.message}),_.defer(a)},read:function(b,c){a("read",b,c),d.postMessage({command:"read",args:[b]})},write:function(b,c,e,f){a("write",b,f),d.postMessage({command:"write",args:[b,e]})}}};a&&b.registerImpl("fileSystem",c,2)}(),function(){"use strict";var a=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,b=AS.config.get("offline.dbName"),c="undefined"!=typeof a,d=function(){var c,d=b;return{name:"IndexedDB",init:function(b){function e(a){a.createObjectStore(d)}var f=a.open(d);f.onerror=function(a){b(a)},f.onsuccess=function(f){if(c=f.target.result,c.onerror=function(a){throw"Error creating/accessing IndexedDB database"},!c.objectStoreNames.length){c.close();var g=a.open(d,c.version++);return void(g.onsuccess=function(a){e(a.target.result),b()})}b()},f.onupgradeneeded=function(a){e(f.result)}},read:function(a,b){var e=c.transaction([d],"readonly");e.objectStore(d).get(a).onsuccess=function(a){var c=a.target.result;b(c)}},write:function(a,b,e,f){var g,h=c.transaction([d],"readwrite");g=h.objectStore(d).put(b,a),g.onsuccess=f,g.onerror=function(){f("Unable to write: "+a)}},remove:function(a,b){var e,f=c.transaction([d],"readwrite");e=f.objectStore(d)["delete"](a),e.onsuccess=b,e.onerror=function(){b("Unable to delete: "+a)}}}};c&&AS.offlineManager.registerImpl("indexedDb",d,3)}(),function(){"use strict";var a="undefined"!=typeof window.openDatabase,b=AS.config.get("offline.dbName"),c=/Phantom/.test(navigator.userAgent)?1048576:52428800,d=function(){function a(a){return function(b){a("SQL Error: "+b.message)}}var d;return{name:"WebSQL",init:function(a){try{d=window.openDatabase(b,"",b,c),_.defer(a)}catch(e){_.defer(a,e)}},read:function(b,c){d.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS resources (id unique, data)"),a.executeSql("SELECT * FROM resources WHERE id = ?",[b],function(a,b){c(b.rows.length>0?b.rows.item(0).data:void 0)})},a(c))},write:function(b,c,e,f){this.read(b,function(e){d.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS resources (id unique, data)"),e?a.executeSql("UPDATE resources SET data = ? WHERE id = ?",[c,b]):a.executeSql("INSERT INTO resources (id, data) VALUES (?, ?)",[b,c])},a(f),f)})},remove:function(b,c){this.read(b,function(e){d.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS resources (id unique, data)"),e&&a.executeSql("DELETE FROM resources WHERE id = ?",[b])},a(c),c)})}}};a&&AS.offlineManager.registerImpl("webSql",d,1)}(),function(){"use strict";var a=AS.cookies.detect()?"undefined"!=typeof localStorage:!1,b=function(){return{name:"LocalStorage",init:function(a){_.defer(a)},read:function(a,b){_.defer(b,localStorage.getItem(a))},write:function(a,b,c,d){localStorage.setItem(a,b),_.defer(d)}}};a&&AS.offlineManager.registerImpl("localStorage",b,0)}(),function(){"use strict";var a=AS.offlineManager,b=[],c={URL_TO_POLL:"webreader/online-poller.json",POLLING_INTERVAL:5e3,isOnline:!1,initialised:!1,polled:!1,init:function(b){return this.initialised?void("function"==typeof b&&setTimeout(b)):void a.init(function(){c.initialised=!0,c.poll(),"function"==typeof b&&b()})},poll:function(){function a(){for(c.polled=!0;b.length;){var a=b.shift();c.loadResource(a.url,a.callback)}}$.ajax({url:c.URL_TO_POLL,type:"GET",timeout:c.POLLING_INTERVAL,cache:!1,success:function(){c.isOnline||(c.isOnline=!0,AS.message.trigger(AS.message.ONLINE)),a()},error:function(){c.isOnline&&(c.isOnline=!1,AS.message.trigger(AS.message.OFFLINE)),a()}})},loadResource:function(c,d){if("function"!=typeof d.error)throw new Error("No Error Callback for load Resource");if("function"!=typeof d.success)throw new Error("No Success Callback for load resource");return this.polled?a.persistenceEnabled&&AS.config.get("app.enableOffline")?void(this.isOnline?a.loadFile(c,d):a.read(c,{success:function(a,b){d.success(a,b)},error:function(a){d.error(a)}})):void _.defer(function(){d.error("No Persistence/Offline Mode available")}):void b.push({url:c,callback:d})}};_.bindAll(c);var d=Backbone.ajax;Backbone.ajax=function(a){c.loadResource(a.url,{success:function(b){return a.success(b)},error:function(b){return d.call(this,a)}})},AS.resourceManager=c,AS.message.on(AS.message.APPLICATION_START,function(){c.init()})}(),function(){"use strict";var a=(AS.offlineManager,AS.resourceManager);AS.resourceHelper={attach:function(b,c,d){AS.router.offline?a.loadResource(c,{success:function(a){b.src=a||c,d()},error:function(a){b.src=c,d()}}):(b.src=c,d())}}}(),function(){"use strict";function a(a){AS.message.trigger(AS.message.ISSUE_LOADING_ERROR,0),a&&AS.message.trigger(AS.message.NOTIFICATION_SHOW,a.toLocaleString()),window.location.hash=""}AS.Router=Backbone.Router.extend({appView:void 0,storeView:void 0,issueView:void 0,loaderview:void 0,ie9iframeView:void 0,notificationView:void 0,offlineView:void 0,orientationRedirect:!0,renderViewForce:!1,readerURL:null,directToStore:!0,connection:!0,routes:{"issue/:issue(/:variant)(/:page)":"loaderScreen","redirect/:issue/:page":"redirect","*path":"store"},initialize:function(){_.bindAll(this),this.getReaderURL(),AS.message.on(AS.message.PRE_AUTHENTICATED,this.start),AS.message.on(AS.message.PAGE_INITIALISED,this.pageInitialised),AS.message.on(AS.message.GOTO_STORE,this.gotoStore),AS.message.on(AS.message.LOADING_OPEN,this.loadingDone),AS.message.on(AS.message.ORIENTATION_CHANGE,this.orientationChange),AS.message.on(AS.message.OFFLINE,this.offline),AS.message.on(AS.message.ONLINE,this.online),AS.AuthProxy.enabled?AS.message.trigger(AS.message.PRE_AUTHENTICATE):(AS.Session.authenticated=!0,this.start())},start:function(){this.appController=new AS.AppController,this.loaderview=new AS.LoaderView,$("body").append(this.loaderview.el),AS.util.isIE9()&&(this.ie9iframeView=new AS.IE9IframeView,$("body").append(this.ie9iframeView.render().el)),this.notificationView=new AS.NotificationView,$("#loader-screen").before(this.notificationView.el),this.appView=new AS.AppView,$("#loader-screen").before(this.appView.render().el),Modernizr.touch||AS.config.get("app.mobileOnly")||(this.ttip=new AS.TTipView,$("#loader-screen").before(this.ttip.el)),this.publicationModel=new AS.PublicationModel,this.publicationModel.fetch({success:function(a){AS.message.trigger(AS.message.PUBLICATION_LOADED,a),Backbone.history.start()},error:function(){AS.message.trigger(AS.message.NOTIFICATION_SHOW,"notification-load-config-fail".toLocaleString(),{level:AS.NOTIFICATION_LEVEL.ERROR})}})},getReaderURL:function(){var a,b=window.location.pathname;-1!==b.indexOf(".html")&&(a=b.split("/"),a=a.slice(0,a.length-1),b=a.join("/")),b+="/"===b[b.length-1]?"webreader/":"/webreader/",this.readerURL=b},loadIssue:function(b,c){function d(){$("body").removeClass("issue-hide"),AS.message.trigger(AS.message.ISSUE_LOADED,f),c(f)}function e(){h.publicationModel.set("currentIssueId",null),a("issue-no-content-store")}var f,g,h=this;if(this.publicationModel.get("currentIssueId")!==b){if(this.publicationModel.set("currentIssueId",b),g=this.publicationModel.get("issues").get(b),"undefined"==typeof g)return e();!g.get("viewable"),f=new AS.IssueModel({publication:this.publicationModel,summary:g}),function i(a){a.fetch({success:function(){return a.isValid()?void d():e()},error:function(){AS.util.RETINA?(AS.util.RETINA=!1,i(a)):e()}})}(f),this.publicationModel.set("currentIssue",f)}else{if(f=this.publicationModel.get("currentIssue"),!f.isValid())return e();d()}},getSlugForPage:function(a,b,c){var d=void 0!==c?this.publicationModel.get("issues").get(c):this.publicationModel.get("currentIssue");return b=b||d.get("currentVariant").get("orientation"),["issue",d.id,b,a+1].join("/")},store:function(){if(this.directToStore=!1,!AS.config.get("features.storeAccessibility")){var a=AS.Session.getPublication().attributes;if(a.hasOwnProperty("issues")&&a.issues.length>0){var b=a.issues.models[0],c=["issue",b.id,b.attributes.orientation,1].join("/");return void AS.router.navigate(c,{trigger:!0})}}this.storeView||(this.storeView=new AS.StoreView({model:this.publicationModel})),this.publicationModel.get("currentIssue")&&AS.message.trigger(AS.message.ISSUE_UNLOADED),AS.message.trigger(AS.message.STORE),this.appView.initView(this.storeView),document.title="greeting".toLocaleString(),AS.message.trigger(AS.message.TRACK_PAGE,{page:window.location.href,title:"Store"})},loaderScreen:function(a,b,c){if(this.directToStore&&window.navigator.standalone)return this.directToStore=!1,void this.gotoStore();var d=this.publicationModel.get("currentIssue"),e=d?d.get("currentVariant"):void 0;e&&a===d.id&&b===e.get("orientation")?this.loadingDone({issueId:a,variant:b,pageNumber:c}):this.loaderview.loadIssue(a,b,c)},loadingDone:function(a){this.issue(a.issueId,a.variant,a.pageNumber)},issue:function(b,c,d){var e=this;this.issueView||(this.issueView=new AS.IssueView),this.loadIssue(b,function(b){if(!b||!b.get("currentVariant"))return a();var f,g=b.get("currentVariant").get("orientation");c=c||AS.config.get("publication.orientation");var h=g!==c;b.getVariantByName(c)||(c=g,h=!0),b.setCurrentVariant(c),d||(d=1);var i=d-1,j=b.get("currentVariant").get("pages").length;if(i>j){if(e.loaderview.loadingIndex>j)return a("issue-no-content");i=b.get("currentVariant").get("currentPageIndex")}h&&(f=e.getSlugForPage(d-1),history.replaceState?history.replaceState({},null,"#"+f):location.hash=f),b.get("currentVariant").set("currentArticleID",e.getArticleByPage(i)),e.issueView.model=b,e.appView.initView(e.issueView,e.renderViewForce||h,function(){_.defer(function(){AS.message.trigger(AS.message.PAGE_NAVIGATE,{page:i})})}),e.renderViewForce=!1}),this.orientationLocked()},getArticleByPage:function(a){var b,c=this.publicationModel.get("currentIssue").get("currentVariant").get("pages");return c.forEach(function(c,d){d===a&&(b=c.get("article").id)}),b},redirect:function(b,c){var d=this;b.indexOf(":")>=0&&(b=AS.util.parseIssueId(b)),this.loadIssue(b,function(b){var e,f=b.getPageById(c);f?(e=d.getSlugForPage(f.index(),f.get("variant").get("orientation"),b.id),d.navigate(e,{trigger:!0})):a()})},offline:function(){return this.connection=!1,AS.config.get("app.enableOffline")?void AS.message.trigger(AS.message.NOTIFICATION_SHOW,"notification-offline".toLocaleString()):AS.OfflineView.getInstance().show()},online:function(){AS.OfflineView.getInstance().hide(),this.connection=!0},pageInitialised:function(a){var b=this.publicationModel.get("currentIssue"),c=b.get("currentVariant"),d=c.get("pages").at(a),e=d.get("article"),f=e?e.title:void 0,g=AS.config.get("publication.title")+" - "+(a+1);if(b&&this.appView.currentView===this.issueView){var h=this.getSlugForPage(a);window.location.hash!=="#"+h&&this.navigate(h)}f&&(g+=" - "+f),document.title=g},gotoStore:function(){this.navigate("store",{trigger:!0})},orientationLocked:function(){AS.orientation.locked()&&(AS.orientation.value()!==AS.orientation.get()?AS.message.trigger(AS.message.ORIENTATION_UNAVAILABLE):AS.message.trigger(AS.message.ORIENTATION_AVAILABLE))},orientationChange:function(a){var b=this;AS.orientation.set(),this.appView.currentView===this.storeView?AS.message.trigger(AS.message.RESIZE):_.defer(function(){b.orientationProcess(a)})},orientationProcess:function(a){if(a=AS.orientation.value(),AS.orientation.locked())this.orientationLocked();else{var b,c,d,e=this.publicationModel.get("currentIssue"),f=e.get("currentVariant"),g=f.get("currentPageIndex"),h=f.get("pages"),i=(this.getSlugForPage(0,a),e.getVariantByName(a)),j=i?i.get("pages"):void 0,k=0,l=!1;if(i&&j){d=h.models[g].get("article").id,c=h.models[g].get("contents")[0].pageRef;for(var m=0;m<j.models.length;++m){var n=j.models[m];if(n.get("article").id===d&&n.get("contents")[0].pageRef===c){l=!0;break}++k}}l&&f.get("orientation")!==a?(b=this.getSlugForPage(k,a),this.orientationRedirect?(this.orientationRedirect=!0,this.renderViewForce=!0,this.loaderview&&(this.loaderview.loadingIssueMessage=!1),this.navigate(b,{trigger:!0})):(this.orientationRedirect=!0,AS.message.trigger(AS.message.ORIENTATION_AVAILABLE))):(this.renderViewForce=!0,this.loaderview.loadIssue(e.id,f.get("orientation"),g+1))}},noCookies:function(){return this.noCookieView=new AS.NoCookieView,this.appView.initView(this.noCookieView),this.noCookieView},_bindRoutes:function(){return!AS.cookies.detect()&&AS.config.get("app.enableCookies")?(this.appView||(this.appView=new AS.AppView,$("body").append(this.appView.render().el)),void this.noCookies()):void Backbone.Router.prototype._bindRoutes.apply(this,arguments)}})}(),function(){"use strict";AS.config({IssueView:{template:"issueview-tmpl",components:["PageListView","NavigatorView","ToolbarView","HelpView","TocView","ZoomView"]},PageListView:{"class":AS.PageListView},NavigatorView:{"class":AS.NavigatorView},ToolbarView:{"class":AS.ToolbarView},TocView:{"class":AS.TocBarView},HelpView:{"class":AS.HelpView},ZoomView:{"class":AS.ZoomView}})}(),function(){"use strict";AS.structs={}}(),function(){"use strict";AS.structs.Map=function(a,b){this.map_={},this.keys_=[],this.count_=0,this.version_=0;var c=arguments.length;if(c>1){if(c%2)throw Error("Uneven number of arguments");for(var d=0;c>d;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)},AS.structs.Map.prototype.getCount=function(){return this.count_},AS.structs.Map.prototype.getValues=function(){this.cleanupKeysArray_();for(var a=[],b=0;b<this.keys_.length;b++){var c=this.keys_[b];a.push(this.map_[c])}return a},AS.structs.Map.prototype.getKeys=function(){return this.cleanupKeysArray_(),this.keys_.concat()},AS.structs.Map.prototype.containsKey=function(a){return AS.structs.Map.hasKey_(this.map_,a)},AS.structs.Map.prototype.containsValue=function(a){for(var b=0;b<this.keys_.length;b++){var c=this.keys_[b];if(AS.structs.Map.hasKey_(this.map_,c)&&this.map_[c]===a)return!0}return!1},AS.structs.Map.prototype.equals=function(a,b){if(this===a)return!0;if(this.count_!==a.getCount())return!1;var c=b||AS.structs.Map.defaultEquals;this.cleanupKeysArray_();for(var d,e=0;d=this.keys_[e];e++)if(!c(this.get(d),a.get(d)))return!1;return!0},AS.structs.Map.defaultEquals=function(a,b){return a===b},AS.structs.Map.prototype.isEmpty=function(){return 0===this.count_},AS.structs.Map.prototype.clear=function(){this.map_={},this.keys_.length=0,this.count_=0,this.version_=0},AS.structs.Map.prototype.remove=function(a){return AS.structs.Map.hasKey_(this.map_,a)?(delete this.map_[a],this.count_--,this.version_++,this.keys_.length>2*this.count_&&this.cleanupKeysArray_(),!0):!1},AS.structs.Map.prototype.cleanupKeysArray_=function(){if(this.count_!==this.keys_.length){for(var a=0,b=0;a<this.keys_.length;){var c=this.keys_[a];AS.structs.Map.hasKey_(this.map_,c)&&(this.keys_[b++]=c),a++}this.keys_.length=b}if(this.count_!==this.keys_.length){var d={};for(a=0,b=0;a<this.keys_.length;)c=this.keys_[a],AS.structs.Map.hasKey_(d,c)||(this.keys_[b++]=c,d[c]=1),a++;this.keys_.length=b}},AS.structs.Map.prototype.get=function(a,b){return AS.structs.Map.hasKey_(this.map_,a)?this.map_[a]:b},AS.structs.Map.prototype.set=function(a,b){AS.structs.Map.hasKey_(this.map_,a)||(this.count_++,this.keys_.push(a),this.version_++),this.map_[a]=b},AS.structs.Map.prototype.forEach=function(a,b){for(var c=this.getKeys(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}},AS.structs.Map.prototype.clone=function(){return new AS.structs.Map(this)},AS.structs.Map.prototype.transpose=function(){for(var a=new AS.structs.Map,b=0;b<this.keys_.length;b++){var c=this.keys_[b],d=this.map_[c];a.set(d,c)}return a},AS.structs.Map.prototype.toObject=function(){this.cleanupKeysArray_();for(var a={},b=0;b<this.keys_.length;b++){var c=this.keys_[b];a[c]=this.map_[c]}return a},AS.structs.Map.hasKey_=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)}}(),function(){"use strict";AS.structs.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),AS.structs.uidCounter_=0,AS.structs.Set=function(a){this.map_=new AS.structs.Map,a&&this.addAll(a)},AS.structs.Set.getUid=function(a){return a[AS.structs.UID_PROPERTY_]||(a[AS.structs.UID_PROPERTY_]=++AS.structs.uidCounter_)},AS.structs.Set.getKey_=function(a){var b=typeof a;return"object"===b&&a||"function"===b?"o"+AS.structs.Set.getUid(a):b.substr(0,1)+a},AS.structs.Set.prototype.getCount=function(){return this.map_.getCount()},AS.structs.Set.prototype.add=function(a){this.map_.set(AS.structs.Set.getKey_(a),a)},AS.structs.Set.prototype.addAll=function(a){for(var b=AS.structs.getValues(a),c=b.length,d=0;c>d;d++)this.add(b[d])},AS.structs.Set.prototype.removeAll=function(a){for(var b=AS.structs.getValues(a),c=b.length,d=0;c>d;d++)this.remove(b[d])},AS.structs.Set.prototype.remove=function(a){return this.map_.remove(AS.structs.Set.getKey_(a))},AS.structs.Set.prototype.clear=function(){this.map_.clear()},AS.structs.Set.prototype.isEmpty=function(){return this.map_.isEmpty()},AS.structs.Set.prototype.contains=function(a){return this.map_.containsKey(AS.structs.Set.getKey_(a))},AS.structs.Set.prototype.containsAll=function(a){return AS.structs.every(a,this.contains,this)},AS.structs.Set.prototype.intersection=function(a){for(var b=new AS.structs.Set,c=AS.structs.getValues(a),d=0;d<c.length;d++){var e=c[d];this.contains(e)&&b.add(e)}return b},AS.structs.Set.prototype.difference=function(a){var b=this.clone();return b.removeAll(a),b},AS.structs.Set.prototype.getValues=function(){return this.map_.getValues()},AS.structs.Set.prototype.clone=function(){return new AS.structs.Set(this)},AS.structs.Set.prototype.equals=function(a){return this.getCount()===AS.structs.getCount(a)&&this.isSubsetOf(a)},AS.structs.Set.prototype.isSubsetOf=function(a){var b=AS.structs.getCount(a);return this.getCount()>b?!1:(!(a instanceof AS.structs.Set)&&b>5&&(a=new AS.structs.Set(a)),AS.structs.every(this,function(b){return AS.structs.contains(a,b)}))},AS.structs.Set.prototype.__iterator__=function(a){return this.map_.__iterator__(!1)}}();